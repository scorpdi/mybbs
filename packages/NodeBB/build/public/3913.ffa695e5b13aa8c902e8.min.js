"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3913],{98166:(t,e,i)=>{var a,n;a=[i(59006),i(31369),i(7927)],void 0===(n=function(t,e,i){const a={},n={timestamp:0,open:!1,edit:!1,posts:{}};let o,s=[];const r={el:null,icon:null,defaultText:"",activeText:""};let c,l;async function g(){const i=await t.render("modals/topic-scheduler");e.dialog({message:i,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:m,onHidden:u,onEscape:!0,buttons:{cancel:{label:n.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(n.timestamp?"btn-warning":"btn-default")+(n.edit?" hidden":""),callback:d},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:p}}})}function m(t){n.open=!0;const e=t.target.querySelector(".datetime-picker");c=e.querySelector('input[type="date"]'),l=e.querySelector('input[type="time"]'),function(){const t=new Date,e=new Date(t.getTime()-6e4*t.getTimezoneOffset()).toJSON();if(c.setAttribute("min",e.slice(0,10)),l.setAttribute("min",e.slice(11,-8)),a.isActive()){const e=new Date(n.timestamp-6e4*t.getTimezoneOffset()).toJSON();c.value=e.slice(0,10),l.value=e.slice(11,-8)}}()}function u(){n.open=!1}function p(){const t=c.value&&l.value,e=new Date(`${c.value} ${l.value}`).getTime();if(!t||isNaN(e)||e<Date.now()){n.timestamp=0;const t=e<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return i.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:t}),!1}n.timestamp||f(!0),n.timestamp=e}function d(){n.timestamp&&(f(!1),n.timestamp=0)}function f(t=!0){o.forEach((e=>e.classList.toggle("active",t))),r.icon&&(r.icon.classList.toggle("fa-check",!t),r.icon.classList.toggle("fa-clock-o",t)),r.el.lastChild.textContent=t?r.activeText:r.defaultText}return $(window).on("action:composer.activate",(function(t,{post_uuid:e}){n.edit=!1;const i=n.posts[e];i&&i.isMain&&i.timestamp>Date.now()&&(n.timestamp=i.timestamp,n.edit=!0,f())})),a.init=function(t,e){n.timestamp=0,n.posts=e,s=t[0].querySelectorAll(".display-scheduler"),o=t[0].querySelectorAll(".display-scheduler i"),r.el=t[0].querySelector(".composer-submit:not(.btn-sm)"),r.icon=r.el.querySelector("i"),r.defaultText=r.el.lastChild.textContent,r.activeText=r.el.getAttribute("data-text-variant"),o.forEach((t=>t.addEventListener("click",g)))},a.getTimestamp=function(){return!a.isActive()||isNaN(n.timestamp)?0:n.timestamp},a.isActive=function(){return n.timestamp>0},a.isOpen=function(){return n.open},a.reset=function(){n.timestamp=0},a.onChangeCategory=function(t){var e;e=t.privileges["topics:schedule"],s.forEach((t=>t.classList.toggle("hidden",!e))),f(!1),a.reset()},a}.apply(e,a))||(t.exports=n)},88186:(t,e,i)=>{var a,n;a=[i(7927)],void 0===(n=function(t){var e,i,a={};function n(t,a,n){var o=t.find(".tags"),s=t.find(".bootstrap-tagsinput input");s.length&&(n.hasOwnProperty("minTags")&&(e=n.minTags),n.hasOwnProperty("maxTags")&&(i=n.maxTags),n.tagWhitelist&&n.tagWhitelist.length?(s.attr("readonly",""),s.attr("placeholder",""),o.tagsinput("items").slice().forEach((function(t){-1===n.tagWhitelist.indexOf(t)&&o.tagsinput("remove",t)}))):(s.removeAttr("readonly"),s.attr("placeholder",t.find("input.tags").attr("placeholder"))),t.find(".tags-container").toggleClass("hidden",n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]||0===i&&!a&&!a.tags&&!a.tags.length),n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]&&o.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:t,tagWhitelist:n.tagWhitelist,tagsInput:s}))}function o(t){var e=jQuery.Event("keypress");e.which=13,e.keyCode=13,setTimeout((function(){t.trigger(e)}),100)}function s(t,e){if(t&&t.length)for(var i=0;i<t.length;++i)e.tagsinput("add",t[i])}return a.init=function(r,c){var l=r.find(".tags");if(l.length){e=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,i=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,l.tagsinput({confirmKeys:[13,44],trimValue:!0});var g=r.find(".bootstrap-tagsinput input");n(r,c,ajaxify.data),app.loadJQueryUI((function(){g.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:r.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(e,i){socket.emit("topics.autocompleteTags",{query:e.term,cid:c.cid},(function(e,a){if(e)return t.error(e);a&&i(a),$(".ui-autocomplete a").attr("data-ajaxify","false")}))},select:function(){o(g)}}),s(c.tags,l),l.on("beforeItemAdd",(function(e){var n=i&&i<=a.getTags(r.attr("data-uuid")).length,o=utils.cleanUpTag(e.item,config.maximumTagLength),s=o!==e.item;return e.cancel=s||e.item.length<config.minimumTagLength||e.item.length>config.maximumTagLength||n,e.item.length<config.minimumTagLength?t.error("[[error:tag-too-short, "+config.minimumTagLength+"]]"):e.item.length>config.maximumTagLength?t.error("[[error:tag-too-long, "+config.maximumTagLength+"]]"):n?t.error("[[error:too-many-tags, "+i+"]]"):void(s&&l.tagsinput("add",o))}));var e=!1,n=!1;l.on("itemRemoved",(function(i){n?n=!1:i.item&&socket.emit("topics.canRemoveTag",{tag:i.item},(function(a,n){if(a)return t.error(a);n||(t.error("[[error:cant-remove-system-tag]]"),e=!0,l.tagsinput("add",i.item))}))})),l.on("itemAdded",(function(i){if(e)e=!1;else{var a=c.hasOwnProperty("cid")?c.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:i.item,cid:a||0},(function(e,o){return e?t.error(e):o?($(window).trigger("action:tag.added",{cid:a,tagEl:l,tag:i.item}),void(g.length&&g.autocomplete("close"))):(n=!0,l.tagsinput("remove",i.item))}))}}))})),g.attr("tabIndex",l.attr("tabIndex")),g.on("blur",(function(){o(g)})),$('[component="composer/tag/dropdown"]').on("click","li",(function(){var t=$(this).attr("data-tag");return t&&s([t],l),!1}))}},a.isEnoughTags=function(t){return a.getTags(t).length>=e},a.minTagCount=function(){return e},a.onChangeCategory=function(t,e,i,a){var o=t.find('[component="composer/tag/dropdown"]');o.length&&(n(t,e,a),o.toggleClass("hidden",!a.tagWhitelist||!a.tagWhitelist.length),a.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:a.tagWhitelist},(function(t){o.find(".dropdown-menu").html(t)})))},a.getTags=function(t){return $('.composer[data-uuid="'+t+'"] .tags').tagsinput("items")},a}.apply(e,a))||(t.exports=n)}}]);