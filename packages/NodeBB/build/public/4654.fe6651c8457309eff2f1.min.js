"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4654,6922],{34654:(t,e,n)=>{var s,o;s=[n(74344),n(31369),n(7927),n(47720)],void 0===(o=function(t,e,n){const s={},o={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};function i(t,e){return new Promise((n=>{const s=[{diffs:t.revisions.map((function(t){const e=parseInt(t.timestamp,10);return{username:t.username,timestamp:e,pretty:new Date(e).toLocaleString(config.userLang.replace("_","-"),o)}})),numDiffs:t.timestamps.length,editable:t.editable,deletable:t.deletable},function(t){n(t)}];e&&s.unshift(e),app.parseAndTranslate("partials/modals/post_history",...s)}))}return s.open=function(o){config.enablePostHistory&&t.get(`/posts/${o}/diffs`,{}).then((t=>{i(t).then((n=>{const i=e.dialog({title:"[[topic:diffs.title]]",message:n,size:"large"});if(!t.timestamps.length)return;const a=i.find("select"),r=i.find('button[data-action="restore"]'),p=i.find('button[data-action="delete"]'),l=i.find("ul.posts-list"),c=i.find(".number-of-diffs strong");a.on("change",(function(){s.load(o,this.value,l),r.prop("disabled",0===t.timestamps.indexOf(this.value)),p.prop("disabled",0===t.timestamps.indexOf(this.value))})),r.on("click",(function(){s.restore(o,a.val(),i)})),p.on("click",(function(){s.delete(o,a.val(),a,c)})),i.on("shown.bs.modal",(function(){s.load(o,a.val(),l),r.prop("disabled",!0),p.prop("disabled",!0)}))}))})).catch(n.error)},s.load=function(e,s,o){config.enablePostHistory&&t.get(`/posts/${e}/diffs/${s}`,{}).then((t=>{t.deleted=!!parseInt(t.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[t]},(function(t){o.empty().append(t),o.find(".timeago").timeago()}))})).catch(n.error)},s.restore=function(e,s,o){config.enablePostHistory&&t.put(`/posts/${e}/diffs/${s}`,{}).then((()=>{o.modal("hide"),n.success("[[topic:diffs.post-restored]]")})).catch(n.error)},s.delete=function(e,s,o,a){t.del(`/posts/${e}/diffs/${s}`).then((t=>{i(t,"diffs").then((t=>{o.empty().append(t),o.trigger("change");const e=o.find("option").length;a.text(e),n.success("[[topic:diffs.deleted]]")}))})).catch(n.error)},s}.apply(e,s))||(t.exports=o)},47720:(t,e)=>{var n;void 0===(n=function(){return{wrapImagesInLinks:function(t){t.find('[component="post/content"] img:not(.emoji)').each((function(){const t=$(this);let e=t.attr("src")||"";const n=t.attr("alt")||"",s=/-resized(\.[\w]+)?$/;if("about:blank"===e)return;utils.isRelativeUrl(e)&&s.test(e)&&(e=e.replace(s,"$1"));const o=e.split(".").slice(1).pop(),i=n.split("/").pop(),a=i.split(".").slice(1).pop();t.parent().is("a")||t.wrap('<a href="'+e+'" '+(!o&&a?' download="'+i+'" ':"")+' target="_blank" rel="noopener">')}))}}}.apply(e,[]))||(t.exports=n)}}]);