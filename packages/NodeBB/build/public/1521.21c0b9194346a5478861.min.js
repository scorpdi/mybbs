"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1521,2160,8306,7073,3913],{44541:(t,e,i)=>{var n,o;n=[i(27145),i(32230),i(22143),i(45482),i(47913),i(88186),i(98755),i(83713),i(38259),i(2585),i(98166),i(75203),i(62023),i(74344),i(31369),i(7927),i(85233),i(44882),i(7073),i(10577)],void 0===(o=function(t,e,n,o,a,s,r,c,l,d,u,p,m,f,g,h,v,y,b,w){var x={active:void 0,posts:{},bsEnvironment:void 0,formatting:void 0};function k(){var t=x.bsEnvironment;!0!==ajaxify.data.template.compose&&"xs"!==t&&"sm"!==t||history.back()}function T(){var t=utils.findBootstrapEnvironment(),e="xs"===t||"sm"===t;c.toggle&&(c.env!==t&&e&&(c.env=t,c.toggle(!1)),c.env=t),void 0!==x.active&&(l.reposition($('.composer[data-uuid="'+x.active+'"]')),!e&&window.location.pathname.startsWith(config.relative_path+"/compose")?history.back():e&&!window.location.pathname.startsWith(config.relative_path+"/compose")&&O()),x.bsEnvironment=t}function C(i){var n=utils.generateUUID(),o=function(t){var e,i;for(var n in t.hasOwnProperty("cid")?e="cid":t.hasOwnProperty("tid")?e="tid":t.hasOwnProperty("pid")&&(e="pid"),i=t[e],x.posts)if(x.posts[n].hasOwnProperty(e)&&i===x.posts[n][e])return n;return!1}(i);if(o)return t.updateActive(o),x.load(o);var a="[[topic:composer.new_topic]]";"posts.reply"===i.action?a="[[topic:composer.replying_to]]":"posts.edit"===i.action&&(a="[[topic:composer.editing]]"),e.translate(a,(function(e){t.push("composer",n,{title:e.replace("%1",'"'+i.title+'"')})})),i.hasOwnProperty("cid")?i.save_id=["composer",app.user.uid,"cid",i.cid].join(":"):i.hasOwnProperty("tid")?i.save_id=["composer",app.user.uid,"tid",i.tid].join(":"):i.hasOwnProperty("pid")&&(i.save_id=["composer",app.user.uid,"pid",i.pid].join(":")),x.posts[n]=i,x.load(n)}async function _(t,e){$('.composer[data-uuid="'+t+'"]').find(".composer-submit").removeAttr("disabled");const{showAlert:i}=await v.fire("filter:composer.error",{post_uuid:t,message:e,showAlert:!0});i&&h.alert({type:"danger",timeout:1e4,title:"",message:e,alert_id:"post_error"})}async function E(i){var n=x.posts[i],o=!!n&&n.hasOwnProperty("cid"),a=!!n&&!!n.isMain,s=!!n&&!!n.pid,r=!!n&&0===parseInt(n.uid,10);const c=n.timestamp>Date.now();var d=n.title.replace(/%/g,"&#37;").replace(/,/g,"&#44;");n.category=await async function(t){return ajaxify.data.template.category?ajaxify.data:parseInt(t.cid,10)?await f.get(`/api/category/${t.cid}`,{}):null}(n);const u=n.category?n.category.privileges:ajaxify.data.privileges;var m={title:d,titleLength:d.length,mobile:"xs"===x.bsEnvironment||"sm"===x.bsEnvironment,resizable:!0,thumb:n.thumb,isTopicOrMain:o||a,maximumTitleLength:config.maximumTitleLength,maximumPostLength:config.maximumPostLength,minimumTagLength:config.minimumTagLength,maximumTagLength:config.maximumTagLength,isTopic:o,isEditing:s,canSchedule:!!(a&&u&&(u["topics:schedule"]&&!s||c&&u.view_scheduled)),showHandleInput:config.allowGuestHandles&&(0===app.user.uid||s&&r&&app.user.isAdmin),handle:n?n.handle||"":void 0,formatting:x.formatting,tagWhitelist:n.category?n.category.tagWhitelist:ajaxify.data.tagWhitelist,privileges:app.user.privileges,selectedCategory:n.category,submitOptions:[]};m.mobile&&(O(),app.toggleNavbar(!1)),n.mobile="xs"===x.bsEnvironment||"sm"===x.bsEnvironment,({postData:n,createData:m}=await v.fire("filter:composer.create",{postData:n,createData:m})),app.parseAndTranslate("composer",m,(function(o){if(!$('.composer.composer[data-uuid="'+i+'"]').length){(o=$(o)).find(".title").each((function(){$(this).text(e.unescape($(this).text()))})),o.attr("data-uuid",i),$(document.body).append(o);var a=$(o[0]);if(l.reposition(a),x.enhance(a,i,n),I(i),a.on("click",(function(){t.isActive(i)||t.updateActive(i)})),l.handleResize(a),"xs"===x.bsEnvironment||"sm"===x.bsEnvironment){var s=a.find(".composer-submit"),r=a.find(".mobile-navbar .composer-submit"),c=a.find(".write").attr("tabindex");s.removeAttr("tabindex"),r.attr("tabindex",parseInt(c,10)+1),$(".category-name-container").on("click",(function(){$(".category-selector").toggleClass("open")}))}$(window).trigger("action:composer.loaded",{postContainer:a,post_uuid:i,composerData:x.posts[i],formatting:x.formatting}),p.apply(a.find(".write")),P(a),S()}}))}function O(){var t="compose?p="+window.location.pathname,e=window.location.pathname.slice(1)+window.location.search;e.startsWith(config.relative_path.slice(1))&&(e=e.slice(config.relative_path.length)),window.history.replaceState({url:null,returnPath:e},e,config.relative_path+"/"+e),window.history.pushState({url:t},t,`${config.relative_path}/${e}`)}function I(t){x.active&&x.active!==t&&x.minimize(x.active),x.active=t,$(window).trigger("action:composer.activate",{post_uuid:t})}function P(t){setTimeout((function(){var e=t.find("input.title");e.length?e.focus():t.find("textarea").focus().putCursorAtEnd()}),20)}async function j(t){var e=x.posts[t],i=$('.composer[data-uuid="'+t+'"]'),o=i.find(".handle"),c=i.find(".title"),l=i.find("textarea"),d=i.find("input#topic-thumb-url"),p=e.hasOwnProperty("template")&&!0===e.template.compose;const m=i.find(".composer-submit");c.val(c.val().trim()),l.val(utils.rtrim(l.val())),d.length&&d.val(d.val().trim());var g=e.action,b=(e.hasOwnProperty("cid")||parseInt(e.pid,10))&&i.find("input.title").length,w=!b||b&&parseInt(e.cid,10),T={post_uuid:t,postData:e,postContainer:i,titleEl:c,titleLen:c.val().length,bodyEl:l,bodyLen:l.val().length};if(await v.fire("filter:composer.check",T),$(window).trigger("action:composer.check",T),T.error)return _(t,T.error);if(n.inProgress[t]&&n.inProgress[t].length)return _(t,"[[error:still-uploading]]");if(b&&T.titleLen<parseInt(config.minimumTitleLength,10))return _(t,"[[error:title-too-short, "+config.minimumTitleLength+"]]");if(b&&T.titleLen>parseInt(config.maximumTitleLength,10))return _(t,"[[error:title-too-long, "+config.maximumTitleLength+"]]");if("topics.post"===g&&!w)return _(t,"[[error:category-not-selected]]");if(T.bodyLen<parseInt(config.minimumPostLength,10))return _(t,"[[error:content-too-short, "+config.minimumPostLength+"]]");if(T.bodyLen>parseInt(config.maximumPostLength,10))return _(t,"[[error:content-too-long, "+config.maximumPostLength+"]]");if(b&&!s.isEnoughTags(t))return _(t,"[[error:not-enough-tags, "+s.minTagCount()+"]]");if(u.isActive()&&u.getTimestamp()<=Date.now())return _(t,"[[error:scheduling-to-past]]");let C={uuid:t},E="post",O="";"topics.post"===g?(O="/topics",C={...C,handle:o?o.val():void 0,title:c.val(),content:l.val(),thumb:d.val()||"",cid:r.getSelectedCid(),tags:s.getTags(t),timestamp:u.getTimestamp()}):"posts.reply"===g?(O=`/topics/${e.tid}`,C={...C,tid:e.tid,handle:o?o.val():void 0,content:l.val(),toPid:e.toPid}):"posts.edit"===g&&(E="put",O=`/posts/${e.pid}`,C={...C,pid:e.pid,handle:o?o.val():void 0,content:l.val(),title:c.val(),thumb:d.val()||"",tags:s.getTags(t),timestamp:u.getTimestamp()});var I={composerEl:i,action:g,composerData:C,postData:e,redirect:!0};await v.fire("filter:composer.submit",I),v.fire("action:composer.submit",Object.freeze(I));var P=$('#taskbar .composer[data-uuid="'+t+'"] i'),j=i.find(".write");P.removeClass("fa-plus").addClass("fa-circle-o-notch fa-spin"),x.minimize(t),j.prop("readonly",!0),f[E](O,C).then((i=>{m.removeAttr("disabled"),e.submitted=!0,x.discard(t),a.removeDraft(e.save_id),i.queued?h.alert({type:"success",title:"[[global:alert.success]]",message:i.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${i.id}`)}}):"topics.post"===g?I.redirect&&ajaxify.go("topic/"+i.slug,void 0,p||"xs"===x.bsEnvironment||"sm"===x.bsEnvironment):"posts.reply"===g?p||"xs"===x.bsEnvironment||"sm"===x.bsEnvironment?window.history.back():I.redirect&&("topic"!==ajaxify.data.template.name||ajaxify.data.template.topic&&parseInt(e.tid,10)!==parseInt(ajaxify.data.tid,10))&&ajaxify.go("post/"+i.pid):k(),v.fire("action:composer."+g,{composerData:C,data:i})})).catch((e=>{if(x.load(t),j.prop("readonly",!1),"[[error:email-not-confirmed]]"===e.message)return y.showEmailConfirmWarning(e.message);_(t,e.message)}))}function S(){$("html").addClass("composing")}function L(){$("body").css({paddingBottom:0}),$("html").removeClass("composing"),app.toggleNavbar(!0)}return $(window).off("resize",T).on("resize",T),T(),$(window).on("action:composer.topics.post",(function(t,e){localStorage.removeItem("category:"+e.data.cid+":bookmark"),localStorage.removeItem("category:"+e.data.cid+":bookmark:clicked")})),$(window).on("popstate",(function(){var t=utils.findBootstrapEnvironment();if(x.active&&("xs"===t||"sm"===t)){if(!x.posts[x.active].modified)return x.discard(x.active),void(x.discardConfirm&&x.discardConfirm.length&&(x.discardConfirm.modal("hide"),delete x.discardConfirm));e.translate("[[modules:composer.discard]]",(function(t){x.discardConfirm=g.confirm(t,(function(t){t?x.discard(x.active):x.posts[x.active].modified=!0})),x.posts[x.active].modified=!1}))}})),x.findByTid=function(t){for(var e in x.posts)if(x.posts.hasOwnProperty(e)&&x.posts[e].hasOwnProperty("tid")&&parseInt(x.posts[e].tid,10)===parseInt(t,10))return e;return null},x.addButton=function(t,e,i){o.addButton(t,e,i)},x.newTopic=async t=>{var e={action:"topics.post",cid:t.cid,title:t.title||"",body:t.body||"",tags:t.tags||[],modified:!!(t.title&&t.title.length||t.body&&t.body.length),isMain:!0};({pushData:e}=await v.fire("filter:composer.topic.push",{data:t,pushData:e})),C(e)},x.addQuote=function(t,i,n,o,a,s,r){r=r||x.active;var l=(o||"").replace(/([\\`*_{}[\]()#+\-.!])/g,"\\$1").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/%/g,"&#37;").replace(/,/g,"&#44;");s&&(s="> "+s.replace(/\n/g,"\n> ")+"\n\n");var d="["+l+"]("+config.relative_path+"/post/"+(n||i)+")";if(void 0!==r){r!==x.active&&x.load(r);var u=$('.composer[data-uuid="'+r+'"]'),p=u.find("textarea"),m=p.val();o&&(n||i)?e.translate("[[modules:composer.user_said_in, "+a+", "+d+"]]\n",config.defaultLang,f):e.translate("[[modules:composer.user_said, "+a+"]]\n",config.defaultLang,f)}else o&&(n||i)?x.newReply(t,i,o,"[[modules:composer.user_said_in, "+a+", "+d+"]]\n"+s):x.newReply(t,i,o,"[[modules:composer.user_said, "+a+"]]\n"+s);function f(t){x.posts[r].body=(m.length?m+"\n\n":"")+t+s,p.val(x.posts[r].body),P(u),c.render(u)}},x.newReply=function(t,i,n,o){e.translate(o,config.defaultLang,(function(e){C({action:"posts.reply",tid:t,toPid:i,title:n,body:e,modified:!!(n&&n.length||e&&e.length),isMain:!1})}))},x.editPost=function(t){socket.emit("plugins.composer.push",t,(function(e,i){if(e)return h.error(e);i.action="posts.edit",i.pid=t,i.modified=!1,C(i)}))},x.load=function(t){var e=$('.composer[data-uuid="'+t+'"]');e.length?(I(t),l.reposition(e),P(e),S()):x.formatting?E(t):socket.emit("plugins.composer.getFormattingOptions",(function(e,i){if(e)return h.error(e);x.formatting=i,E(t)}))},x.enhance=function(t,l,p){l||p||(l=utils.generateUUID(),x.posts[l]=ajaxify.data,p=ajaxify.data,t.attr("data-uuid",l));var m=t.find("input.title"),f=t.find("input.handle"),h=t.find("input.tags"),y=t.find("textarea"),T=t.find(".composer-submit");r.init(t,x.posts[l]),u.init(t,x.posts),o.addHandler(t),o.addComposerButtons(),c.handleToggler(t),n.initialize(l),s.init(t,x.posts[l]),d.init(t,l),t.on("change","input, textarea",(function(){x.posts[l].modified=!0,a.updateVisibility("available",x.posts[l].save_id,!0),a.updateVisibility("open",x.posts[l].save_id,!0)})),T.on("click",(function(t){t.preventDefault(),t.stopPropagation(),$(this).attr("disabled",!0),j(l)})),i.e(2441).then((function(){var e=[i(42441)];(function(e){e(t.get(0)).bind("mod+enter",(function(){T.attr("disabled",!0),j(l)}))}).apply(null,e)})).catch(i.oe),t.find(".composer-discard").on("click",(function(t){if(t.preventDefault(),!x.posts[l].modified)return x.discard(l),k();o.exitFullscreen();var i=$(this).prop("disabled",!0);e.translate("[[modules:composer.discard]]",(function(t){g.confirm(t,(function(t){t&&(x.discard(l),k()),i.prop("disabled",!1)}))}))})),t.find(".composer-minimize, .minimize .trigger").on("click",(function(t){t.preventDefault(),t.stopPropagation(),x.minimize(l)})),y.on("input propertychange",utils.debounce((function(){c.render(t)}),250)),y.on("scroll",(function(){c.matchScroll(t)})),a.init(t,p);var C=a.get(p.save_id);C&&C.title&&m.val(C.title),C&&C.handle&&f.val(C.handle),C&&C.tags&&C.tags.split(",").forEach((function(t){h.tagsinput("add",t)})),y.val(C.text?C.text:p.body),c.render(t,(function(){c.matchScroll(t)})),function(t){var e=t.find(".help");socket.emit("plugins.composer.renderHelp",(function(t,i){!t&&i&&i.length>0&&(e.removeClass("hidden"),e.on("click",(function(){g.alert(i)})))}))}(t),function(t){var e=t.attr("data-uuid"),i=x.posts[e]&&"posts.edit"===x.posts[e].action,n=utils.findBootstrapEnvironment();i||"xs"===n||"sm"===n||b.enableQuickSearch({searchElements:{inputEl:t.find("input.title"),resultEl:t.find(".quick-search-container")},hideOnNoMatches:!0})}(t),P(t),"posts.edit"===p.action&&x.updateThumbCount(l,t),w.isEnabled||$('[data-format="zen"]').addClass("hidden"),v.fire("action:composer.enhanced",{postContainer:t,postData:p,draft:C})},x.discard=function(e){if(x.posts[e]){var i=x.posts[e];$('.composer[data-uuid="'+e+'"]').remove(),a.removeDraft(i.save_id),m.deleteAll(e),t.discard("composer",e),$('[data-action="post"]').removeAttr("disabled"),v.fire("action:composer.discard",{post_uuid:e,postData:i}),delete x.posts[e],x.active=void 0}u.reset(),L()},x.close=x.discard,x.minimize=function(e){$('.composer[data-uuid="'+e+'"]').css("visibility","hidden"),x.active=void 0,t.minimize("composer",e),$(window).trigger("action:composer.minimize",{post_uuid:e}),L()},x.minimizeActive=function(){x.active&&x.miminize(x.active)},x.updateThumbCount=function(t,e){const i=x.posts[t];if("topics.post"===i.action||"posts.edit"===i.action&&i.isMain){const n=[m.get(t)];i.pid&&n.push(m.getByPid(i.pid)),Promise.all(n).then((t=>{(t=t.reduce(((t,e)=>t.concat(e)))).length&&e.find('[data-format="thumbs"]').attr("data-count",t.length)}))}},x}.apply(e,n))||(t.exports=o)},2585:(t,e,i)=>{var n,o;n=[i(83713),i(70675),i(88207),i(62336)],void 0===(o=function(t,{Textcomplete:e},{TextareaEditor:i},{ContenteditableEditor:n}){var o={_active:{}};return $(window).on("action:composer.discard",(function(t,e){o._active.hasOwnProperty(e.post_uuid)&&(o._active[e.post_uuid].destroy(),delete o._active[e.post_uuid])})),o.init=function(e,i){var n,a=e.find(".write"),s="composer-autocomplete-dropdown-"+i;if(a.length){var r={element:a,strategies:[],options:{style:{"z-index":2e4},className:s+" dropdown-menu textcomplete-dropdown"}};a.on("keyup",(function(){clearTimeout(n),n=setTimeout((function(){var t=document.querySelector("."+s);if(t){var e=t.getBoundingClientRect(),i=parseFloat(t.style.marginTop,10)||0,n=window.innerHeight+i-10-e.bottom;t.style.marginTop=Math.min(n,0)+"px"}}),0)})),$(window).trigger("composer:autocomplete:init",r),o._active[i]=o.setup(r),r.element.on("textComplete:select",(function(){t.render(e)}))}},o.setup=function({element:t,strategies:o,options:a}){const s=t.get(0);if(s){var r;"TEXTAREA"===s.nodeName?r=new i(s):"DIV"===s.nodeName&&"true"===s.getAttribute("contenteditable")&&(r=new n(s)),s.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var c=new e(r,o,{dropdown:a});return c.on("rendered",(function(){c.dropdown.items.length&&c.dropdown.items[0].activate()})),c}},o}.apply(e,n))||(t.exports=o)},98166:(t,e,i)=>{var n,o;n=[i(59006),i(31369),i(7927)],void 0===(o=function(t,e,i){const n={},o={timestamp:0,open:!1,edit:!1,posts:{}};let a,s=[];const r={el:null,icon:null,defaultText:"",activeText:""};let c,l;async function d(){const i=await t.render("modals/topic-scheduler");e.dialog({message:i,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:u,onHidden:p,onEscape:!0,buttons:{cancel:{label:o.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(o.timestamp?"btn-warning":"btn-default")+(o.edit?" hidden":""),callback:f},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:m}}})}function u(t){o.open=!0;const e=t.target.querySelector(".datetime-picker");c=e.querySelector('input[type="date"]'),l=e.querySelector('input[type="time"]'),function(){const t=new Date,e=new Date(t.getTime()-6e4*t.getTimezoneOffset()).toJSON();if(c.setAttribute("min",e.slice(0,10)),l.setAttribute("min",e.slice(11,-8)),n.isActive()){const e=new Date(o.timestamp-6e4*t.getTimezoneOffset()).toJSON();c.value=e.slice(0,10),l.value=e.slice(11,-8)}}()}function p(){o.open=!1}function m(){const t=c.value&&l.value,e=new Date(`${c.value} ${l.value}`).getTime();if(!t||isNaN(e)||e<Date.now()){o.timestamp=0;const t=e<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return i.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:t}),!1}o.timestamp||g(!0),o.timestamp=e}function f(){o.timestamp&&(g(!1),o.timestamp=0)}function g(t=!0){a.forEach((e=>e.classList.toggle("active",t))),r.icon&&(r.icon.classList.toggle("fa-check",!t),r.icon.classList.toggle("fa-clock-o",t)),r.el.lastChild.textContent=t?r.activeText:r.defaultText}return $(window).on("action:composer.activate",(function(t,{post_uuid:e}){o.edit=!1;const i=o.posts[e];i&&i.isMain&&i.timestamp>Date.now()&&(o.timestamp=i.timestamp,o.edit=!0,g())})),n.init=function(t,e){o.timestamp=0,o.posts=e,s=t[0].querySelectorAll(".display-scheduler"),a=t[0].querySelectorAll(".display-scheduler i"),r.el=t[0].querySelector(".composer-submit:not(.btn-sm)"),r.icon=r.el.querySelector("i"),r.defaultText=r.el.lastChild.textContent,r.activeText=r.el.getAttribute("data-text-variant"),a.forEach((t=>t.addEventListener("click",d)))},n.getTimestamp=function(){return!n.isActive()||isNaN(o.timestamp)?0:o.timestamp},n.isActive=function(){return o.timestamp>0},n.isOpen=function(){return o.open},n.reset=function(){o.timestamp=0},n.onChangeCategory=function(t){var e;e=t.privileges["topics:schedule"],s.forEach((t=>t.classList.toggle("hidden",!e))),g(!1),n.reset()},n}.apply(e,n))||(t.exports=o)},88186:(t,e,i)=>{var n,o;n=[i(7927)],void 0===(o=function(t){var e,i,n={};function o(t,n,o){var a=t.find(".tags"),s=t.find(".bootstrap-tagsinput input");s.length&&(o.hasOwnProperty("minTags")&&(e=o.minTags),o.hasOwnProperty("maxTags")&&(i=o.maxTags),o.tagWhitelist&&o.tagWhitelist.length?(s.attr("readonly",""),s.attr("placeholder",""),a.tagsinput("items").slice().forEach((function(t){-1===o.tagWhitelist.indexOf(t)&&a.tagsinput("remove",t)}))):(s.removeAttr("readonly"),s.attr("placeholder",t.find("input.tags").attr("placeholder"))),t.find(".tags-container").toggleClass("hidden",o.privileges&&o.privileges.hasOwnProperty("topics:tag")&&!o.privileges["topics:tag"]||0===i&&!n&&!n.tags&&!n.tags.length),o.privileges&&o.privileges.hasOwnProperty("topics:tag")&&!o.privileges["topics:tag"]&&a.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:t,tagWhitelist:o.tagWhitelist,tagsInput:s}))}function a(t){var e=jQuery.Event("keypress");e.which=13,e.keyCode=13,setTimeout((function(){t.trigger(e)}),100)}function s(t,e){if(t&&t.length)for(var i=0;i<t.length;++i)e.tagsinput("add",t[i])}return n.init=function(r,c){var l=r.find(".tags");if(l.length){e=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,i=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,l.tagsinput({confirmKeys:[13,44],trimValue:!0});var d=r.find(".bootstrap-tagsinput input");o(r,c,ajaxify.data),app.loadJQueryUI((function(){d.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:r.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(e,i){socket.emit("topics.autocompleteTags",{query:e.term,cid:c.cid},(function(e,n){if(e)return t.error(e);n&&i(n),$(".ui-autocomplete a").attr("data-ajaxify","false")}))},select:function(){a(d)}}),s(c.tags,l),l.on("beforeItemAdd",(function(e){var o=i&&i<=n.getTags(r.attr("data-uuid")).length,a=utils.cleanUpTag(e.item,config.maximumTagLength),s=a!==e.item;return e.cancel=s||e.item.length<config.minimumTagLength||e.item.length>config.maximumTagLength||o,e.item.length<config.minimumTagLength?t.error("[[error:tag-too-short, "+config.minimumTagLength+"]]"):e.item.length>config.maximumTagLength?t.error("[[error:tag-too-long, "+config.maximumTagLength+"]]"):o?t.error("[[error:too-many-tags, "+i+"]]"):void(s&&l.tagsinput("add",a))}));var e=!1,o=!1;l.on("itemRemoved",(function(i){o?o=!1:i.item&&socket.emit("topics.canRemoveTag",{tag:i.item},(function(n,o){if(n)return t.error(n);o||(t.error("[[error:cant-remove-system-tag]]"),e=!0,l.tagsinput("add",i.item))}))})),l.on("itemAdded",(function(i){if(e)e=!1;else{var n=c.hasOwnProperty("cid")?c.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:i.item,cid:n||0},(function(e,a){return e?t.error(e):a?($(window).trigger("action:tag.added",{cid:n,tagEl:l,tag:i.item}),void(d.length&&d.autocomplete("close"))):(o=!0,l.tagsinput("remove",i.item))}))}}))})),d.attr("tabIndex",l.attr("tabIndex")),d.on("blur",(function(){a(d)})),$('[component="composer/tag/dropdown"]').on("click","li",(function(){var t=$(this).attr("data-tag");return t&&s([t],l),!1}))}},n.isEnoughTags=function(t){return n.getTags(t).length>=e},n.minTagCount=function(){return e},n.onChangeCategory=function(t,e,i,n){var a=t.find('[component="composer/tag/dropdown"]');a.length&&(o(t,e,n),a.toggleClass("hidden",!n.tagWhitelist||!n.tagWhitelist.length),n.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:n.tagWhitelist},(function(t){a.find(".dropdown-menu").html(t)})))},n.getTags=function(t){return $('.composer[data-uuid="'+t+'"] .tags').tagsinput("items")},n}.apply(e,n))||(t.exports=o)},44882:(t,e,i)=>{var n,o;n=[i(31369),i(32230),i(66603),i(7927),i(85233)],void 0===(o=function(t,e,i,n,o){const a={};let s,r;return a.show=function(){o.one("action:ajaxify.end",(()=>{!function(){const e=utils.params({full:!0});s=e.has("loggedin"),r=e.get("register"),s&&(n.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),e.delete("loggedin")),r&&(t.alert({message:utils.escapeHTML(decodeURIComponent(r))}),e.delete("register"));const i=e.toString();ajaxify.updateHistory(ajaxify.currentPage+(i?`?${i}`:"")+document.location.hash,!0)}(),config.cookies.enabled&&navigator.cookieEnabled&&!app.inAdmin&&"1"!==i.getItem("cookieconsent")&&(config.cookies.message=e.unescape(config.cookies.message),config.cookies.dismiss=e.unescape(config.cookies.dismiss),config.cookies.link=e.unescape(config.cookies.link),config.cookies.link_url=e.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,(function(t){$(document.body).append(t),$(document.body).addClass("cookie-consent-open");const e=$(".cookie-consent");e.find("button").on("click",(function(){i.setItem("cookieconsent","1"),e.remove(),$(document.body).removeClass("cookie-consent-open")}))}))),a.showEmailConfirmWarning()}))},a.showEmailConfirmWarning=function(t){if(!config.emailPrompt||!app.user.uid||1===parseInt(i.getItem("email-confirm-dismiss"),10))return;const e={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{i.setItem("email-confirm-dismiss",1)}};app.user.email?app.user["email:confirmed"]||app.user.isEmailConfirmSent?!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(e.message="[[error:email-not-confirmed-email-sent]]",n.alert(e)):(e.message=t||"[[error:email-not-confirmed]]",e.clickfn=function(){n.remove("email_confirm"),socket.emit("user.emailConfirm",{},(function(t){if(t)return n.error(t);n.success("[[notifications:email-confirm-sent]]")}))},n.alert(e)):(e.message="[[error:no-email-to-confirm]]",e.clickfn=function(){n.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},n.alert(e))},a.showInvalidSession=function(){t.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},a.showSessionMismatch=function(){t.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},a}.apply(e,n))||(t.exports=o)},75203:(t,e,i)=>{var n;void 0===(n=function(){return{apply:function(t){$(t).on("mousewheel",(function(t){const e=this.scrollTop,i=this.scrollHeight,n=Math.round(this.getBoundingClientRect().height);if(t.originalEvent.deltaY<0&&0===e||t.originalEvent.deltaY>0&&n+e>=i)return!1}))}}}.call(e,i,e,t))||(t.exports=n)},7073:(t,e,i)=>{var n,o;n=[i(32230),i(66603),i(85233),i(7927)],void 0===(o=function(t,e,i,n){const o={current:{}};function a(t){const e=t.in||"titles",o=t.by||"";let a=t.term.replace(/^[ ?#]*/,"");try{a=encodeURIComponent(a)}catch(t){return n.error("[[error:invalid-search-term]]")}const s={term:a,in:e};return t.matchWords&&(s.matchWords=t.matchWords),o&&o.length&&("posts"===e||"titles"===e||"titlesposts"===e)&&(s.by=o),t.categories&&t.categories.length&&(s.categories=t.categories,t.searchChildren&&(s.searchChildren=t.searchChildren)),t.hasTags&&t.hasTags.length&&(s.hasTags=t.hasTags),parseInt(t.replies,10)>0&&(s.replies=t.replies,s.repliesFilter=t.repliesFilter||"atleast"),t.timeRange&&(s.timeRange=t.timeRange,s.timeFilter=t.timeFilter||"newer"),t.sortBy&&(s.sortBy=t.sortBy,s.sortDirection=t.sortDirection),t.showAs&&(s.showAs=t.showAs),t.searchOnly&&(s.searchOnly=t.searchOnly),i.fire("action:search.createQueryString",{query:s,data:t}),decodeURIComponent($.param(s))}return o.init=function(t){if(!config.searchEnabled)return;t=t||{in:config.searchDefaultInQuick||"titles"};const e=$("#search-button"),a=$("#search-fields"),s=$("#search-fields input"),r=$("#quick-search-container");$("#search-form .advanced-search-link").off("mousedown").on("mousedown",(function(){ajaxify.go("/search")})),$("#search-form").off("submit").on("submit",(function(){s.blur()})),s.off("blur").on("blur",(function(){setTimeout((function(){s.is(":focus")||(a.addClass("hidden"),e.removeClass("hidden"))}),200)})),s.off("focus");const c={inputEl:s,resultEl:r};o.enableQuickSearch({searchOptions:t,searchElements:c}),e.off("click").on("click",(function(t){return config.loggedIn||app.user.privileges["search:content"]?(t.stopPropagation(),o.showAndFocusInput(),!1):(n.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1)})),$("#search-form").off("submit").on("submit",(function(){const e=$(this).find("input"),n=o.getSearchPreferences();return n.term=e.val(),n.in=t.in,i.fire("action:search.submit",{searchOptions:n,searchElements:c}),o.query(n,(function(){e.val("")})),!1}))},o.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const n=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),a=e.searchElements.resultEl,s=e.searchElements.inputEl;let r=s.val();const c=a.find(".filter-category");function l(){ajaxify.data.template.category&&t.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",(function(t){const e=$("<div></div>").html(t).text();c.find(".name").text(e)})),c.toggleClass("hidden",!ajaxify.data.template.category)}function d(){e.searchOptions=Object.assign({},n),e.searchOptions.term=s.val(),l(),ajaxify.data.template.category&&c.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),a.removeClass("hidden").find(".quick-search-results-container").html(""),a.find(".loading-indicator").removeClass("hidden"),i.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,o.api(e.searchOptions,(function(t){if(a.find(".loading-indicator").addClass("hidden"),!t.posts||e.hideOnNoMatches&&!t.posts.length)return a.addClass("hidden").find(".quick-search-results-container").html("");t.posts.forEach((function(t){const e=$("<div>"+t.content+"</div>").text(),i=s.val().toLowerCase().replace(/^in:topic-\d+/,""),n=Math.max(0,e.toLowerCase().indexOf(i)-40);t.snippet=utils.escapeHTML((n>0?"...":"")+e.slice(n,n+80)+(e.length-n>80?"...":""))})),app.parseAndTranslate("partials/quick-search-results",t,(function(n){n.length&&n.find(".timeago").timeago(),a.toggleClass("hidden",!n.length||!s.is(":focus")).find(".quick-search-results-container").html(n.length?n:"");const r=a.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");o.highlightMatches(e.searchOptions.term,r),i.fire("action:search.quick.complete",{data:t,options:e})}))}))}a.find('.filter-category input[type="checkbox"]').on("change",(function(){s.focus(),d()})),s.off("keyup").on("keyup",utils.debounce((function(){if(s.val().length<3)return a.addClass("hidden"),void(r=s.val());if(s.val()!==r){if(r=s.val(),!s.is(":focus"))return a.addClass("hidden");d()}}),500));let u=!1;a.on("mousedown",(function(){$(window).one("mouseup",(function(){a.addClass("hidden")})),u=!0})),s.on("blur",(function(){s.is(":focus")||u||a.hasClass("hidden")||a.addClass("hidden")}));let p=!1;i.on("action:ajaxify.end",(function(){ajaxify.isCold()||(p=!0)})),s.on("focus",(function(){u=!1;const t=s.val();r=t,t&&a.find("#quick-search-results").children().length&&(l(),p?(d(),p=!1):a.removeClass("hidden"),s[0].setSelectionRange(t.startsWith("in:topic")?t.indexOf(" ")+1:0,t.length))})),s.off("refresh").on("refresh",(function(){d()}))},o.showAndFocusInput=function(){$("#search-fields").removeClass("hidden"),$("#search-button").addClass("hidden"),$("#search-fields input").focus()},o.query=function(t,e){e=e||function(){},ajaxify.go("search?"+a(t)),e()},o.api=function(t,e){const i=config.relative_path+"/api/search?"+a(t);t.searchOnly=void 0;const n=config.relative_path+"/search?"+a(t);$.get(i,(function(t){t.url=n,e(t)}))},o.getSearchPreferences=function(){try{return JSON.parse(e.getItem("search-preferences")||"{}")}catch(t){return{}}},o.highlightMatches=function(t,e){if(!t||!e.length)return;const i=(t=utils.escapeHTML(t.replace(/^"/,"").replace(/"$/,"").trim())).split(" ").map((function(t){return utils.escapeRegexChars(t)})).join("|"),n=new RegExp("("+i+")","gi");e.each((function(){const t=$(this),e=[];t.find("*").each((function(){$(this).after("\x3c!-- "+e.length+" --\x3e"),e.push($("<div></div>").append($(this)))})),t.html(t.html().replace(n,(function(t,e){return'<strong class="search-match">'+e+"</strong>"}))),e.forEach((function(e,i){t.html(t.html().replace("\x3c!-- "+i+" --\x3e",(function(){return e.html()})))}))})),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-responsive")},o}.apply(e,n))||(t.exports=o)},66603:(t,e,i)=>{var n;void 0===(n=function(){function t(){this._store={},this._keys=[]}let e;t.prototype.isMock=!0,t.prototype.setItem=function(t,e){t=String(t),-1===this._keys.indexOf(t)&&this._keys.push(t),this._store[t]=e},t.prototype.getItem=function(t){return t=String(t),-1===this._keys.indexOf(t)?null:this._store[t]},t.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter((function(e){return e!==t})),this._store[t]=null},t.prototype.clear=function(){this._keys=[],this._store={}},t.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(t.prototype,"length",{get:function(){return this._keys.length}});const i=Date.now().toString();try{if(e=window.localStorage,e.setItem(i,i),e.getItem(i)!==i)throw Error("localStorage behaved unexpectedly");return e.removeItem(i),e}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(e=window.sessionStorage,e.setItem(i,i),e.getItem(i)!==i)throw Error("sessionStorage behaved unexpectedly");return e.removeItem(i),e}catch(e){return console.warn(e),console.warn("sessionStorage failed, falling back on memory storage"),new t}}}.call(e,i,e,t))||(t.exports=n)}}]);