"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[28,7073],{90028:(e,t,n)=>{var i,s;i=[n(7073),n(7927),n(74344)],void 0===(s=function(e,t,n){const i={};let s,c,a={};function o(e){if(!s)return;const t=$(this).parents('[component="category/topic"]').attr("data-tid");return i.addTopic(t),e.preventDefault(),e.stopPropagation(),!1}function r(){if(!s)return;const e=Object.keys(a);e.sort((function(e,t){return e-t}));const t=e.map((function(e){return{tid:e,title:a[e]}}));e.length?app.parseAndTranslate("partials/merge_topics_modal",{config,topics:t},(function(e){s.find(".topics-section").html(e.find(".topics-section").html()),s.find(".merge-main-topic-select").html(e.find(".merge-main-topic-select").html())})):s.find(".topics-section").translateHtml("[[error:no-topics-selected]]")}function l(){s&&(s.remove(),s=null),a={},$("#content").off("click",'[component="topic/select"]',o)}return i.init=function(n){n=n||function(){},s||app.parseAndTranslate("partials/merge_topics_modal",{},(function(h){s=h,$("body").append(s),c=s.find("#merge_topics_confirm"),s.find(".close,#merge_topics_cancel").on("click",l),$("#content").on("click",'[component="topic/select"]',o),r(),c.on("click",(function(){!function(e){e.attr("disabled",!0);const n=Object.keys(a),i={};s.find(".merge-main-topic-radio").is(":checked")?i.mainTid=s.find(".merge-main-topic-select").val():s.find(".merge-new-title-radio").is(":checked")&&(i.newTopicTitle=s.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:n,options:i},(function(n,i){if(e.removeAttr("disabled"),n)return t.error(n);ajaxify.go("/topic/"+i),l()}))}(c)})),e.enableQuickSearch({searchElements:{inputEl:s.find(".topic-search-input"),resultEl:s.find(".quick-search-container")},searchOptions:{in:"titles"}}),s.on("click","[data-tid]",(function(){return $(this).attr("data-tid")&&i.addTopic($(this).attr("data-tid")),!1})),n()}))},i.addTopic=function(e,i){i=i||function(){},n.get(`/topics/${e}`,{}).then((function(t){const n=t?t.title:"No title";a[e]?delete a[e]:a[e]=n,Object.keys(a).length?c.removeAttr("disabled"):c.attr("disabled",!0),r(),i()})).catch(t.error)},i}.apply(t,i))||(e.exports=s)},7073:(e,t,n)=>{var i,s;i=[n(32230),n(66603),n(85233),n(7927)],void 0===(s=function(e,t,n,i){const s={current:{}};function c(e){const t=e.in||"titles",s=e.by||"";let c=e.term.replace(/^[ ?#]*/,"");try{c=encodeURIComponent(c)}catch(e){return i.error("[[error:invalid-search-term]]")}const a={term:c,in:t};return e.matchWords&&(a.matchWords=e.matchWords),s&&s.length&&("posts"===t||"titles"===t||"titlesposts"===t)&&(a.by=s),e.categories&&e.categories.length&&(a.categories=e.categories,e.searchChildren&&(a.searchChildren=e.searchChildren)),e.hasTags&&e.hasTags.length&&(a.hasTags=e.hasTags),parseInt(e.replies,10)>0&&(a.replies=e.replies,a.repliesFilter=e.repliesFilter||"atleast"),e.timeRange&&(a.timeRange=e.timeRange,a.timeFilter=e.timeFilter||"newer"),e.sortBy&&(a.sortBy=e.sortBy,a.sortDirection=e.sortDirection),e.showAs&&(a.showAs=e.showAs),e.searchOnly&&(a.searchOnly=e.searchOnly),n.fire("action:search.createQueryString",{query:a,data:e}),decodeURIComponent($.param(a))}return s.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"};const t=$("#search-button"),c=$("#search-fields"),a=$("#search-fields input"),o=$("#quick-search-container");$("#search-form .advanced-search-link").off("mousedown").on("mousedown",(function(){ajaxify.go("/search")})),$("#search-form").off("submit").on("submit",(function(){a.blur()})),a.off("blur").on("blur",(function(){setTimeout((function(){a.is(":focus")||(c.addClass("hidden"),t.removeClass("hidden"))}),200)})),a.off("focus");const r={inputEl:a,resultEl:o};s.enableQuickSearch({searchOptions:e,searchElements:r}),t.off("click").on("click",(function(e){return config.loggedIn||app.user.privileges["search:content"]?(e.stopPropagation(),s.showAndFocusInput(),!1):(i.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1)})),$("#search-form").off("submit").on("submit",(function(){const t=$(this).find("input"),i=s.getSearchPreferences();return i.term=t.val(),i.in=e.in,n.fire("action:search.submit",{searchOptions:i,searchElements:r}),s.query(i,(function(){t.val("")})),!1}))},s.enableQuickSearch=function(t){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const i=Object.assign({in:config.searchDefaultInQuick||"titles"},t.searchOptions),c=t.searchElements.resultEl,a=t.searchElements.inputEl;let o=a.val();const r=c.find(".filter-category");function l(){ajaxify.data.template.category&&e.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",(function(e){const t=$("<div></div>").html(e).text();r.find(".name").text(t)})),r.toggleClass("hidden",!ajaxify.data.template.category)}function h(){t.searchOptions=Object.assign({},i),t.searchOptions.term=a.val(),l(),ajaxify.data.template.category&&r.find('input[type="checkbox"]').is(":checked")&&(t.searchOptions.categories=[ajaxify.data.cid],t.searchOptions.searchChildren=!0),c.removeClass("hidden").find(".quick-search-results-container").html(""),c.find(".loading-indicator").removeClass("hidden"),n.fire("action:search.quick.start",t),t.searchOptions.searchOnly=1,s.api(t.searchOptions,(function(e){if(c.find(".loading-indicator").addClass("hidden"),!e.posts||t.hideOnNoMatches&&!e.posts.length)return c.addClass("hidden").find(".quick-search-results-container").html("");e.posts.forEach((function(e){const t=$("<div>"+e.content+"</div>").text(),n=a.val().toLowerCase().replace(/^in:topic-\d+/,""),i=Math.max(0,t.toLowerCase().indexOf(n)-40);e.snippet=utils.escapeHTML((i>0?"...":"")+t.slice(i,i+80)+(t.length-i>80?"...":""))})),app.parseAndTranslate("partials/quick-search-results",e,(function(i){i.length&&i.find(".timeago").timeago(),c.toggleClass("hidden",!i.length||!a.is(":focus")).find(".quick-search-results-container").html(i.length?i:"");const o=c.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");s.highlightMatches(t.searchOptions.term,o),n.fire("action:search.quick.complete",{data:e,options:t})}))}))}c.find('.filter-category input[type="checkbox"]').on("change",(function(){a.focus(),h()})),a.off("keyup").on("keyup",utils.debounce((function(){if(a.val().length<3)return c.addClass("hidden"),void(o=a.val());if(a.val()!==o){if(o=a.val(),!a.is(":focus"))return c.addClass("hidden");h()}}),500));let d=!1;c.on("mousedown",(function(){$(window).one("mouseup",(function(){c.addClass("hidden")})),d=!0})),a.on("blur",(function(){a.is(":focus")||d||c.hasClass("hidden")||c.addClass("hidden")}));let u=!1;n.on("action:ajaxify.end",(function(){ajaxify.isCold()||(u=!0)})),a.on("focus",(function(){d=!1;const e=a.val();o=e,e&&c.find("#quick-search-results").children().length&&(l(),u?(h(),u=!1):c.removeClass("hidden"),a[0].setSelectionRange(e.startsWith("in:topic")?e.indexOf(" ")+1:0,e.length))})),a.off("refresh").on("refresh",(function(){h()}))},s.showAndFocusInput=function(){$("#search-fields").removeClass("hidden"),$("#search-button").addClass("hidden"),$("#search-fields input").focus()},s.query=function(e,t){t=t||function(){},ajaxify.go("search?"+c(e)),t()},s.api=function(e,t){const n=config.relative_path+"/api/search?"+c(e);e.searchOnly=void 0;const i=config.relative_path+"/search?"+c(e);$.get(n,(function(e){e.url=i,t(e)}))},s.getSearchPreferences=function(){try{return JSON.parse(t.getItem("search-preferences")||"{}")}catch(e){return{}}},s.highlightMatches=function(e,t){if(!e||!t.length)return;const n=(e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim())).split(" ").map((function(e){return utils.escapeRegexChars(e)})).join("|"),i=new RegExp("("+n+")","gi");t.each((function(){const e=$(this),t=[];e.find("*").each((function(){$(this).after("\x3c!-- "+t.length+" --\x3e"),t.push($("<div></div>").append($(this)))})),e.html(e.html().replace(i,(function(e,t){return'<strong class="search-match">'+t+"</strong>"}))),t.forEach((function(t,n){e.html(e.html().replace("\x3c!-- "+n+" --\x3e",(function(){return t.html()})))}))})),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-responsive")},s}.apply(t,i))||(e.exports=s)}}]);