"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3094],{53094:(t,o,n)=>{var e,i;e=[n(7237),n(3547),n(32230),n(7927),n(74344)],void 0===(i=function(t,o,n,e,i){const s={};let c,a,p;function d(){if(!c)return;const t=c.find("#topicId");let o=null;ajaxify.data.template.topic&&ajaxify.data.tid&&parseInt(ajaxify.data.tid,10)!==p&&(o=ajaxify.data.tid),o&&!t.val()&&t.val(o),f()}function l(){const t=c.find("#topicId");return t.length&&t.val()?t.val():ajaxify.data.template.topic&&ajaxify.data.tid}function r(){if(!c)return;const t=l();o.pids.length?t&&parseInt(t,10)!==parseInt(p,10)?i.get("/topics/"+t,{}).then((function(t){if(!t||!t.tid)return e.error("[[error:no-topic]]");if(t.scheduled)return e.error("[[error:cant-move-posts-to-scheduled]]");const i=n.compile("topic:x-posts-will-be-moved-to-y",o.pids.length,t.title);c.find("#pids").translateHtml(i)})):c.find("#pids").translateHtml("[[topic:x-posts-selected, "+o.pids.length+"]]"):c.find("#pids").translateHtml("[[topic:no-posts-selected]]")}function f(){if(!c)return;const t=l();o.pids.length&&t&&parseInt(t,10)!==parseInt(p,10)?a.removeAttr("disabled"):a.attr("disabled",!0),r()}function u(){f()}function m(o){o.tid&&Promise.all(o.pids.map((t=>i.put(`/posts/${t}/move`,{tid:o.tid})))).then((()=>{o.pids.forEach((function(o){t.get("post","pid",o).fadeOut(500,(function(){$(this).remove()}))})),g()})).catch(e.error)}function g(){c&&(c.remove(),c=null,o.disable(),$(window).off("action:ajaxify.end",d))}return s.init=function(t){c||(p=ajaxify.data.tid,app.parseAndTranslate("modals/move-post",{},(function(n){c=n,a=c.find("#move_posts_confirm"),$("body").append(c),c.find(".close,#move_posts_cancel").on("click",g),c.find("#topicId").on("keyup",utils.debounce(f,200)),o.init(u),r(),t&&o.togglePostSelection(t,t.attr("data-pid")),$(window).off("action:ajaxify.end",d).on("action:ajaxify.end",d),a.on("click",(function(){const t=l();if(!t)return;a.attr("disabled",!0);const n={pids:o.pids.slice(),tid:t};if(config.undoTimeout>0)return e.alert({alert_id:"pids_move_"+o.pids.join("-"),title:"[[topic:thread_tools.move-posts]]",message:"[[topic:topic_move_posts_success]]",type:"success",timeout:1e4,timeoutfn:function(){m(n)},clickfn:function(t,o){delete o.timeoutfn,e.success("[[topic:topic_move_posts_undone]]"),a.removeAttr("disabled")}});m(n)}))})))},s}.apply(o,e))||(t.exports=i)},3547:(t,o,n)=>{var e,i;e=[n(7237)],void 0===(i=function(t){const o={};let n;o.pids=[];let e=!1;function i(t){t.stopPropagation();const n=$(this).attr("data-pid"),i=$('[component="topic"] [data-pid="'+n+'"]');(e||0!==parseInt($(this).attr("data-index"),10))&&o.togglePostSelection(i,n)}function s(){return!1}return o.init=function(t,c){o.pids.length=0,n=t,e=(c=c||{}).allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',i),$("#content").on("click",'[component="post"] button, [component="post"] a',s)},o.disable=function(){o.pids.forEach((function(o){t.get("post","pid",o).toggleClass("bg-success",!1)})),$("#content").off("click",'[component="topic"] [component="post"]',i),$("#content").off("click",'[component="post"] button, [component="post"] a',s)},o.togglePostSelection=function(t,e){if(e){const i=o.pids.indexOf(e);-1===i?(o.pids.push(e),t.toggleClass("bg-success",!0)):(o.pids.splice(i,1),t.toggleClass("bg-success",!1)),o.pids.length&&o.pids.sort((function(t,o){return t-o})),"function"==typeof n&&n()}},o}.apply(o,e))||(t.exports=i)}}]);