"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[7673],{66370:(t,e,i)=>{var a,s;a=[i(59006),i(31369),i(85233),i(62526)],void 0===(s=function(t,e,i){let a;const s={types:["sorted-list"],use:function(){a=this},set:function(t,e){const i=t.attr("data-sorted-list");e[i]=[],t.find('[data-type="item"]').each((function(t,s){const d=$(s).attr("data-sorted-list-uuid"),r=a.helper.serializeForm($('[data-sorted-list-object="'+i+'"][data-sorted-list-uuid="'+d+'"]'));o(r),e[i].push(r)}))},get:async(a,o)=>{const{listEl:r,key:n,formTpl:l,formValues:c}=await i.fire("filter:settings.sorted-list.load",{listEl:a.find('[data-type="list"]'),key:a.attr("data-sorted-list"),formTpl:a.attr("data-form-template"),formValues:{}}),f=await t.render(l,c);$('[data-sorted-list="'+n+'"] [data-type="add"]').on("click",(function(){const t=e.confirm(f,(function(e){e&&s.addItem(t.find("form").children(),a)}));i.fire("action:settings.sorted-list.modal",{modal:t})}));const u=a.parents("form").attr("data-socket-get"),m=ajaxify.data[u?o:"settings"][n];if(Array.isArray(m)&&"string"!=typeof m[0]){const t=await Promise.all(m.map((async t=>{({item:t}=await i.fire("filter:settings.sorted-list.loadItem",{item:t}));const e=utils.generateUUID(),a=$(f).deserialize(t);return a.attr("data-sorted-list-uuid",e),a.attr("data-sorted-list-object",n),$("#content").append(a.hide()),{itemUUID:e,item:t}})));for(const{itemUUID:e,item:s}of t)await d(a,e,s),i.fire("action:settings.sorted-list.itemLoaded",{element:r.get(0)});i.fire("action:settings.sorted-list.loaded",{containerEl:a.get(0),listEl:r.get(0),hash:o,key:n})}r.sortable().addClass("pointer")},addItem:async(t,e)=>{const s=e.attr("data-sorted-list"),o=utils.generateUUID(),r=$('<form class="" data-sorted-list-uuid="'+o+'" data-sorted-list-object="'+s+'"></form>');r.append(t),$("#content").append(r.hide());let n=a.helper.serializeForm(r);({item:n}=await i.fire("filter:settings.sorted-list.loadItem",{item:n})),d(e,o,n)}};function d(t,s,r,n){const l=t.find('[data-type="list"]'),c=t.attr("data-item-template");return o(r),new Promise((f=>{app.parseAndTranslate(c,r,(function(r){r=$(r),n?n.replaceWith(r):l.append(r),r.attr("data-sorted-list-uuid",s),function(t,e){t.find('[data-sorted-list-uuid="'+e+'"] [data-type="remove"]').on("click",(function(){$('[data-sorted-list-uuid="'+e+'"]').remove()}))}(t,s),function(t,s){const r=t.find('[data-type="list"]'),n=t.attr("data-sorted-list");$('[data-sorted-list-uuid="'+s+'"] [data-type="edit"]').on("click",(function(){const l=$('[data-sorted-list-uuid="'+s+'"][data-sorted-list-object="'+n+'"]'),c=l.clone(!0).show();c.find("select").each(((t,e)=>{e.value=l.find(`select#${e.id}`).val()}));const f=e.confirm(c,(async e=>{if(e){const e=$('<form class="" data-sorted-list-uuid="'+s+'" data-sorted-list-object="'+n+'"></form>');e.append(f.find("form").children()),$("#content").find('[data-sorted-list-uuid="'+s+'"][data-sorted-list-object="'+n+'"]').remove(),$("#content").append(e.hide());let l=a.helper.serializeForm(e);({item:l}=await i.fire("filter:settings.sorted-list.loadItem",{item:l})),o(l);const c=r.find('[data-sorted-list-uuid="'+s+'"]');d(t,s,l,c)}}));i.fire("action:settings.sorted-list.modal",{modal:f})}))}(t,s),i.fire("action:settings.sorted-list.parse",{itemHtml:r}),f()}))}))}function o(t){return Object.entries(t||{}).forEach((([e,i])=>{t[e]="string"==typeof i?utils.stripHTMLTags(i,utils.stripTags):i}))}return s}.apply(e,a))||(t.exports=s)}}]);