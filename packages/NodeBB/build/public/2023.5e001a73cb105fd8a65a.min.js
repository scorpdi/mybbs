"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2023,3564],{62023:(e,t,o)=>{var a,s;a=[o(74344),o(31369),o(7927),o(50431),o(59006),o(32230),o(62526)],void 0===(s=function(e,t,a,s,r,l){const n={get:t=>e.get(`/topics/${t}/thumbs`,{}),getByPid:t=>e.get(`/posts/${t}`,{}).then((e=>n.get(e.tid))),delete:(t,o)=>e.del(`/topics/${t}/thumbs`,{path:o}),deleteAll:e=>{n.get(e).then((t=>{Promise.all(t.map((t=>n.delete(e,t.url))))}))},upload:e=>new Promise((t=>{s.show({title:"[[topic:composer.thumb_title]]",method:"put",route:config.relative_path+`/api/v3/topics/${e}/thumbs`},(function(e){t(e)}))})),modal:{}};return n.modal.open=function(e){const{id:a,pid:s}=e;let d,{modal:i}=e;return new Promise((u=>{Promise.all([n.get(a),s?n.getByPid(s):[]]).then((e=>new Promise((t=>{const o=e.reduce(((e,t)=>e.concat(t)));d=o.length,t(o)})))).then((e=>r.render("modals/topic-thumbs",{thumbs:e}))).then((s=>{i?l.translate(s,(function(e){i.find(".bootbox-body").html(e),n.modal.handleSort({modal:i,numThumbs:d})})):(i=t.dialog({title:"[[modules:thumbs.modal.title]]",message:s,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(n.upload(a).then((()=>{n.modal.open({...e,modal:i}),Promise.all([o.e(4074),o.e(2143),o.e(5482),o.e(1521),o.e(6918)]).then((function(){var e=[o(44541)];(e=>{e.updateThumbCount(a,$(`[component="composer"][data-uuid="${a}"]`)),u()}).apply(null,e)})).catch(o.oe)})),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),n.modal.handleDelete({...e,modal:i}),n.modal.handleSort({modal:i,numThumbs:d}))}))}))},n.modal.handleDelete=o=>{o.modal.get(0).addEventListener("click",(s=>{s.target.closest('button[data-action="remove"]')&&t.confirm("[[modules:thumbs.modal.confirm-remove]]",(t=>{if(!t)return;const r=s.target.closest(".media[data-id]").getAttribute("data-id"),l=s.target.closest(".media[data-path]").getAttribute("data-path");e.del(`/topics/${r}/thumbs`,{path:l}).then((()=>{n.modal.open(o)})).catch(a.error)}))}))},n.modal.handleSort=({modal:e,numThumbs:t})=>{if(t>1){const t=e.find(".topic-thumbs-modal");t.sortable({items:"[data-id]"}),t.on("sortupdate",n.modal.handleSortChange)}},n.modal.handleSortChange=(t,o)=>{const s=o.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(s).forEach(((t,o)=>{const s=t.getAttribute("data-id");let r=t.getAttribute("data-path");r=r.replace(new RegExp(`^${config.upload_url}`),""),e.put(`/topics/${s}/thumbs/order`,{path:r,order:o}).catch(a.error)}))},n}.apply(t,a))||(e.exports=s)},50431:(e,t,o)=>{var a,s;a=[o(86569)],s=function(){const e={};function t(t,o,a){e.hideAlerts(t),"error"===o&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),t.find("#alert-"+o).translateText(a).removeClass("hide")}function o(e){if("string"==typeof e)try{return $.parseJSON(e)}catch(e){return{error:"[[error:parse-error]]"}}return e}return e.show=function(o,a){const s=!(!o.hasOwnProperty("fileSize")||void 0===o.fileSize)&&parseInt(o.fileSize,10);app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:!o.hasOwnProperty("showHelp")||void 0===o.showHelp||o.showHelp,fileSize:s,title:o.title||"[[global:upload_file]]",description:o.description||"",button:o.button||"[[global:upload]]",accept:o.accept?o.accept.replace(/,/g,"&#44; "):""},(function(r){r.modal("show"),r.on("hidden.bs.modal",(function(){r.remove()}));const l=r.find("#uploadForm");l.attr("action",o.route),l.find("#params").val(JSON.stringify(o.params)),r.find("#fileUploadSubmitBtn").on("click",(function(){$(this).addClass("disabled"),l.submit()})),l.submit((function(){return function(o,a,s){t(o,"status","[[uploads:uploading-file]]"),o.find("#upload-progress-bar").css("width","0%"),o.find("#upload-progress-box").show().removeClass("hide");const r=o.find("#fileInput");return r.val()?(l=r[0],n=a,!window.FileReader||!n||l.files[0].size<=1e3*n?void e.ajaxSubmit(o,s):t(o,"error","[[error:file-too-big, "+a+"]]")):t(o,"error","[[uploads:select-file-to-upload]]");var l,n}(r,s,a),!1}))}))},e.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")},e.ajaxSubmit=function(a,s){a.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=o(e),t(a,"error",e.responseJSON?e.responseJSON.error||e.statusText:"error uploading, code : "+e.status)},uploadProgress:function(e,t,o,s){a.find("#upload-progress-bar").css("width",s+"%")},success:function(r){let l=o(r);r.hasOwnProperty("response")&&r.hasOwnProperty("status")&&"ok"===r.status.code&&(l=r.response.images),s(l[0].url),t(a,"success","[[uploads:upload-success]]"),setTimeout((function(){e.hideAlerts(a),a.modal("hide")}),750)}})},e}.apply(t,a),void 0===s||(e.exports=s)}}]);