(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2545,7214,6503,1762,3014,6623,9286,8529,8042,71,2550,999,831,7927],{22626:(e,t,n)=>{"use strict";var o,a;o=[n(24987),n(18487),n(7237),n(38565),n(98192),n(32230),n(74344),n(22568),n(50548),n(31369),n(7927)],void 0===(a=function(e,t,o,a,i,r,s,c,l,d,u){const p={};let f;function g(){r.translate("[[groups:remove_group_cover_confirm]]",(function(e){d.confirm(e,(function(e){e&&socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},(function(e){e?u.error(e):ajaxify.refresh()}))}))}))}return p.init=function(){const t=o.get("groups/container");f=ajaxify.data.group.name,ajaxify.data.group.isOwner&&(p.prepareSettings(),a.init(o.get("groups/cover"),(function(e,t,n){socket.emit("groups.cover.update",{groupName:f,imageData:e,position:t},n)}),(function(){i.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"groupName",paramValue:f},(function(e){e=(e.startsWith("http")?"":config.relative_path)+e+"?"+Date.now(),o.get("groups/cover").css("background-image","url("+e+")")}))}),g)),e.init(),function(){if(!ajaxify.data.group.isOwner)return;const e=$('[component="groups/members/invite"]');n.e(6193).then((function(){var t=[n(86193)];(function(t){t.user(e,(function(e,t){socket.emit("groups.issueInvite",{toUid:t.item.user.uid,groupName:ajaxify.data.group.name},(function(e){if(e)return u.error(e);ajaxify.refresh()}))}))}).apply(null,t)})).catch(n.oe),$('[component="groups/members/bulk-invite-button"]').on("click",(function(){const e=$('[component="groups/members/bulk-invite"]').val();return!!e&&(socket.emit("groups.issueMassInvite",{usernames:e,groupName:ajaxify.data.group.name},(function(e){if(e)return u.error(e);ajaxify.refresh()})),!1)}))}(),o.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-responsive"),t.on("click","[data-action]",(function(){const e=$(this),t=e.parents("[data-uid]"),n=t.find(".member-name > i"),o=!n.hasClass("invisible"),a=t.attr("data-uid"),i=e.attr("data-action");switch(i){case"toggleOwnership":s[o?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${a}`,{}).then((()=>{n.toggleClass("invisible")})).catch(u.error);break;case"kick":r.translate("[[groups:details.kick_confirm]]",(function(e){d.confirm(e,(function(e){e&&s.del(`/groups/${ajaxify.data.group.slug}/membership/${a}`,void 0).then((()=>t.slideUp().remove())).catch(u.error)}))}));break;case"update":p.update();break;case"delete":p.deleteGroup();break;case"join":s.put("/groups/"+ajaxify.data.group.slug+"/membership/"+(a||app.user.uid),void 0).then((()=>ajaxify.refresh())).catch(u.error);break;case"leave":s.del("/groups/"+ajaxify.data.group.slug+"/membership/"+(a||app.user.uid),void 0).then((()=>ajaxify.refresh())).catch(u.error);break;case"accept":case"reject":case"issueInvite":case"rescindInvite":case"acceptInvite":case"rejectInvite":case"acceptAll":case"rejectAll":socket.emit("groups."+i,{toUid:a,groupName:f},(function(e){e?u.error(e):ajaxify.refresh()}))}}))},p.prepareSettings=function(){const e=o.get("groups/settings"),n=e.find('[name="labelColor"]'),a=e.find('[name="textColor"]'),i=e.find('[data-action="icon-select"]'),r=e.find(".label"),s=e.find(".label-text"),c=r.find("i"),d=e.find('[name="userTitle"]'),u=e.find('[name="userTitleEnabled"]'),p=e.find('[name="icon"]');n.on("input",(function(){r.css("background-color",n.val())})),a.on("input",(function(){r.css("color",a.val())})),i.on("click",(function(){t.init(c,(function(){p.val(c.val())}))})),d.on("keyup",(function(){s.translateText(this.value||e.find("#name").val())})),u.on("change",(function(){const e=o.get("groups/userTitleOption");this.checked?(e.removeAttr("disabled"),r.removeClass("hide")):(e.attr("disabled","disabled"),r.addClass("hide"))}));const f=l.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(e){let t=($("#memberPostCids").val()||"").split(",").map((e=>parseInt(e,10)));t.push(e.cid),t=t.filter(((e,t,n)=>n.indexOf(e)===t)),$("#memberPostCids").val(t.join(",")),f.selectCategory(0)}})},p.update=function(){const e=o.get("groups/settings"),t=e.find('input[type="checkbox"][name]');if(e.length){const n=e.serializeObject();Array.isArray(n.memberPostCids)||(n.memberPostCids=$("#memberPostCids").val()),t.each((function(e,t){(t=$(t)).length&&(n[t.attr("name")]=t.prop("checked"))})),s.put(`/groups/${ajaxify.data.group.slug}`,n).then((()=>{if(n.name){let e=window.location.pathname;e=e.slice(1,e.lastIndexOf("/")+1),ajaxify.go(e+c(n.name))}else ajaxify.refresh();u.success("[[groups:event.updated]]")})).catch(u.error)}},p.deleteGroup=function(){d.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(f),(function(e){e&&d.prompt("Please enter the name of this group in order to delete it:",(function(e){e===f&&s.del(`/groups/${ajaxify.data.group.slug}`,{}).then((()=>{u.success("[[groups:event.deleted, "+utils.escapeHTML(f)+"]]"),ajaxify.go("groups")})).catch(u.error)}))}))},p}.apply(t,o))||(e.exports=a)},24987:(e,t,n)=>{"use strict";var o,a;o=[n(74344),n(31369),n(7927)],void 0===(a=function(e,t,n){const o={};let a,i,r;function s(e,t){app.parseAndTranslate(r,"group.members",{group:{members:e,isOwner:ajaxify.data.group.isOwner}},t)}return o.init=function(o){r=o||"groups/details",i=ajaxify.data.group.name,$('[component="groups/members/add"]').on("click",(function(){app.parseAndTranslate("admin/partials/groups/add-members",{},(function(o){const a=[],r=t.dialog({title:"[[groups:details.add-member]]",message:o,buttons:{ok:{callback:function(){const t=[];r.find("[data-uid][data-selected]").each((function(e,n){t.push(a[$(n).attr("data-uid")])})),function(t,o){function a(){s(t=t.filter((function(e){return!$('[component="groups/members"] [data-uid="'+e.uid+'"]').length})),(function(e){$('[component="groups/members"] tbody').prepend(e)})),r.modal("hide")}const c=t.map((function(e){return e.uid}));"administrators"===i?socket.emit("admin.user.makeAdmins",c,(function(e){if(e)return n.error(e);a()})):Promise.all(c.map((t=>e.put("/groups/"+ajaxify.data.group.slug+"/membership/"+t)))).then(a).catch(n.error)}(t)}}}});r.on("click","[data-username]",(function(){"1"===$(this).attr("data-selected")?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")})),r.find("input").on("keyup",(function(){e.get("/api/users",{query:$(this).val(),paginate:!1},(function(e,t){if(e)return n.error(e);t.users.forEach((function(e){a[e.uid]=e})),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:t.users},(function(e){r.find("#search-result").html(e)}))}))}))}))})),$('[component="groups/members/search"]').on("keyup",(function(){const e=$(this).val();a&&(clearInterval(a),a=0),a=setTimeout((function(){socket.emit("groups.searchMembers",{groupName:i,query:e},(function(e,t){if(e)return n.error(e);s(t.users,(function(e){$('[component="groups/members"] tbody').html(e),$('[component="groups/members"]').attr("data-nextstart",20)}))}))}),250)})),$('[component="groups/members"] tbody').on("scroll",(function(){const e=$(this),t=.9*(e[0].scrollHeight-e.innerHeight());e.scrollTop()>t&&!$('[component="groups/members/search"]').val()&&function(){const e=$('[component="groups/members"]');e.attr("loading")||(e.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:i,after:e.attr("data-nextstart")},(function(t,o){if(t)return n.error(t);var a,i;o&&o.users.length?(a=o.users,i=function(){e.removeAttr("loading"),e.attr("data-nextstart",o.nextStart)},s(a=a.filter((function(e){return!$('[component="groups/members"] [data-uid="'+e.uid+'"]').length})),(function(e){$('[component="groups/members"] tbody').append(e),i()}))):e.removeAttr("loading")})))}()}))},o}.apply(t,o))||(e.exports=a)},7927:(e,t,n)=>{"use strict";var o,a;o=[n(32230),n(7237),n(85233)],a=function(e,t,n){const o={};function a(e,t){e.find("strong").translateHtml(t.title),e.find("p").translateHtml(t.message),e.attr("class","alert alert-dismissable alert-"+t.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),t.timeout&&r(e,t),n.fire("action:alert.update",{alert:e,params:t}),e.off("click").removeClass("pointer"),"function"==typeof t.clickfn&&e.addClass("pointer").on("click",(function(n){$(n.target).is(".close")||t.clickfn(),i(e)}))}function i(e){e.fadeOut(500,(function(){$(this).remove()}))}function r(e,t){const o=t.timeout,a=setTimeout((function(){i(e),"function"==typeof t.timeoutfn&&t.timeoutfn(e,t)}),o);e.attr("timeoutId",a),e.css("transition-property","none"),e.removeClass("animate"),setTimeout((function(){e.css("transition-property",""),e.css("transition","width "+(o+450)+"ms linear, background-color "+(o+450)+"ms ease-in"),e.addClass("animate"),n.fire("action:alert.animate",{alert:e,params:t})}),50),e.on("mouseenter",(function(){$(this).css("transition-duration",0)}))}return o.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:(new Date).getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const o=$("#"+e.alert_id);o.length?a(o,e):function(e){app.parseAndTranslate("alert",e,(function(o){let s=$("#"+e.alert_id);if(s.length)return a(s,e);s=o,s.fadeIn(200),t.get("toaster/tray").prepend(s),"function"==typeof e.closefn&&s.find("button").on("click",(function(){return e.closefn(),i(s),!1})),e.timeout&&r(s,e),"function"==typeof e.clickfn&&s.addClass("pointer").on("click",(function(t){$(t.target).is(".close")||e.clickfn(s,e),i(s)})),n.fire("action:alert.new",{alert:s,params:e})}))}(e)},o.success=function(e,t){o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:t||5e3})},o.error=function(e,t){if("[[error:revalidate-failure]]"===(e=e&&e.message||e))return socket.disconnect(),void app.reconnect();o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:t||1e4})},o.remove=function(e){$("#alert_button_"+e).remove()},o}.apply(t,o),void 0===a||(e.exports=a)},74344:(e,t,n)=>{"use strict";var o,a;o=[n(85233)],void 0===(a=(e=>{const t={},n=config.relative_path+"/api/v3";function o(t,o){async function a(n){({options:t}=await e.fire("filter:api.options",{options:t})),$.ajax(t).done((e=>{n(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})})).fail((e=>{let t;e.responseJSON&&(t=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),n(new Error(t||e.statusText))}))}if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:n+t.url,"function"!=typeof o)return new Promise(((e,t)=>{a((function(n,o){n?t(n):e(o)}))}));a(o)}return t.get=(e,t,n)=>o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n),t.head=(e,t,n)=>o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},n),t.post=(e,t,n)=>o({url:e,method:"post",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.patch=(e,t,n)=>o({url:e,method:"patch",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.put=(e,t,n)=>o({url:e,method:"put",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.del=(e,t,n)=>o({url:e,method:"delete",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.delete=t.del,t}).apply(t,o))||(e.exports=a)},22905:(e,t,n)=>{"use strict";var o,a;o=[n(7927)],void 0===(a=function(e){const t={init:function(t,n){let o=null;(n=n||{}).privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"];let a=[];Array.isArray(n.localCategories)&&(a=n.localCategories.map((e=>({...e})))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const i=t.find('[component="category-selector-search"]');if(!i.length)return;const r=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;function s(e){app.parseAndTranslate(n.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},(function(n){t.find('[component="category/list"]').replaceWith(n.find('[component="category/list"]')),t.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length)}))}t.on("show.bs.dropdown",(function(){function c(){const t=i.find("input").val();var r,c;t.length>1||!t&&!o?(r=t,c=function(e){o=o||e,s(e)},socket.emit("categories.categorySearch",{search:r,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},(function(t,n){if(t)return e.error(t);c(a.concat(n))}))):!t&&o&&(o.forEach((function(e){e.selected=n.selectedCids.includes(e.cid)})),s(o))}r&&(t.find(".dropdown-toggle").addClass("hidden"),i.removeClass("hidden")),i.on("click",(function(e){e.preventDefault(),e.stopPropagation()})),i.find("input").val("").on("keyup",utils.debounce(c,300)),c()})),t.on("shown.bs.dropdown",(function(){i.find("input").focus()})),t.on("hide.bs.dropdown",(function(){r&&(t.find(".dropdown-toggle").removeClass("hidden"),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")}))}};return t}.apply(t,o))||(e.exports=a)},50548:(e,t,n)=>{"use strict";var o,a;o=[n(22905),n(31369),n(85233)],void 0===(a=function(e,t,n){const o={init:function(t,o){if(!t||!t.length)return;const a=(o=o||{}).onSelect||function(){};o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-selector",n.fire("action:category.selector.options",{el:t,options:o}),e.init(t,o);const i={el:t,selectedCategory:null};t.on("click","[data-cid]",(function(){const e=$(this);if(e.hasClass("disabled"))return!1;i.selectCategory(e.attr("data-cid")),a(i.selectedCategory)}));const r=i.el.find('[component="category-selector-selected"]').html();return i.selectCategory=function(e){const t=i.el.find('[data-cid="'+e+'"]');i.selectedCategory={cid:e,name:t.attr("data-name")},t.length?i.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(r)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},i},modal:function(e){(e=e||{}).onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},(function(n){const a=t.dialog({title:e.title||"[[modules:composer.select_category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:r}}}),i=o.init(a.find('[component="category-selector"]'),e);function r(t){return t.preventDefault(),i.selectedCategory&&(e.onSubmit(i.selectedCategory),a.modal("hide")),!1}e.openOnLoad&&a.on("shown.bs.modal",(function(){a.find(".dropdown-toggle").dropdown("toggle")})),a.find("form").on("submit",r)}))}};return o}.apply(t,o))||(e.exports=a)},7237:(e,t,n)=>{"use strict";var o;void 0===(o=function(){const e={};return e.core={"topic/teaser":function(e){return e?$('[component="category/topic"][data-tid="'+e+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(e,t){return $('[component="topic"][data-'+e+'="'+t+'"]')},post:function(e,t){return $('[component="post"][data-'+e+'="'+t+'"]')},"post/content":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/content"]')},"post/header":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/header"]')},"post/anchor":function(e){return $('[component="post"][data-index="'+e+'"] [component="post/anchor"]')},"post/vote-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/vote-count"]')},"post/bookmark-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/bookmark-count"]')},"user/postcount":function(e){return $('[component="user/postcount"][data-uid="'+e+'"]')},"user/reputation":function(e){return $('[component="user/reputation"][data-uid="'+e+'"]')},"category/topic":function(e,t){return $('[component="category/topic"][data-'+e+'="'+t+'"]')},"categories/category":function(e,t){return $('[component="categories/category"][data-'+e+'="'+t+'"]')},"chat/message":function(e){return $('[component="chat/message"][data-mid="'+e+'"]')},"chat/message/body":function(e){return $('[component="chat/message"][data-mid="'+e+'"] [component="chat/message/body"]')},"chat/recent/room":function(e){return $('[component="chat/recent/room"][data-roomid="'+e+'"]')}},e.get=function(){const t=Array.prototype.slice.call(arguments,1);return e.core[arguments[0]]&&t.length?e.core[arguments[0]].apply(this,t):$('[component="'+arguments[0]+'"]')},e}.call(t,n,t,e))||(e.exports=o)},38565:(e,t,n)=>{"use strict";var o,a;o=[n(7927),n(80034)],void 0===(a=function(e){const t={coverEl:null,saveFn:null};function n(t){t.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),e.alert({alert_id:"drag_start",title:"[[modules:cover.dragging_title]]",message:"[[modules:cover.dragging_message]]",timeout:5e3})}return t.init=function(e,o,a,i){t.coverEl=e,t.saveFn=o,e.find(".upload").on("click",a),e.find(".resize").on("click",(function(){n(e)})),e.find(".remove").on("click",i),e.on("dragover",t.onDragOver).on("drop",t.onDrop),e.find(".save").on("click",t.save),e.addClass("initialised")},t.onDragOver=function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},t.onDrop=function(e){e.stopPropagation(),e.preventDefault();const o=e.originalEvent.dataTransfer.files,a=new FileReader;o.length&&o[0].type.match("image.*")&&(a.onload=function(e){t.coverEl.css("background-image","url("+e.target.result+")"),t.newCover=e.target.result},a.readAsDataURL(o[0]),n(t.coverEl))},t.save=function(){t.coverEl.addClass("saving"),t.saveFn(t.newCover||void 0,t.coverEl.css("background-position"),(function(n){n?e.error(n):(t.coverEl.toggleClass("active",0),t.coverEl.backgroundDraggable("disable"),t.coverEl.off("dragover",t.onDragOver),t.coverEl.off("drop",t.onDrop),e.success("[[modules:cover.saved]]")),t.coverEl.removeClass("saving")}))},t}.apply(t,o))||(e.exports=a)},18487:(e,t,n)=>{"use strict";var o,a;o=[n(59006),n(31369)],void 0===(a=function(e,t){return{init:function(n,o){o=o||function(){};const a=n.hasClass("fa-2x");let i=n.attr("class").replace("fa-2x","").replace("fa","").replace(/\s+/g,"");if($("#icons .selected").removeClass("selected"),i)try{$("#icons .fa-icons .fa."+i).addClass("selected")}catch(e){i=""}e.render("partials/fontawesome",{}).then((function(e){(e=$(e)).find(".fa-icons").prepend($('<i class="fa fa-nbb-none"></i>'));const r=t.dialog({onEscape:!0,backdrop:!0,show:!1,message:e,title:"Select an Icon",buttons:{noIcon:{label:"No Icon",className:"btn-default",callback:function(){n.attr("class","fa "+(a?"fa-2x ":"")),n.val(""),n.attr("value",""),o(n)}},success:{label:"Select",className:"btn-primary",callback:function(){const e=$(".bootbox .selected").attr("class"),t=$("<div></div>").addClass(e).removeClass("fa").removeClass("selected").attr("class"),i=r.find("input").val();t?(n.attr("class","fa "+(a?"fa-2x ":"")+t),n.val(t),n.attr("value",t)):i&&(n.attr("class",i),n.val(i),n.attr("value",i)),o(n)}}}});r.on("show.bs.modal",(function(){const e=$(this),t=e.find("input");i&&(e.find("."+i).addClass("selected"),t.val(i.replace("fa-","")))})).modal("show"),r.on("shown.bs.modal",(function(){const e=$(this),t=e.find("input"),n=e.find(".fa-icons i"),o=e.find("button.btn-primary");function a(n){e.find("i.selected").removeClass("selected"),n?n.addClass("selected"):0===t.val().length?i&&e.find("."+i).addClass("selected"):e.find("i:visible").first().addClass("selected")}t.selectRange(0,t.val().length),e.find(".icon-container").on("click","i",(function(){t.val($(this).attr("class").replace("fa fa-","").replace("selected","")),a($(this))})),t.on("keyup",(function(e){13!==e.keyCode?(n.show(),n.each((function(e,n){n.className.match(new RegExp("^fa fa-.*"+t.val()+".*$"))||$(n).hide()})),a()):o.click()}))}))}))}}}.apply(t,o))||(e.exports=a)},98192:(e,t,n)=>{"use strict";var o,a;o=[n(7927)],a=function(e){const t={};function o(t,n){let o;try{o=n.imageType?t.getCroppedCanvas().toDataURL(n.imageType):t.getCroppedCanvas().toDataURL()}catch(t){return void(-1!==["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(t.message)?e.error("[[error:cors-error]]"):e.error(t.message))}return o}return t.show=function(e,o){const a=!(!e.hasOwnProperty("fileSize")||void 0===e.fileSize)&&parseInt(e.fileSize,10);app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:!e.hasOwnProperty("showHelp")||void 0===e.showHelp||e.showHelp,fileSize:a,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},(function(a){a.modal("show"),a.on("hidden.bs.modal",(function(){a.remove()}));const i=a.find("#uploadForm");e.route&&i.attr("action",e.route),a.find("#fileUploadSubmitBtn").on("click",(function(){return $(this).addClass("disabled"),e.uploadModal=a,function(e,o){function a(t,n){"error"===t&&e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),e.uploadModal.find("#alert-"+t).translateText(n).removeClass("hide")}const i=e.uploadModal.find("#fileInput");if(!i.val())return a("error","[[uploads:select-file-to-upload]]");const r=i[0].files[0],s=!(!e.hasOwnProperty("fileSize")||void 0===e.fileSize)&&parseInt(e.fileSize,10);if(s&&r.size>1024*s)return a("error","[[error:file-too-big, "+s+"]]");if(r.name.endsWith(".gif"))return void n.e(3564).then((function(){var t=[n(50431)];(function(t){t.ajaxSubmit(e.uploadModal,o)}).apply(null,t)})).catch(n.oe);const c=new FileReader;c.addEventListener("load",(function(){const n=c.result;e.uploadModal.modal("hide"),t.handleImageCrop({url:n,imageType:r.type,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},o)}),!1),r&&c.readAsDataURL(r)}(e,o),!1}))}))},t.handleImageCrop=function(t,a){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(t.url)},(async function(i){i.modal({backdrop:"static"}).modal("show");const r=parseInt($(window).height()/2,10),s=document.getElementById("cropped-image");$(s).css("max-height",r);let c=new(0,(await n.e(1649).then(n.t.bind(n,33129,23))).default)(s,{aspectRatio:t.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){t.restrictImageDimension&&(c.cropBoxData.width>t.imageDimension&&c.setCropBoxData({width:t.imageDimension}),c.cropBoxData.height>t.imageDimension&&c.setCropBoxData({height:t.imageDimension}))},ready:function(){if(!o(c,t))return i.modal("hide");if(t.restrictImageDimension){const e=s.width<s.height?s.width:s.height,n=e>t.imageDimension?t.imageDimension:e;c.setCropBoxData({width:n,height:n})}i.find(".rotate").on("click",(function(){const e=this.getAttribute("data-degrees");c.rotate(e)})),i.find(".flip").on("click",(function(){const e=this.getAttribute("data-option");"scaleX"===this.getAttribute("data-method")?c.scaleX(e):c.scaleY(e),this.setAttribute("data-option",-1*e)})),i.find(".reset").on("click",(function(){c.reset()})),i.find(".crop-btn").on("click",(function(){$(this).addClass("disabled");const n=o(c,t);n&&(i.find("#upload-progress-bar").css("width","0%"),i.find("#upload-progress-box").show().removeClass("hide"),function(t,n){const o={};o[t.data.paramName]=t.data.paramValue,o.method=t.data.socketMethod,o.size=t.imageData.length,o.progress=0;const a=1e5;!function i(){const r=t.imageData.slice(o.progress,o.progress+a);socket.emit("uploads.upload",{chunk:r,params:o},(function(s,c){return s?e.error(s):o.progress+a<o.size?(o.progress+=r.length,t.progressBarEl.css("width",(o.progress/o.size*100).toFixed(2)+"%"),setTimeout(i,100)):(t.progressBarEl.css("width","100%"),void n(null,c))}))}()}({data:t,imageData:n,progressBarEl:i.find("#upload-progress-bar")},(function(t,n){if(t)return i.find("#upload-progress-box").hide(),i.find(".upload-btn").removeClass("disabled"),i.find(".crop-btn").removeClass("disabled"),e.error(t);a(n.url),i.modal("hide")})))})),i.find(".upload-btn").on("click",(async function(){$(this).addClass("disabled"),c.destroy();const e=(await n.e(1649).then(n.t.bind(n,33129,23))).default;c=new e(s,{viewMode:1,autoCropArea:1,ready:function(){i.find(".crop-btn").trigger("click")}})}))}})}))},t}.apply(t,o),void 0===a||(e.exports=a)},22568:(e,t,n)=>{"use strict";var o,a,i;a=[n(20648)],void 0===(i="function"==typeof(o=function(e){const t=e("[^\\p{L}\\s\\d\\-_]","g"),n=/[^\w\s\d\-_]/g,o=/^\s+|\s+$/g,a=/\s+/g,i=/-+/g,r=/-$/g,s=/^-/g,c=/^[\w\d\s.,\-@]+$/;return function(l,d){return l?(l=String(l).replace(o,""),l=c.test(l)?l.replace(n,"-"):e.replace(l,t,"-"),l=(l=(l=(l=(l=d?l:l.toLocaleLowerCase()).replace(a,"-")).replace(i,"-")).replace(r,"")).replace(s,"")):""}})?o.apply(t,a):o)||(e.exports=i)},80034:()=>{!function(e){var t=e(window),n=function(e,t,n,o){if(3===arguments.length||o){if(n<e)return e;if(n>t)return t}return n},o=function(e){e.clientX=e.originalEvent.touches[0].clientX,e.clientY=e.originalEvent.touches[0].clientY};function a(e,t){this.element=e,this.options=t,this.init()}a.prototype.init=function(){var a=e(this.element),i=(a.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],r=this.options;if(i){var s={width:0,height:0};(r.bound||"percent"==r.units)&&(s=function(e){var t=(e.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(t){var n={width:0,height:0},o=new Image;return o.onload=function(){if("cover"==e.css("background-size")){var t=e.innerWidth(),a=e.innerHeight(),i=t/a;imageAspectRatio=o.width/o.height,scale=1,imageAspectRatio>=i?scale=a/o.height:scale=t/o.width,n.width=o.width*scale,n.height=o.height*scale}else n.width=o.width,n.height=o.height},o.src=t,n}}(a)),a.on("mousedown.dbg touchstart.dbg",(function(e){if(e.target===a[0]){if(e.preventDefault(),e.originalEvent.touches)o(e);else if(1!==e.which)return;var i=e.clientX,c=e.clientY,l=a.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],d=parseInt(l[1])||0,u=parseInt(l[2])||0;"percent"==r.units&&(d=Math.round(d/-200*s.width),u=Math.round(u/-200*s.height)),t.on("mousemove.dbg touchmove.dbg",(function(e){e.preventDefault(),e.originalEvent.touches&&o(e);var t=e.clientX,l=e.clientY;"percent"==r.units?(d="y"===r.axis?d:n(-s.width/2,0,d+t-i,r.bound),u="x"===r.axis?u:n(-s.height/2,0,u+l-c,r.bound),a.css("background-position",d/s.width*-200+"% "+u/s.height*-200+"%")):(d="y"===r.axis?d:n(a.innerWidth()-s.width,0,d+t-i,r.bound),u="x"===r.axis?u:n(a.innerHeight()-s.height,0,u+l-c,r.bound),a.css("background-position",d+"px "+u+"px")),i=t,c=l})),t.on("mouseup.dbg touchend.dbg mouseleave.dbg",(function(){r.done&&r.done(),t.off("mousemove.dbg touchmove.dbg"),t.off("mouseup.dbg touchend.dbg mouseleave.dbg")}))}}))}},a.prototype.disable=function(){e(this.element).off("mousedown.dbg touchstart.dbg"),t.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},e.fn.backgroundDraggable=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each((function(){var o=e(this);if(void 0===t||"object"==typeof t){var i=new a(this,t=e.extend({},e.fn.backgroundDraggable.defaults,t));o.data("dbg",i)}else"string"==typeof t&&o.data("dbg")&&(i=o.data("dbg"),a.prototype[t].apply(i,n))}))},e.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}}(jQuery)}}]);