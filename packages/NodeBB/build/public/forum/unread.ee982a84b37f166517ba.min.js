"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8709,1237,8704],{4695:(e,t,n)=>{var o;void 0===(o=function(){const e={};function t(e){n("/unread",e.unreadTopicCount),n("/unread?filter=new",e.unreadNewTopicCount),n("/unread?filter=watched",e.unreadWatchedTopicCount),n("/unread?filter=unreplied",e.unreadUnrepliedTopicCount)}function n(e,t){utils.isNumber(t)&&($('a[href="'+config.relative_path+e+'"].navigation-link i').toggleClass("unread-count",t>0).attr("data-content",t>99?"99+":t),$('#mobile-menu [data-unread-url="'+e+'"]').attr("data-content",t>99?"99+":t))}return e.initUnreadTopics=function(){const e=app.user.unreadData;function o(t){if(t&&t.posts&&t.posts.length&&e){const n=t.posts[0];if(parseInt(n.uid,10)===parseInt(app.user.uid,10)||!n.topic.isFollowing&&3!==n.categoryWatchState)return;const o=n.topic.tid;e[""][o]&&e.new[o]&&e.watched[o]&&e.unreplied[o]||function(e){$('[data-tid="'+e+'"]').addClass("unread")}(o),e[""][o]||(i(""),e[""][o]=!0),n.isMain&&parseInt(n.uid,10)!==parseInt(app.user.uid,10)&&!e.new[o]&&(i("new"),e.new[o]=!0),parseInt(n.topic.postcount,10)<=1&&!e.unreplied[o]&&(i("unreplied"),e.unreplied[o]=!0),n.topic.isFollowing&&!e.watched[o]&&(i("watched"),e.watched[o]=!0)}}function i(e){const t="/unread"+(e?"?filter="+e:"");n(t,1+parseInt($('a[href="'+config.relative_path+t+'"].navigation-link i').attr("data-content"),10))}$(window).on("action:ajaxify.end",(function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach((function(t){delete e[t][ajaxify.data.tid]}))})),socket.removeListener("event:new_post",o),socket.on("event:new_post",o),socket.removeListener("event:unread.updateCount",t),socket.on("event:unread.updateCount",t)},e.updateUnreadTopicCount=n,e}.call(t,n,t,e))||(e.exports=o)},73713:(e,t,n)=>{var o,i;o=[n(4695),n(69941),n(7237),n(14745),n(50548),n(7927)],void 0===(i=function(e,t,n,o,i,a){const c={};function r(e){!function(e){for(let t=0;t<e.length;t+=1)n.get("category/topic","tid",e[t]).remove()}(e),a.success("[[unread:topics_marked_as_read.success]]"),$('[component="category"]').children().length||($("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden"))}return c.init=function(){app.enterRoom("unread_topics"),function(){const e=i.init($('[component="category-selector"]'),{onSelect:function(o){e.selectCategory(0),"all"===o.cid?socket.emit("topics.markAllRead",(function(e){if(e)return a.error(e);a.success("[[unread:topics_marked_as_read.success]]"),$('[component="category"]').empty(),$('[component="pagination"]').addClass("hidden"),$("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden")})):"selected"===o.cid?function(){const e=t.getSelectedTids();e.length&&socket.emit("topics.markAsRead",e,(function(t){if(t)return a.error(t);r(e)}))}():parseInt(o.cid,10)>0&&function(e){const t=function(e){const t=[];return n.get("category/topic","cid",e).each((function(){t.push($(this).attr("data-tid"))})),t}(e);socket.emit("topics.markCategoryTopicsRead",e,(function(e){if(e)return a.error(e);r(t)}))}(o.cid)},selectCategoryLabel:ajaxify.data.selectCategoryLabel||"[[unread:mark_as_read]]",localCategories:[{cid:"selected",name:"[[unread:selected]]",icon:""},{cid:"all",name:"[[unread:all]]",icon:""}]})}(),o.init("unread"),e.updateUnreadTopicCount("/"+ajaxify.data.selectedFilter.url,ajaxify.data.topicCount)},c}.apply(t,o))||(e.exports=i)},39941:(e,t,n)=>{var o,i;o=[n(22905),n(74344),n(85233)],void 0===(i=function(e,t,n){const o={init:function(o,i){if(!o||!o.length)return;(i=i||{}).states=i.states||["watching","notwatching","ignoring"],i.template="partials/category-filter",n.fire("action:category.filter.options",{el:o,options:i}),e.init(o,i);let a=[],c=[];Array.isArray(i.selectedCids)?a=i.selectedCids.map((e=>parseInt(e,10))):Array.isArray(ajaxify.data.selectedCids)&&(a=ajaxify.data.selectedCids.map((e=>parseInt(e,10)))),c=a.slice(),o.on("hidden.bs.dropdown",(function(){let e=c.length!==a.length;if(c.forEach((function(t,n){t!==a[n]&&(e=!0)})),e&&function(e,n){function o(t){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:t},(function(t){e.find("button").replaceWith($("<div/>").html(t).find("button"))}))}n.length>1?o({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):1===n.length?t.get(`/categories/${n[0]}`,{}).then(o):o()}(o,a),i.onHidden)i.onHidden({changed:e,selectedCids:a.slice()});else if(e){let e=window.location.pathname;const t=utils.params();a.length&&(t.cid=a,e+="?"+decodeURIComponent($.param(t))),ajaxify.go(e)}})),o.on("click",'[component="category/list"] [data-cid]',(function(){const e=o.find('[component="category/list"]'),t=$(this),n=t.find("a").attr("href");if(n&&"#"!==n&&n.length)return;const c=parseInt(t.attr("data-cid"),10),r=t.find('[component="category/select/icon"]');return a.includes(c)?a.splice(a.indexOf(c),1):a.push(c),a.sort((function(e,t){return e-t})),i.selectedCids=a,r.toggleClass("invisible"),e.find('li[data-all="all"] i').toggleClass("invisible",!!a.length),i.onSelect&&i.onSelect({cid:c,selectedCids:a.slice()}),!1}))}};return o}.apply(t,o))||(e.exports=i)},22905:(e,t,n)=>{var o,i;o=[n(7927)],void 0===(i=function(e){const t={init:function(t,n){let o=null;(n=n||{}).privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"];let i=[];Array.isArray(n.localCategories)&&(i=n.localCategories.map((e=>({...e})))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const a=t.find('[component="category-selector-search"]');if(!a.length)return;const c=a.parent('[component="category/dropdown"]').length>0||a.parent('[component="category-selector"]').length>0;function r(e){app.parseAndTranslate(n.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},(function(n){t.find('[component="category/list"]').replaceWith(n.find('[component="category/list"]')),t.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length)}))}t.on("show.bs.dropdown",(function(){function s(){const t=a.find("input").val();var c,s;t.length>1||!t&&!o?(c=t,s=function(e){o=o||e,r(e)},socket.emit("categories.categorySearch",{search:c,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},(function(t,n){if(t)return e.error(t);s(i.concat(n))}))):!t&&o&&(o.forEach((function(e){e.selected=n.selectedCids.includes(e.cid)})),r(o))}c&&(t.find(".dropdown-toggle").addClass("hidden"),a.removeClass("hidden")),a.on("click",(function(e){e.preventDefault(),e.stopPropagation()})),a.find("input").val("").on("keyup",utils.debounce(s,300)),s()})),t.on("shown.bs.dropdown",(function(){a.find("input").focus()})),t.on("hide.bs.dropdown",(function(){c&&(t.find(".dropdown-toggle").removeClass("hidden"),a.addClass("hidden")),a.off("click"),a.find("input").off("keyup")}))}};return t}.apply(t,o))||(e.exports=i)},50548:(e,t,n)=>{var o,i;o=[n(22905),n(31369),n(85233)],void 0===(i=function(e,t,n){const o={init:function(t,o){if(!t||!t.length)return;const i=(o=o||{}).onSelect||function(){};o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-selector",n.fire("action:category.selector.options",{el:t,options:o}),e.init(t,o);const a={el:t,selectedCategory:null};t.on("click","[data-cid]",(function(){const e=$(this);if(e.hasClass("disabled"))return!1;a.selectCategory(e.attr("data-cid")),i(a.selectedCategory)}));const c=a.el.find('[component="category-selector-selected"]').html();return a.selectCategory=function(e){const t=a.el.find('[data-cid="'+e+'"]');a.selectedCategory={cid:e,name:t.attr("data-name")},t.length?a.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(c)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},a},modal:function(e){(e=e||{}).onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},(function(n){const i=t.dialog({title:e.title||"[[modules:composer.select_category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:c}}}),a=o.init(i.find('[component="category-selector"]'),e);function c(t){return t.preventDefault(),a.selectedCategory&&(e.onSubmit(a.selectedCategory),i.modal("hide")),!1}e.openOnLoad&&i.on("shown.bs.modal",(function(){i.find(".dropdown-toggle").dropdown("toggle")})),i.find("form").on("submit",c)}))}};return o}.apply(t,o))||(e.exports=i)},14745:(e,t,n)=>{var o,i;o=[n(25142),n(66044),n(69941),n(39941),n(29412),n(85233)],void 0===(i=function(e,t,n,o,i,a){const c={};let r,s,d="",l=0,p=0;const u=[];function f(e){const t=ajaxify.data,n=t.selectedCids&&t.selectedCids.length&&-1===t.selectedCids.indexOf(parseInt(e.cid,10)),o=t.selectedFilter&&"watched"===t.selectedFilter.filter,i=t.template.category&&parseInt(t.cid,10)!==parseInt(e.cid,10),c=!!(n||o||i||u.includes(e.tid));a.fire("filter:topicList.onNewTopic",{topic:e,preventAlert:c}).then((t=>{t.preventAlert||(e.scheduled&&e.tid&&u.push(e.tid),l+=1,h())}))}function g(e){const t=e.posts[0];if(!t||!t.topic||t.topic.isFollowing)return;const n=ajaxify.data,o=parseInt(t.topic.mainPid,10)===parseInt(t.pid,10),i=n.selectedCids&&n.selectedCids.length&&-1===n.selectedCids.indexOf(parseInt(t.topic.cid,10)),c=n.selectedFilter&&"new"===n.selectedFilter.filter,r=n.selectedFilter&&"watched"===n.selectedFilter.filter&&!t.topic.isFollowing,s=n.template.category&&parseInt(n.cid,10)!==parseInt(t.topic.cid,10),d=!!(o||i||c||r||s);a.fire("filter:topicList.onNewPost",{post:t,preventAlert:d}).then((e=>{e.preventAlert||(p+=1,h())}))}function h(){let e="";0===l?1===p?e="[[recent:there-is-a-new-post]]":p>1&&(e="[[recent:there-are-new-posts, "+p+"]]"):1===l?0===p?e="[[recent:there-is-a-new-topic]]":1===p?e="[[recent:there-is-a-new-topic-and-a-new-post]]":p>1&&(e="[[recent:there-is-a-new-topic-and-new-posts, "+p+"]]"):l>1&&(0===p?e="[[recent:there-are-new-topics, "+l+"]]":1===p?e="[[recent:there-are-new-topics-and-a-new-post, "+l+"]]":p>1&&(e="[[recent:there-are-new-topics-and-new-posts, "+l+", "+p+"]]")),e+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(e).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}function m(t,n,o){o=o||function(){};const i=utils.params();i.page=function(e,t){return Math.floor(e/config.topicsPerPage)+(t>0?1:0)}(t,n),e.loadMoreXhr(i,o)}function y(t,o,i,c,r){if(!o||!o.length)return $("#load-more-btn").hide(),r();if(!(o=function(e){return e.filter((function(e){return!s.find('[component="category/topic"][data-tid="'+e.tid+'"]').length}))}(o)).length)return $("#load-more-btn").hide(),r();let d,l;const p=s.find('[component="category/topic"]');c>0&&o.length?d=p.last():c<0&&o.length&&(l=p.first());const u={topics:o,showSelect:i,template:{name:t}};u.template[t]=!0,a.fire("action:topics.loading",{topics:o,after:d,before:l}),app.parseAndTranslate(t,"topics",u,(function(i){if(s.removeClass("hidden"),$("#category-no-topics").remove(),d&&d.length)i.insertAfter(d);else if(l&&l.length){const e=$(document).height(),t=$(window).scrollTop();i.insertBefore(l),$(window).scrollTop(t+($(document).height()-e))}else s.append(i);n.getSelectedTids().length||e.removeExtra(s.find('[component="category/topic"]'),c,Math.max(60,3*config.topicsPerPage)),i.find(".timeago").timeago(),app.createUserTooltips(i),utils.makeNumbersHumanReadable(i.find(".human-readable-number")),a.fire("action:topics.loaded",{topics:o,template:t}),r()}))}return $(window).on("action:ajaxify.start",(function(){c.removeListeners(),i.removeListeners()})),c.init=function(n,l){s=$('[component="category"]').filter((function(e,t){return!$(t).parents("[widget-area],[data-widget-area]").length})),d=n,r=l||m,i.init(),c.watchForNewPosts();const p=["watching"];ajaxify.data.selectedFilter&&"watched"===ajaxify.data.selectedFilter.filter?p.push("notwatching","ignoring"):"unread"!==n&&p.push("notwatching"),o.init($('[component="category/dropdown"]'),{states:p}),config.usePagination||e.init(c.loadMoreTopics),t.init((function(e,t){r(e,1,(function(e,n){y(d,e.topics,ajaxify.data.showSelect,1,(function(){t(),n()}))}))})),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",(function(){c.loadMoreTopics(1)})),a.fire("action:topics.loaded",{topics:ajaxify.data.topics})},c.watchForNewPosts=function(){$("#new-topics-alert").on("click",(function(){$(this).addClass("hide")})),p=0,l=0,c.removeListeners(),socket.on("event:new_topic",f),socket.on("event:new_post",g)},c.removeListeners=function(){socket.removeListener("event:new_topic",f),socket.removeListener("event:new_post",g)},c.loadMoreTopics=function(e){if(!s.length||!s.children().length)return;const t=s.find('[component="category/topic"]'),n=e>0?t.last():t.first(),o=(parseInt(n.attr("data-index"),10)||0)+(e>0?1:0);!utils.isNumber(o)||0===o&&s.find('[component="category/topic"][data-index="0"]').length||r(o,e,(function(t,n){y(d,t.topics,ajaxify.data.showSelect,e,n)}))},c}.apply(t,o))||(e.exports=i)}}]);