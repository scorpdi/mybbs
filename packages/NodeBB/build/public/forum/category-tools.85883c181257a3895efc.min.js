"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[613,1375,8306],{29412:(t,e,o)=>{var n,i;n=[o(69941),o(60392),o(7237),o(74344),o(31369),o(7927)],void 0===(i=function(t,e,n,i,c,a){const r={};function s(o,n,r,s){s||(s=function(){});const l=t.getSelectedTids(),p={},d=function(t){t&&Promise.all(l.map((t=>i[o](`/topics/${t}${n}`,p)))).then(s).catch(a.error)};if(!l.length)return a.error("[[error:no-topics-selected]]");switch(r){case"delete":case"restore":case"purge":c.confirm(`[[topic:thread_tools.${r}_confirm]]`,d);break;case"pin":e.requestPinExpiry(p,d.bind(null,!0));break;default:d(!0)}}function l(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function p(){l(),t.unselectAll()}function d(){l(),u()}function u(){const e=t.getSelectedTids(),o=g(m,e),i=f(m,e),c=g(k,e),a=g(h,e),r=g(y,e),s=f(y,e);n.get("topic/delete").toggleClass("hidden",o),n.get("topic/restore").toggleClass("hidden",r||!o),n.get("topic/purge").toggleClass("hidden",!i),n.get("topic/lock").toggleClass("hidden",a),n.get("topic/unlock").toggleClass("hidden",!a),n.get("topic/pin").toggleClass("hidden",s||c),n.get("topic/unpin").toggleClass("hidden",s||!c),n.get("topic/merge").toggleClass("hidden",r)}function g(t,e){for(let o=0;o<e.length;o+=1)if(t(e[o]))return!0;return!1}function f(t,e){for(let o=0;o<e.length;o+=1)if(!t(e[o]))return!1;return!0}function m(t){return v(t).hasClass("deleted")}function h(t){return v(t).hasClass("locked")}function k(t){return v(t).hasClass("pinned")}function y(t){return v(t).hasClass("scheduled")}function v(t){return n.get("category/topic","tid",t)}function x(t){const e=v(t.tid);e.toggleClass("deleted",t.isDeleted),e.find('[component="topic/locked"]').toggleClass("hide",!t.isDeleted)}function C(t){const e=v(t.tid);e.toggleClass("pinned",t.isPinned),e.find('[component="topic/pinned"]').toggleClass("hide",!t.isPinned),ajaxify.refresh()}function w(t){const e=v(t.tid);e.toggleClass("locked",t.isLocked),e.find('[component="topic/locked"]').toggleClass("hide",!t.isLocked)}function _(t){v(t.tid).remove()}function b(t){v(t.tid).remove()}return r.init=function(){t.init(u),function(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const t=ajaxify.data.topics.filter((t=>t.pinned)).length;!app.user.isAdmin&&!app.user.isMod||t<2||app.loadJQueryUI((function(){const t=$('[component="category"]').filter((function(t,e){return!$(e).parents("[widget-area],[data-widget-area]").length}));let e=0;t.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){e=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(o,n){socket.emit("topics.orderPinnedTopics",{tid:n.item.attr("data-tid"),order:e+n.item.index()},(function(o){if(o)return a.error(o);t.find('[component="category/topic"].pinned').each(((t,o)=>{$(o).attr("data-index",e+t)}))}))}})}))}(),n.get("topic/delete").on("click",(function(){return s("del","/state","delete",d),!1})),n.get("topic/restore").on("click",(function(){return s("put","/state","restore",d),!1})),n.get("topic/purge").on("click",(function(){return s("del","","purge",d),!1})),n.get("topic/lock").on("click",(function(){return s("put","/lock","lock",p),!1})),n.get("topic/unlock").on("click",(function(){return s("del","/lock","unlock",p),!1})),n.get("topic/pin").on("click",(function(){return s("put","/pin","pin",p),!1})),n.get("topic/unpin").on("click",(function(){return s("del","/pin","unpin",p),!1})),n.get("topic/mark-unread-for-all").on("click",(function(){const e=t.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,(function(t){if(t)return a.error(t);a.success("[[topic:markAsUnreadForAll.success]]"),e.forEach((function(t){$('[component="category/topic"][data-tid="'+t+'"]').addClass("unread")})),p()})),!1):a.error("[[error:no-topics-selected]]")})),n.get("topic/move").on("click",(function(){return o.e(7378).then((function(){var e=[o(57378)];(function(e){const o=t.getSelectedTids();if(!o.length)return a.error("[[error:no-topics-selected]]");e.init(o,null,p)}).apply(null,e)})).catch(o.oe),!1})),n.get("topic/move-all").on("click",(function(){const t=ajaxify.data.cid;if(!ajaxify.data.template.category)return a.error("[[error:invalid-data]]");o.e(7378).then((function(){var e=[o(57378)];(function(e){e.init(null,t,(function(t){if(t)return a.error(t);ajaxify.refresh()}))}).apply(null,e)})).catch(o.oe)})),n.get("topic/merge").on("click",(function(){const e=t.getSelectedTids();o.e(28).then((function(){var t=[o(90028)];(function(t){t.init((function(){e.length&&e.forEach((function(e){t.addTopic(e)}))}))}).apply(null,t)})).catch(o.oe)})),r.removeListeners(),socket.on("event:topic_deleted",x),socket.on("event:topic_restored",x),socket.on("event:topic_purged",b),socket.on("event:topic_locked",w),socket.on("event:topic_unlocked",w),socket.on("event:topic_pinned",C),socket.on("event:topic_unpinned",C),socket.on("event:topic_moved",_)},r.removeListeners=function(){socket.removeListener("event:topic_deleted",x),socket.removeListener("event:topic_restored",x),socket.removeListener("event:topic_purged",b),socket.removeListener("event:topic_locked",w),socket.removeListener("event:topic_unlocked",w),socket.removeListener("event:topic_pinned",C),socket.removeListener("event:topic_unpinned",C),socket.removeListener("event:topic_moved",_)},r}.apply(e,n))||(t.exports=i)},60392:(t,e,o)=>{var n,i;n=[o(7237),o(32230),o(66044),o(60447),o(74344),o(85233),o(31369),o(7927)],void 0===(i=function(t,e,n,i,c,a,r,s){const l={};function p(t,e,o,n){n||(n=function(){});const i=ajaxify.data.tid,a={},p=function(o){o&&c[t](`/topics/${i}${e}`,a).then(n).catch(s.error)};switch(o){case"delete":case"restore":case"purge":r.confirm(`[[topic:thread_tools.${o}_confirm]]`,p);break;case"pin":l.requestPinExpiry(a,p.bind(null,!0));break;default:p(!0)}}return l.init=function(i,l){function d(o,n=1){return c[n?"put":"del"](`/topics/${i}/${o}`,{},(()=>{let c="";"follow"===o?c=n?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":"ignore"===o&&(c=n?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),n||(o="unfollow"),function(o){e.translate({follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"}[o],(function(t){$('[component="topic/watch"] button').attr("title",t).tooltip("fixTitle")}));let n=t.get("topic/following/menu");n.toggleClass("hidden","follow"!==o),t.get("topic/following/check").toggleClass("fa-check","follow"===o),n=t.get("topic/not-following/menu"),n.toggleClass("hidden","unfollow"!==o),t.get("topic/not-following/check").toggleClass("fa-check","unfollow"===o),n=t.get("topic/ignoring/menu"),n.toggleClass("hidden","ignore"!==o),t.get("topic/ignoring/check").toggleClass("fa-check","ignore"===o)}(o),s.alert({alert_id:"follow_thread",message:c,type:"success",timeout:5e3}),a.fire("action:topics.changeWatching",{tid:i,type:o})}),(()=>{s.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})})),!1}l.on("show.bs.dropdown",".thread-tools",(function(){const t=$(this).find(".dropdown-menu");t.html()||(t.toggleClass("hidden",!0),socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},(function(e,o){if(e)return s.error(e);app.parseAndTranslate("partials/topic/topic-menu-list",o,(function(e){t.html(e),t.toggleClass("hidden",!1),a.fire("action:topic.tools.load",{element:t})}))})))})),l.on("click",'[component="topic/delete"]',(function(){return p("del","/state","delete"),!1})),l.on("click",'[component="topic/restore"]',(function(){return p("put","/state","restore"),!1})),l.on("click",'[component="topic/purge"]',(function(){return p("del","","purge"),!1})),l.on("click",'[component="topic/lock"]',(function(){return p("put","/lock","lock"),!1})),l.on("click",'[component="topic/unlock"]',(function(){return p("del","/lock","unlock"),!1})),l.on("click",'[component="topic/pin"]',(function(){return p("put","/pin","pin"),!1})),l.on("click",'[component="topic/unpin"]',(function(){return p("del","/pin","unpin"),!1})),l.on("click",'[component="topic/event/delete"]',(function(){const t=$(this).attr("data-topic-event-id"),e=$(this).parents('[component="topic/event"]');r.confirm("[[topic:delete-event-confirm]]",(o=>{o&&c.del(`/topics/${i}/events/${t}`,{}).then((function(){e.remove()})).catch(s.error)}))})),l.on("click",'[component="topic/mark-unread"]',(function(){return socket.emit("topics.markUnread",i,(function(t){if(t)return s.error(t);app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,(function(){n.onBackClicked(!0)})):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,n.onBackClicked),s.success("[[topic:mark_unread.success]]")})),!1})),l.on("click",'[component="topic/mark-unread-for-all"]',(function(){const t=$(this);return socket.emit("topics.markAsUnreadForAll",[i],(function(e){if(e)return s.error(e);s.success("[[topic:markAsUnreadForAll.success]]"),t.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")})),!1})),l.on("click",'[component="topic/move"]',(function(){return o.e(7378).then((function(){var t=[o(57378)];(function(t){t.init([i],ajaxify.data.cid)}).apply(null,t)})).catch(o.oe),!1})),l.on("click",'[component="topic/delete/posts"]',(function(){o.e(5253).then((function(){var t=[o(55253)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),l.on("click",'[component="topic/fork"]',(function(){o.e(5636).then((function(){var t=[o(25636)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),l.on("click",'[component="topic/move-posts"]',(function(){o.e(3094).then((function(){var t=[o(53094)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),l.on("click",'[component="topic/following"]',(function(){d("follow")})),l.on("click",'[component="topic/not-following"]',(function(){d("follow",0)})),l.on("click",'[component="topic/ignoring"]',(function(){d("ignore")}))},l.requestPinExpiry=function(t,e){app.parseAndTranslate("modals/set-pin-expiry",{},(function(o){const n=r.dialog({title:"[[topic:thread_tools.pin]]",message:o,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let o=n.get(0).querySelector("#expiry").value;if(""===o)return e();o=new Date(o),o&&o.getTime()>Date.now()?(t.expiry=o.getTime(),e()):s.error("[[error:invalid-date]]")}}}})}))},l.setLockedState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;const n=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null),t.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",e.isLocked?null:"");const c=!(!e.isLocked&&!ajaxify.data.deleted||ajaxify.data.privileges.isAdminOrMod);t.get("topic/reply/container").toggleClass("hidden",c),t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",c),o.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",n),o.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",n),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!e.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=e.isLocked,i.addTopicEvents(e.events)},l.setDeleteState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;t.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null),t.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),t.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),t.get("topic/deleted/message").toggleClass("hidden",!e.isDelete),e.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:e.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},(function(e){t.get("topic/deleted/message").replaceWith(e),e.find(".timeago").timeago()}));const n=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/reply/container").toggleClass("hidden",n),t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",n),o.toggleClass("deleted",e.isDelete),ajaxify.data.deleted=e.isDelete?1:0,i.addTopicEvents(e.events)},l.setPinnedState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;t.get("topic/pin").toggleClass("hidden",e.pinned).parent().attr("hidden",e.pinned?"":null),t.get("topic/unpin").toggleClass("hidden",!e.pinned).parent().attr("hidden",e.pinned?null:"");const n=$('[component="topic/labels"] [component="topic/pinned"]');n.toggleClass("hidden",!e.pinned),e.pinned&&n.translateAttr("title",e.pinExpiry&&e.pinExpiryISO?"[[topic:pinned-with-expiry, "+e.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=e.pinned,i.addTopicEvents(e.events)},l}.apply(e,n))||(t.exports=i)},66044:(t,e,o)=>{var n,i;n=[o(7237),o(66603),o(42840),o(78989)],void 0===(i=function(t,e,o,n){const i={};let c;function a(t){const o=t&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||o){let t=e.getItem("category:bookmark"),o=e.getItem("category:bookmark:clicked");if(e.removeItem("category:bookmark"),e.removeItem("category:bookmark:clicked"),!utils.isNumber(t))return;if(t=Math.max(0,parseInt(t,10)||0),o=Math.max(0,parseInt(o,10)||0),config.usePagination){const e=Math.ceil((parseInt(t,10)+1)/config.topicsPerPage);parseInt(e,10)!==ajaxify.data.pagination.currentPage?n.loadPage(e,(function(){i.scrollToTopic(t,o)})):i.scrollToTopic(t,o)}else{if(0===t)return void i.scrollToTopic(t,o);$('[component="category"]').empty(),c(Math.max(0,t-1)+1,(function(){i.scrollToTopic(t,o)}))}}}return i.init=function(t){c=t,$('[component="category"]').on("click",'[component="topic/header"]',(function(){const t=$(this).parents("[data-index]").attr("data-index"),o=$(window).scrollTop();$('[component="category/topic"]').each((function(n,i){if($(i).offset().top-o>0)return e.setItem("category:bookmark",$(i).attr("data-index")),e.setItem("category:bookmark:clicked",t),e.setItem("category:bookmark:offset",$(i).offset().top-o),!1}))})),$(window).off("action:popstate",a).on("action:popstate",a)},i.onBackClicked=a,i.highlightTopic=function(e){const o=t.get("category/topic","index",e);o.length&&!o.hasClass("highlight")&&(o.addClass("highlight"),setTimeout((function(){o.removeClass("highlight")}),5e3))},i.scrollToTopic=function(n,c){if(!utils.isNumber(n))return;const a=t.get("category/topic","index",n);if(a.length){const t=e.getItem("category:bookmark:offset");e.removeItem("category:bookmark:offset"),$(window).scrollTop(a.offset().top-t),i.highlightTopic(c),o.update()}},i}.apply(e,n))||(t.exports=i)},66603:(t,e,o)=>{var n;void 0===(n=function(){function t(){this._store={},this._keys=[]}let e;t.prototype.isMock=!0,t.prototype.setItem=function(t,e){t=String(t),-1===this._keys.indexOf(t)&&this._keys.push(t),this._store[t]=e},t.prototype.getItem=function(t){return t=String(t),-1===this._keys.indexOf(t)?null:this._store[t]},t.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter((function(e){return e!==t})),this._store[t]=null},t.prototype.clear=function(){this._keys=[],this._store={}},t.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(t.prototype,"length",{get:function(){return this._keys.length}});const o=Date.now().toString();try{if(e=window.localStorage,e.setItem(o,o),e.getItem(o)!==o)throw Error("localStorage behaved unexpectedly");return e.removeItem(o),e}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(e=window.sessionStorage,e.setItem(o,o),e.getItem(o)!==o)throw Error("sessionStorage behaved unexpectedly");return e.removeItem(o),e}catch(e){return console.warn(e),console.warn("sessionStorage failed, falling back on memory storage"),new t}}}.call(e,o,e,t))||(t.exports=n)},69941:(t,e,o)=>{var n,i;n=[o(7237)],void 0===(i=function(t){const e={};let o,n;function i(t,e){t.toggleClass("fa-check-square-o",e),t.toggleClass("fa-square-o",!e),t.parents('[component="category/topic"]').toggleClass("selected",e)}function c(e){return t.get("category/topic","tid",e).index('[component="category/topic"]')}return e.init=function(e){n=$('[component="category"]'),n.on("selectstart",'[component="topic/select"]',(function(t){t.preventDefault()})),n.on("click",'[component="topic/select"]',(function(n){const a=$(this);if(n.shiftKey)return function(e){o||(o=$('[component="category/topic"]').first().find('[component="topic/select"]'));const n=t.get("category/topic","tid",e).hasClass("selected");!function(t,e,o){if(t>e){const o=t;t=e,e=o}for(let n=t;n<=e;n+=1)i($('[component="category/topic"]').eq(n).find('[component="topic/select"]'),o)}(c(e),c(o.parents('[component="category/topic"]').attr("data-tid")),!n)}($(this).parents('[component="category/topic"]').attr("data-tid")),o=a,!1;const r=a.parents("[data-tid]").hasClass("selected");i(a,!r),o=a,"function"==typeof e&&e()}))},e.getSelectedTids=function(){const t=[];return n?(n.find('[component="category/topic"].selected').each((function(){t.push($(this).attr("data-tid"))})),t):t},e.unselectAll=function(){n&&(n.find('[component="category/topic"].selected').removeClass("selected"),n.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))},e}.apply(e,n))||(t.exports=i)}}]);