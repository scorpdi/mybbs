(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[9970,7214,6503,1710,3014,8529,71,2550,831,7927],{59494:(t,e,n)=>{"use strict";var o,a;o=[n(38565),n(98192),n(7237),n(32230),n(59006),n(997),n(74344),n(31369),n(7927)],void 0===(a=function(t,e,o,a,i,r,c,s,u){const l={};let d;function p(t){r[t](ajaxify.data.theirid)}function f(t){return c["follow"===t?"put":"del"]("/users/"+ajaxify.data.uid+"/follow",void 0,(function(e){if(e)return u.error(e);o.get("account/follow").toggleClass("hide","follow"===t),o.get("account/unfollow").toggleClass("hide","unfollow"===t),u.success("[[global:alert."+t+", "+ajaxify.data.username+"]]")})),!1}function m(t,e){t=t||ajaxify.data.theirid,i.render("admin/partials/temporary-ban",{}).then((function(n){s.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:n,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban_account]]",callback:function(){const n=$(".ban-modal form").serializeArray().reduce((function(t,e){return t[e.name]=e.value,t}),{}),o=n.length>0?Date.now()+1e3*n.length*60*60*(parseInt(n.unit,10)?24:1):0;c.put("/users/"+t+"/ban",{until:o,reason:n.reason||""}).then((()=>{if("function"==typeof e)return e();ajaxify.refresh()})).catch(u.error)}}}})}))}function g(t){c.del("/users/"+t+"/ban").then((()=>{ajaxify.refresh()})).catch(u.error)}function h(t,e){t=t||ajaxify.data.theirid,i.render("admin/partials/temporary-mute",{}).then((function(n){s.dialog({className:"mute-modal",title:"[[user:mute_account]]",message:n,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute_account]]",callback:function(){const n=$(".mute-modal form").serializeArray().reduce((function(t,e){return t[e.name]=e.value,t}),{}),o=n.length>0?Date.now()+1e3*n.length*60*60*(parseInt(n.unit,10)?24:1):0;c.put("/users/"+t+"/mute",{until:o,reason:n.reason||""}).then((()=>{if("function"==typeof e)return e();ajaxify.refresh()})).catch(u.error)}}}})}))}function b(t){c.del("/users/"+t+"/mute").then((()=>{ajaxify.refresh()})).catch(u.error)}function v(){n.e(1803).then((function(){var t=[n(41803)];(function(t){t.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,t)})).catch(n.oe)}function y(){const t=this;return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid},(function(e,n){if(e)return u.error(e);a.translate("[[user:"+(n?"unblock":"block")+"_user]]",(function(e){$(t).text(e)}))})),!1}function k(){a.translate("[[user:remove_cover_picture_confirm]]",(function(t){s.confirm(t,(function(t){t&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},(function(t){t?u.error(t):ajaxify.refresh()}))}))}))}return l.init=function(){d=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,app.user.uid&&app.user.uid===parseInt(ajaxify.data.theirid,10)||$(".account-sub-links .plugin-link.private").addClass("hide"),$(".account-sub-links li").removeClass("active").each((function(){const t=$(this).find("a").attr("href");if(decodeURIComponent(t)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})),d&&t.init(o.get("account/cover"),(function(t,e,n){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:t,position:e},n)}),(function(){e.show({title:"[[user:upload_cover_picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},(function(t){t=(t.startsWith("http")?"":config.relative_path)+t+"?"+Date.now(),o.get("account/cover").css("background-image","url("+t+")")}))}),k),o.get("account/follow").on("click",(function(){f("follow")})),o.get("account/unfollow").on("click",(function(){f("unfollow")})),o.get("account/chat").on("click",(async function(){const t=await socket.emit("modules.chats.hasPrivateChat",ajaxify.data.uid),e=await app.require("chat");t?e.openChat(t):e.newChat(ajaxify.data.uid)})),o.get("account/new-chat").on("click",(async function(){(await app.require("chat")).newChat(ajaxify.data.uid,(function(){o.get("account/chat").parent().removeClass("hidden")}))})),o.get("account/ban").on("click",(function(){m(ajaxify.data.theirid)})),o.get("account/mute").on("click",(function(){h(ajaxify.data.theirid)})),o.get("account/unban").on("click",(function(){g(ajaxify.data.theirid)})),o.get("account/unmute").on("click",(function(){b(ajaxify.data.theirid)})),o.get("account/delete-account").on("click",p.bind(null,"account")),o.get("account/delete-content").on("click",p.bind(null,"content")),o.get("account/delete-all").on("click",p.bind(null,"purge")),o.get("account/flag").on("click",v),o.get("account/block").on("click",y)},l.banAccount=m,l.muteAccount=h,l.unbanAccount=g,l.unmuteAccount=b,l}.apply(e,o))||(t.exports=a)},997:(t,e,n)=>{"use strict";var o,a;o=[n(74344),n(31369),n(7927)],void 0===(a=function(t,e,n){const o={};function a(o,a,i,r,c){e.confirm(a,(function(e){e&&t.del(`/users/${o}${i}`,{}).then((()=>{if(n.success(r),"function"==typeof c)return c()})).catch(n.error)}))}return o.account=function(t,e){a(t,"[[user:delete_this_account_confirm]]","/account","[[user:account-deleted]]",e)},o.content=function(t,e){a(t,"[[user:delete_account_content_confirm]]","/content","[[user:account-content-deleted]]",e)},o.purge=function(t,e){a(t,"[[user:delete_all_confirm]]","","[[user:account-deleted]]",e)},o}.apply(e,o))||(t.exports=a)},7927:(t,e,n)=>{"use strict";var o,a;o=[n(32230),n(7237),n(85233)],a=function(t,e,n){const o={};function a(t,e){t.find("strong").translateHtml(e.title),t.find("p").translateHtml(e.message),t.attr("class","alert alert-dismissable alert-"+e.type+" clearfix"),clearTimeout(parseInt(t.attr("timeoutId"),10)),e.timeout&&r(t,e),n.fire("action:alert.update",{alert:t,params:e}),t.off("click").removeClass("pointer"),"function"==typeof e.clickfn&&t.addClass("pointer").on("click",(function(n){$(n.target).is(".close")||e.clickfn(),i(t)}))}function i(t){t.fadeOut(500,(function(){$(this).remove()}))}function r(t,e){const o=e.timeout,a=setTimeout((function(){i(t),"function"==typeof e.timeoutfn&&e.timeoutfn(t,e)}),o);t.attr("timeoutId",a),t.css("transition-property","none"),t.removeClass("animate"),setTimeout((function(){t.css("transition-property",""),t.css("transition","width "+(o+450)+"ms linear, background-color "+(o+450)+"ms ease-in"),t.addClass("animate"),n.fire("action:alert.animate",{alert:t,params:e})}),50),t.on("mouseenter",(function(){$(this).css("transition-duration",0)}))}return o.alert=function(t){t.alert_id="alert_button_"+(t.alert_id?t.alert_id:(new Date).getTime()),t.title=t.title&&t.title.trim()||"",t.message=t.message?t.message.trim():"",t.type=t.type||"info";const o=$("#"+t.alert_id);o.length?a(o,t):function(t){app.parseAndTranslate("alert",t,(function(o){let c=$("#"+t.alert_id);if(c.length)return a(c,t);c=o,c.fadeIn(200),e.get("toaster/tray").prepend(c),"function"==typeof t.closefn&&c.find("button").on("click",(function(){return t.closefn(),i(c),!1})),t.timeout&&r(c,t),"function"==typeof t.clickfn&&c.addClass("pointer").on("click",(function(e){$(e.target).is(".close")||t.clickfn(c,t),i(c)})),n.fire("action:alert.new",{alert:c,params:t})}))}(t)},o.success=function(t,e){o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:t,type:"success",timeout:e||5e3})},o.error=function(t,e){if("[[error:revalidate-failure]]"===(t=t&&t.message||t))return socket.disconnect(),void app.reconnect();o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:t,type:"danger",timeout:e||1e4})},o.remove=function(t){$("#alert_button_"+t).remove()},o}.apply(e,o),void 0===a||(t.exports=a)},74344:(t,e,n)=>{"use strict";var o,a;o=[n(85233)],void 0===(a=(t=>{const e={},n=config.relative_path+"/api/v3";function o(e,o){async function a(n){({options:e}=await t.fire("filter:api.options",{options:e})),$.ajax(e).done((t=>{n(null,t&&t.hasOwnProperty("status")&&t.hasOwnProperty("response")?t.response:t||{})})).fail((t=>{let e;t.responseJSON&&(e=t.responseJSON.status&&t.responseJSON.status.message?t.responseJSON.status.message:t.responseJSON.error),n(new Error(e||t.statusText))}))}if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:n+e.url,"function"!=typeof o)return new Promise(((t,e)=>{a((function(n,o){n?e(n):t(o)}))}));a(o)}return e.get=(t,e,n)=>o({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n),e.head=(t,e,n)=>o({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},n),e.post=(t,e,n)=>o({url:t,method:"post",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),e.patch=(t,e,n)=>o({url:t,method:"patch",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),e.put=(t,e,n)=>o({url:t,method:"put",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),e.del=(t,e,n)=>o({url:t,method:"delete",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),e.delete=e.del,e}).apply(e,o))||(t.exports=a)},7237:(t,e,n)=>{"use strict";var o;void 0===(o=function(){const t={};return t.core={"topic/teaser":function(t){return t?$('[component="category/topic"][data-tid="'+t+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(t,e){return $('[component="topic"][data-'+t+'="'+e+'"]')},post:function(t,e){return $('[component="post"][data-'+t+'="'+e+'"]')},"post/content":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/content"]')},"post/header":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/header"]')},"post/anchor":function(t){return $('[component="post"][data-index="'+t+'"] [component="post/anchor"]')},"post/vote-count":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/vote-count"]')},"post/bookmark-count":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/bookmark-count"]')},"user/postcount":function(t){return $('[component="user/postcount"][data-uid="'+t+'"]')},"user/reputation":function(t){return $('[component="user/reputation"][data-uid="'+t+'"]')},"category/topic":function(t,e){return $('[component="category/topic"][data-'+t+'="'+e+'"]')},"categories/category":function(t,e){return $('[component="categories/category"][data-'+t+'="'+e+'"]')},"chat/message":function(t){return $('[component="chat/message"][data-mid="'+t+'"]')},"chat/message/body":function(t){return $('[component="chat/message"][data-mid="'+t+'"] [component="chat/message/body"]')},"chat/recent/room":function(t){return $('[component="chat/recent/room"][data-roomid="'+t+'"]')}},t.get=function(){const e=Array.prototype.slice.call(arguments,1);return t.core[arguments[0]]&&e.length?t.core[arguments[0]].apply(this,e):$('[component="'+arguments[0]+'"]')},t}.call(e,n,e,t))||(t.exports=o)},38565:(t,e,n)=>{"use strict";var o,a;o=[n(7927),n(80034)],void 0===(a=function(t){const e={coverEl:null,saveFn:null};function n(e){e.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),t.alert({alert_id:"drag_start",title:"[[modules:cover.dragging_title]]",message:"[[modules:cover.dragging_message]]",timeout:5e3})}return e.init=function(t,o,a,i){e.coverEl=t,e.saveFn=o,t.find(".upload").on("click",a),t.find(".resize").on("click",(function(){n(t)})),t.find(".remove").on("click",i),t.on("dragover",e.onDragOver).on("drop",e.onDrop),t.find(".save").on("click",e.save),t.addClass("initialised")},e.onDragOver=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},e.onDrop=function(t){t.stopPropagation(),t.preventDefault();const o=t.originalEvent.dataTransfer.files,a=new FileReader;o.length&&o[0].type.match("image.*")&&(a.onload=function(t){e.coverEl.css("background-image","url("+t.target.result+")"),e.newCover=t.target.result},a.readAsDataURL(o[0]),n(e.coverEl))},e.save=function(){e.coverEl.addClass("saving"),e.saveFn(e.newCover||void 0,e.coverEl.css("background-position"),(function(n){n?t.error(n):(e.coverEl.toggleClass("active",0),e.coverEl.backgroundDraggable("disable"),e.coverEl.off("dragover",e.onDragOver),e.coverEl.off("drop",e.onDrop),t.success("[[modules:cover.saved]]")),e.coverEl.removeClass("saving")}))},e}.apply(e,o))||(t.exports=a)},98192:(t,e,n)=>{"use strict";var o,a;o=[n(7927)],a=function(t){const e={};function o(e,n){let o;try{o=n.imageType?e.getCroppedCanvas().toDataURL(n.imageType):e.getCroppedCanvas().toDataURL()}catch(e){return void(-1!==["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(e.message)?t.error("[[error:cors-error]]"):t.error(e.message))}return o}return e.show=function(t,o){const a=!(!t.hasOwnProperty("fileSize")||void 0===t.fileSize)&&parseInt(t.fileSize,10);app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:!t.hasOwnProperty("showHelp")||void 0===t.showHelp||t.showHelp,fileSize:a,title:t.title||"[[global:upload_file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},(function(a){a.modal("show"),a.on("hidden.bs.modal",(function(){a.remove()}));const i=a.find("#uploadForm");t.route&&i.attr("action",t.route),a.find("#fileUploadSubmitBtn").on("click",(function(){return $(this).addClass("disabled"),t.uploadModal=a,function(t,o){function a(e,n){"error"===e&&t.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),t.uploadModal.find("#alert-"+e).translateText(n).removeClass("hide")}const i=t.uploadModal.find("#fileInput");if(!i.val())return a("error","[[uploads:select-file-to-upload]]");const r=i[0].files[0],c=!(!t.hasOwnProperty("fileSize")||void 0===t.fileSize)&&parseInt(t.fileSize,10);if(c&&r.size>1024*c)return a("error","[[error:file-too-big, "+c+"]]");if(r.name.endsWith(".gif"))return void n.e(3564).then((function(){var e=[n(50431)];(function(e){e.ajaxSubmit(t.uploadModal,o)}).apply(null,e)})).catch(n.oe);const s=new FileReader;s.addEventListener("load",(function(){const n=s.result;t.uploadModal.modal("hide"),e.handleImageCrop({url:n,imageType:r.type,socketMethod:t.socketMethod,aspectRatio:t.aspectRatio,allowSkippingCrop:t.allowSkippingCrop,restrictImageDimension:t.restrictImageDimension,imageDimension:t.imageDimension,paramName:t.paramName,paramValue:t.paramValue},o)}),!1),r&&s.readAsDataURL(r)}(t,o),!1}))}))},e.handleImageCrop=function(e,a){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(e.url)},(async function(i){i.modal({backdrop:"static"}).modal("show");const r=parseInt($(window).height()/2,10),c=document.getElementById("cropped-image");$(c).css("max-height",r);let s=new(0,(await n.e(1649).then(n.t.bind(n,33129,23))).default)(c,{aspectRatio:e.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){e.restrictImageDimension&&(s.cropBoxData.width>e.imageDimension&&s.setCropBoxData({width:e.imageDimension}),s.cropBoxData.height>e.imageDimension&&s.setCropBoxData({height:e.imageDimension}))},ready:function(){if(!o(s,e))return i.modal("hide");if(e.restrictImageDimension){const t=c.width<c.height?c.width:c.height,n=t>e.imageDimension?e.imageDimension:t;s.setCropBoxData({width:n,height:n})}i.find(".rotate").on("click",(function(){const t=this.getAttribute("data-degrees");s.rotate(t)})),i.find(".flip").on("click",(function(){const t=this.getAttribute("data-option");"scaleX"===this.getAttribute("data-method")?s.scaleX(t):s.scaleY(t),this.setAttribute("data-option",-1*t)})),i.find(".reset").on("click",(function(){s.reset()})),i.find(".crop-btn").on("click",(function(){$(this).addClass("disabled");const n=o(s,e);n&&(i.find("#upload-progress-bar").css("width","0%"),i.find("#upload-progress-box").show().removeClass("hide"),function(e,n){const o={};o[e.data.paramName]=e.data.paramValue,o.method=e.data.socketMethod,o.size=e.imageData.length,o.progress=0;const a=1e5;!function i(){const r=e.imageData.slice(o.progress,o.progress+a);socket.emit("uploads.upload",{chunk:r,params:o},(function(c,s){return c?t.error(c):o.progress+a<o.size?(o.progress+=r.length,e.progressBarEl.css("width",(o.progress/o.size*100).toFixed(2)+"%"),setTimeout(i,100)):(e.progressBarEl.css("width","100%"),void n(null,s))}))}()}({data:e,imageData:n,progressBarEl:i.find("#upload-progress-bar")},(function(e,n){if(e)return i.find("#upload-progress-box").hide(),i.find(".upload-btn").removeClass("disabled"),i.find(".crop-btn").removeClass("disabled"),t.error(e);a(n.url),i.modal("hide")})))})),i.find(".upload-btn").on("click",(async function(){$(this).addClass("disabled"),s.destroy();const t=(await n.e(1649).then(n.t.bind(n,33129,23))).default;s=new t(c,{viewMode:1,autoCropArea:1,ready:function(){i.find(".crop-btn").trigger("click")}})}))}})}))},e}.apply(e,o),void 0===a||(t.exports=a)},80034:()=>{!function(t){var e=t(window),n=function(t,e,n,o){if(3===arguments.length||o){if(n<t)return t;if(n>e)return e}return n},o=function(t){t.clientX=t.originalEvent.touches[0].clientX,t.clientY=t.originalEvent.touches[0].clientY};function a(t,e){this.element=t,this.options=e,this.init()}a.prototype.init=function(){var a=t(this.element),i=(a.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],r=this.options;if(i){var c={width:0,height:0};(r.bound||"percent"==r.units)&&(c=function(t){var e=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(e){var n={width:0,height:0},o=new Image;return o.onload=function(){if("cover"==t.css("background-size")){var e=t.innerWidth(),a=t.innerHeight(),i=e/a;imageAspectRatio=o.width/o.height,scale=1,imageAspectRatio>=i?scale=a/o.height:scale=e/o.width,n.width=o.width*scale,n.height=o.height*scale}else n.width=o.width,n.height=o.height},o.src=e,n}}(a)),a.on("mousedown.dbg touchstart.dbg",(function(t){if(t.target===a[0]){if(t.preventDefault(),t.originalEvent.touches)o(t);else if(1!==t.which)return;var i=t.clientX,s=t.clientY,u=a.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],l=parseInt(u[1])||0,d=parseInt(u[2])||0;"percent"==r.units&&(l=Math.round(l/-200*c.width),d=Math.round(d/-200*c.height)),e.on("mousemove.dbg touchmove.dbg",(function(t){t.preventDefault(),t.originalEvent.touches&&o(t);var e=t.clientX,u=t.clientY;"percent"==r.units?(l="y"===r.axis?l:n(-c.width/2,0,l+e-i,r.bound),d="x"===r.axis?d:n(-c.height/2,0,d+u-s,r.bound),a.css("background-position",l/c.width*-200+"% "+d/c.height*-200+"%")):(l="y"===r.axis?l:n(a.innerWidth()-c.width,0,l+e-i,r.bound),d="x"===r.axis?d:n(a.innerHeight()-c.height,0,d+u-s,r.bound),a.css("background-position",l+"px "+d+"px")),i=e,s=u})),e.on("mouseup.dbg touchend.dbg mouseleave.dbg",(function(){r.done&&r.done(),e.off("mousemove.dbg touchmove.dbg"),e.off("mouseup.dbg touchend.dbg mouseleave.dbg")}))}}))}},a.prototype.disable=function(){t(this.element).off("mousedown.dbg touchstart.dbg"),e.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},t.fn.backgroundDraggable=function(e){var n=Array.prototype.slice.call(arguments,1);return this.each((function(){var o=t(this);if(void 0===e||"object"==typeof e){var i=new a(this,e=t.extend({},t.fn.backgroundDraggable.defaults,e));o.data("dbg",i)}else"string"==typeof e&&o.data("dbg")&&(i=o.data("dbg"),a.prototype[e].apply(i,n))}))},t.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}}(jQuery)}}]);