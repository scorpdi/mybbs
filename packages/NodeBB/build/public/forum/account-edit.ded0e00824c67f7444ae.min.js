"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3692],{93318:(a,t,e)=>{var i,r;i=[e(59494),e(94039),e(32230),e(74344),e(85233),e(31369),e(7927)],void 0===(r=function(a,t,e,i,r,o,n){const u={};function c(){const a=$('form[component="profile/edit/form"]').serializeObject();return a.uid=ajaxify.data.uid,a.groupTitle=a.groupTitle||"",a.groupTitle=JSON.stringify(Array.isArray(a.groupTitle)?a.groupTitle:[a.groupTitle]),r.fire("action:profile.update",a),i.put("/users/"+a.uid,a).then((a=>{n.success("[[user:profile_update_success]]"),a.picture&&$("#user-current-picture").attr("src",a.picture),t.updateHeader(a.picture)})).catch(n.error),!1}function d(a,t){return a.length?"("+a.val().length+"/"+t+")":""}return u.init=function(){a.init(),$("#submitBtn").on("click",c),1===ajaxify.data.groupTitleArray.length&&""===ajaxify.data.groupTitleArray[0]&&$('#groupTitle option[value=""]').attr("selected",!0),$("#changePictureBtn").on("click",(function(){return t.openChangeModal(),!1})),$("#deleteAccountBtn").on("click",(function(){return e.translate("[[user:delete_account_confirm]]",(function(a){const t=o.confirm(a+'<p><input type="password" class="form-control" id="confirm-password" /></p>',(function(a){if(!a)return;const r=t.find(".btn-primary");return r.html('<i class="fa fa-spinner fa-spin"></i>'),r.prop("disabled",!0),i.del(`/users/${ajaxify.data.uid}/account`,{password:$("#confirm-password").val()},(function(a){if(a)return e.translate("[[modules:bootbox.confirm]]",(function(a){r.text(a),r.prop("disabled",!1)})),n.error(a);r.html('<i class="fa fa-check"></i>'),window.location.href=`${config.relative_path}/`})),!1}));t.on("shown.bs.modal",(function(){t.find("input").focus()}))})),!1})),$("#confirm-email").on("click",(function(){const a=$(this).attr("disabled",!0);socket.emit("user.emailConfirm",{},(function(t){if(a.removeAttr("disabled"),t)return n.error(t);n.success("[[notifications:email-confirm-sent]]")}))})),function(){const a=$("#signature");$("#signatureCharCountLeft").html(d(a,ajaxify.data.maximumSignatureLength)),a.on("keyup change",(function(){$("#signatureCharCountLeft").html(d(a,ajaxify.data.maximumSignatureLength))}))}(),function(){const a=$("#aboutme");$("#aboutMeCharCountLeft").html(d(a,ajaxify.data.maximumAboutMeLength)),a.on("keyup change",(function(){$("#aboutMeCharCountLeft").html(d(a,ajaxify.data.maximumAboutMeLength))}))}(),function(){function a(a){const t=$("#groupTitle").val();if(!ajaxify.data.allowMultipleBadges||Array.isArray(t)&&t.length>1)return;const e=$("#groupTitle").find(":selected");e.length&&e.val()&&(a>0?e.insertAfter(e.next()):e.prev().val()&&e.insertBefore(e.prev()))}$('[component="group/order/up"]').on("click",(function(){a(-1)})),$('[component="group/order/down"]').on("click",(function(){a(1)}))}()},u}.apply(t,i))||(a.exports=r)},94039:(a,t,e)=>{var i,r;i=[e(98192),e(74344),e(31369),e(7927)],void 0===(r=((a,t,e,i)=>{const r={};return r.openChangeModal=()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},(function(o,n){if(o)return i.error(o);const u=n.reduce((function(a,t){return a||"uploaded"===t.type}),!1);app.parseAndTranslate("partials/modals/change_picture_modal",{pictures:n,uploaded:u,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:config.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},(function(o){const n=e.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:o,show:!0,buttons:{close:{label:"[[global:close]]",callback:function(){n.modal("hide")},className:"btn-link"},update:{label:"[[global:save_changes]]",callback:function(){const a=n.find(".list-group-item.active").attr("data-type"),e=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";(function(a,e){return t.put(`/users/${ajaxify.data.theirid}/picture`,{type:a,bgColor:e})})(a,e).then((()=>{r.updateHeader("default"===a?"":n.find(".list-group-item.active img").attr("src"),e),ajaxify.refresh()})).catch(i.error)}}}});n.on("shown.bs.modal",(function(){ajaxify.data.picture?n.find(".list-group-item img").each((function(){this.getAttribute("src")===ajaxify.data.picture&&$(this).parents(".list-group-item").addClass("active")})):n.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active");const a=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);a?a.checked=!0:document.querySelector('.modal input[type="radio"]').checked=!0})),n.on("click",".list-group-item",(function(){n.find(".list-group-item").removeClass("active"),$(this).addClass("active")})),n.on("change",'input[type="radio"][name="icon:bgColor"]',(a=>{const t=a.target.value;n.find(".user-icon").css("background-color",t)})),function(t){function e(a){a=(a.startsWith("http")?"":config.relative_path)+a+"?"+Date.now(),r.updateHeader(a),ajaxify.data.picture&&ajaxify.data.picture.length?($("#user-current-picture, img.avatar").attr("src",a),ajaxify.data.uploadedpicture=a):ajaxify.refresh((function(){$("#user-current-picture, img.avatar").attr("src",a)}))}t.find('[data-action="upload"]').on("click",(function(){return t.modal("hide"),a.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:!1,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:ajaxify.data.allowedProfileImageExtensions},(function(a){e(a)})),!1})),t.find('[data-action="upload-url"]').on("click",(function(){return t.modal("hide"),app.parseAndTranslate("partials/modals/upload_picture_from_url_modal",{},(function(t){t.modal("show"),t.find(".upload-btn").on("click",(function(){const i=t.find("#uploadFromUrl").val();return!!i&&(t.modal("hide"),a.handleImageCrop({url:i,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:!1,paramName:"uid",paramValue:ajaxify.data.theirid},e),!1)}))})),!1})),t.find('[data-action="remove-uploaded"]').on("click",(function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},(function(a){if(t.modal("hide"),a)return i.error(a);ajaxify.data.uploadedpicture===ajaxify.data.picture&&(ajaxify.refresh(),r.updateHeader())}))}))}(n)}))}))},r.updateHeader=(a,t)=>{parseInt(ajaxify.data.theirid,10)===parseInt(ajaxify.data.yourid,10)&&(!a&&ajaxify.data.defaultAvatar&&(a=ajaxify.data.defaultAvatar),$('#header [component="avatar/picture"]')[a?"show":"hide"](),$('#header [component="avatar/icon"]')[a?"hide":"show"](),a&&$('#header [component="avatar/picture"]').attr("src",a),t&&document.querySelectorAll('[component="navbar"] [component="avatar/icon"]').forEach((a=>{a.style["background-color"]=t})))},r}).apply(t,i))||(a.exports=r)}}]);