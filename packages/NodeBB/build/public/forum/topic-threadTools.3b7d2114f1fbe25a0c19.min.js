"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1375,8306],{60392:(t,e,o)=>{var n,i;n=[o(7237),o(32230),o(66044),o(60447),o(74344),o(85233),o(31369),o(7927)],void 0===(i=function(t,e,n,i,c,a,l,s){const r={};function p(t,e,o,n){n||(n=function(){});const i=ajaxify.data.tid,a={},p=function(o){o&&c[t](`/topics/${i}${e}`,a).then(n).catch(s.error)};switch(o){case"delete":case"restore":case"purge":l.confirm(`[[topic:thread_tools.${o}_confirm]]`,p);break;case"pin":r.requestPinExpiry(a,p.bind(null,!0));break;default:p(!0)}}return r.init=function(i,r){function d(o,n=1){return c[n?"put":"del"](`/topics/${i}/${o}`,{},(()=>{let c="";"follow"===o?c=n?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":"ignore"===o&&(c=n?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),n||(o="unfollow"),function(o){e.translate({follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"}[o],(function(t){$('[component="topic/watch"] button').attr("title",t).tooltip("fixTitle")}));let n=t.get("topic/following/menu");n.toggleClass("hidden","follow"!==o),t.get("topic/following/check").toggleClass("fa-check","follow"===o),n=t.get("topic/not-following/menu"),n.toggleClass("hidden","unfollow"!==o),t.get("topic/not-following/check").toggleClass("fa-check","unfollow"===o),n=t.get("topic/ignoring/menu"),n.toggleClass("hidden","ignore"!==o),t.get("topic/ignoring/check").toggleClass("fa-check","ignore"===o)}(o),s.alert({alert_id:"follow_thread",message:c,type:"success",timeout:5e3}),a.fire("action:topics.changeWatching",{tid:i,type:o})}),(()=>{s.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})})),!1}r.on("show.bs.dropdown",".thread-tools",(function(){const t=$(this).find(".dropdown-menu");t.html()||(t.toggleClass("hidden",!0),socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},(function(e,o){if(e)return s.error(e);app.parseAndTranslate("partials/topic/topic-menu-list",o,(function(e){t.html(e),t.toggleClass("hidden",!1),a.fire("action:topic.tools.load",{element:t})}))})))})),r.on("click",'[component="topic/delete"]',(function(){return p("del","/state","delete"),!1})),r.on("click",'[component="topic/restore"]',(function(){return p("put","/state","restore"),!1})),r.on("click",'[component="topic/purge"]',(function(){return p("del","","purge"),!1})),r.on("click",'[component="topic/lock"]',(function(){return p("put","/lock","lock"),!1})),r.on("click",'[component="topic/unlock"]',(function(){return p("del","/lock","unlock"),!1})),r.on("click",'[component="topic/pin"]',(function(){return p("put","/pin","pin"),!1})),r.on("click",'[component="topic/unpin"]',(function(){return p("del","/pin","unpin"),!1})),r.on("click",'[component="topic/event/delete"]',(function(){const t=$(this).attr("data-topic-event-id"),e=$(this).parents('[component="topic/event"]');l.confirm("[[topic:delete-event-confirm]]",(o=>{o&&c.del(`/topics/${i}/events/${t}`,{}).then((function(){e.remove()})).catch(s.error)}))})),r.on("click",'[component="topic/mark-unread"]',(function(){return socket.emit("topics.markUnread",i,(function(t){if(t)return s.error(t);app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,(function(){n.onBackClicked(!0)})):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,n.onBackClicked),s.success("[[topic:mark_unread.success]]")})),!1})),r.on("click",'[component="topic/mark-unread-for-all"]',(function(){const t=$(this);return socket.emit("topics.markAsUnreadForAll",[i],(function(e){if(e)return s.error(e);s.success("[[topic:markAsUnreadForAll.success]]"),t.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")})),!1})),r.on("click",'[component="topic/move"]',(function(){return o.e(7378).then((function(){var t=[o(57378)];(function(t){t.init([i],ajaxify.data.cid)}).apply(null,t)})).catch(o.oe),!1})),r.on("click",'[component="topic/delete/posts"]',(function(){o.e(5253).then((function(){var t=[o(55253)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),r.on("click",'[component="topic/fork"]',(function(){o.e(5636).then((function(){var t=[o(25636)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),r.on("click",'[component="topic/move-posts"]',(function(){o.e(3094).then((function(){var t=[o(53094)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),r.on("click",'[component="topic/following"]',(function(){d("follow")})),r.on("click",'[component="topic/not-following"]',(function(){d("follow",0)})),r.on("click",'[component="topic/ignoring"]',(function(){d("ignore")}))},r.requestPinExpiry=function(t,e){app.parseAndTranslate("modals/set-pin-expiry",{},(function(o){const n=l.dialog({title:"[[topic:thread_tools.pin]]",message:o,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let o=n.get(0).querySelector("#expiry").value;if(""===o)return e();o=new Date(o),o&&o.getTime()>Date.now()?(t.expiry=o.getTime(),e()):s.error("[[error:invalid-date]]")}}}})}))},r.setLockedState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;const n=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null),t.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",e.isLocked?null:"");const c=!(!e.isLocked&&!ajaxify.data.deleted||ajaxify.data.privileges.isAdminOrMod);t.get("topic/reply/container").toggleClass("hidden",c),t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",c),o.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",n),o.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",n),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!e.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=e.isLocked,i.addTopicEvents(e.events)},r.setDeleteState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;t.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null),t.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),t.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),t.get("topic/deleted/message").toggleClass("hidden",!e.isDelete),e.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:e.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},(function(e){t.get("topic/deleted/message").replaceWith(e),e.find(".timeago").timeago()}));const n=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/reply/container").toggleClass("hidden",n),t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",n),o.toggleClass("deleted",e.isDelete),ajaxify.data.deleted=e.isDelete?1:0,i.addTopicEvents(e.events)},r.setPinnedState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;t.get("topic/pin").toggleClass("hidden",e.pinned).parent().attr("hidden",e.pinned?"":null),t.get("topic/unpin").toggleClass("hidden",!e.pinned).parent().attr("hidden",e.pinned?null:"");const n=$('[component="topic/labels"] [component="topic/pinned"]');n.toggleClass("hidden",!e.pinned),e.pinned&&n.translateAttr("title",e.pinExpiry&&e.pinExpiryISO?"[[topic:pinned-with-expiry, "+e.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=e.pinned,i.addTopicEvents(e.events)},r}.apply(e,n))||(t.exports=i)},66044:(t,e,o)=>{var n,i;n=[o(7237),o(66603),o(42840),o(78989)],void 0===(i=function(t,e,o,n){const i={};let c;function a(t){const o=t&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||o){let t=e.getItem("category:bookmark"),o=e.getItem("category:bookmark:clicked");if(e.removeItem("category:bookmark"),e.removeItem("category:bookmark:clicked"),!utils.isNumber(t))return;if(t=Math.max(0,parseInt(t,10)||0),o=Math.max(0,parseInt(o,10)||0),config.usePagination){const e=Math.ceil((parseInt(t,10)+1)/config.topicsPerPage);parseInt(e,10)!==ajaxify.data.pagination.currentPage?n.loadPage(e,(function(){i.scrollToTopic(t,o)})):i.scrollToTopic(t,o)}else{if(0===t)return void i.scrollToTopic(t,o);$('[component="category"]').empty(),c(Math.max(0,t-1)+1,(function(){i.scrollToTopic(t,o)}))}}}return i.init=function(t){c=t,$('[component="category"]').on("click",'[component="topic/header"]',(function(){const t=$(this).parents("[data-index]").attr("data-index"),o=$(window).scrollTop();$('[component="category/topic"]').each((function(n,i){if($(i).offset().top-o>0)return e.setItem("category:bookmark",$(i).attr("data-index")),e.setItem("category:bookmark:clicked",t),e.setItem("category:bookmark:offset",$(i).offset().top-o),!1}))})),$(window).off("action:popstate",a).on("action:popstate",a)},i.onBackClicked=a,i.highlightTopic=function(e){const o=t.get("category/topic","index",e);o.length&&!o.hasClass("highlight")&&(o.addClass("highlight"),setTimeout((function(){o.removeClass("highlight")}),5e3))},i.scrollToTopic=function(n,c){if(!utils.isNumber(n))return;const a=t.get("category/topic","index",n);if(a.length){const t=e.getItem("category:bookmark:offset");e.removeItem("category:bookmark:offset"),$(window).scrollTop(a.offset().top-t),i.highlightTopic(c),o.update()}},i}.apply(e,n))||(t.exports=i)},66603:(t,e,o)=>{var n;void 0===(n=function(){function t(){this._store={},this._keys=[]}let e;t.prototype.isMock=!0,t.prototype.setItem=function(t,e){t=String(t),-1===this._keys.indexOf(t)&&this._keys.push(t),this._store[t]=e},t.prototype.getItem=function(t){return t=String(t),-1===this._keys.indexOf(t)?null:this._store[t]},t.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter((function(e){return e!==t})),this._store[t]=null},t.prototype.clear=function(){this._keys=[],this._store={}},t.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(t.prototype,"length",{get:function(){return this._keys.length}});const o=Date.now().toString();try{if(e=window.localStorage,e.setItem(o,o),e.getItem(o)!==o)throw Error("localStorage behaved unexpectedly");return e.removeItem(o),e}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(e=window.sessionStorage,e.setItem(o,o),e.getItem(o)!==o)throw Error("sessionStorage behaved unexpectedly");return e.removeItem(o),e}catch(e){return console.warn(e),console.warn("sessionStorage failed, falling back on memory storage"),new t}}}.call(e,o,e,t))||(t.exports=n)}}]);