"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[565,7214,6503,6028,3014,71,8306,831,7927,6862],{46862:(e,t,n)=>{var o,s;o=[n(7237),n(32230),n(59006),n(85233),n(31369),n(7927),n(44882),n(74344)],void 0===(s=function(e,t,n,o,s,a,r,i){const c={};function l(t){t.messages.forEach((function(t){const n=parseInt(t.fromuid,10)===parseInt(app.user.uid,10);t.self=n?1:0,c.parseMessage(t,(function(n){const o=e.get("chat/message",t.messageId);o.length&&(o.replaceWith(n),e.get("chat/message",t.messageId).find(".timeago").timeago())}))}))}function m(t){e.get("chat/message",t).toggleClass("deleted",!0).find('[component="chat/message/body"]').translateHtml("[[modules:chat.message-deleted]]")}function p(t){e.get("chat/message",t.messageId).toggleClass("deleted",!1).find('[component="chat/message/body"]').html(t.content)}return c.sendMessage=async function(e,t){let n=t.val(),s=t.attr("data-mid");if(!n.trim().length)return;t.val(""),t.removeAttr("data-mid"),c.updateRemainingLength(t.parent());const l={roomId:e,message:n,mid:s};o.fire("action:chat.sent",l),({roomId:e,message:n,mid:s}=await o.fire("filter:chat.send",l)),s?i.put(`/chats/${e}/messages/${s}`,{message:n}).catch((e=>(t.val(n),t.attr("data-mid",s),c.updateRemainingLength(t.parent()),a.error(e)))):i.post(`/chats/${e}`,{message:n}).catch((e=>(t.val(n),c.updateRemainingLength(t.parent()),"[[error:email-not-confirmed-chat]]"===e.message?r.showEmailConfirmWarning(e.message):a.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:e.message,type:"danger",timeout:1e4}))))},c.updateRemainingLength=function(e){const t=e.find('[component="chat/input"]');e.find('[component="chat/message/length"]').text(t.val().length),e.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-t.val().length),o.fire("action:chat.updateRemainingLength",{parent:e})},c.appendChatMessage=function(e,t){const n=parseInt(e.find(".chat-message").last().attr("data-uid"),10),s=parseInt(e.find(".chat-message").last().attr("data-timestamp"),10);Array.isArray(t)||(t.newSet=n!==parseInt(t.fromuid,10)||parseInt(t.timestamp,10)>parseInt(s,10)+18e4),c.parseMessage(t,(function(t){!function(e,t){const n=$(t),s=c.isAtBottom(e);n.appendTo(e),n.find(".timeago").timeago(),n.find("img:not(.not-responsive)").addClass("img-responsive"),s&&c.scrollToBottom(e),o.fire("action:chat.received",{messageEl:n})}(e,t)}))},c.parseMessage=function(e,o){function s(e){t.translate(e,o)}Array.isArray(e)?n.render("partials/chats/message"+(Array.isArray(e)?"s":""),{messages:e}).then(s):n.render("partials/chats/"+(e.system?"system-message":"message"),{messages:e}).then(s)},c.isAtBottom=function(e,t){if(e.length)return e[0].scrollHeight-(e.outerHeight()+e.scrollTop())<(t||100)},c.scrollToBottom=function(e){e&&e.length&&(e.scrollTop(e[0].scrollHeight-e.height()),e.parent().find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},c.toggleScrollUpAlert=function(e){const t=c.isAtBottom(e,300);e.parent().find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",t)},c.prepEdit=function(e,t,n){socket.emit("modules.chats.getRaw",{mid:t,roomId:n},(function(s,r){if(s)return a.error(s);0===e.val().length&&(e.attr("data-mid",t).addClass("editing"),e.val(r).focus(),o.fire("action:chat.prepEdit",{inputEl:e,messageId:t,roomId:n}))}))},c.addSocketListeners=function(){socket.removeListener("event:chats.edit",l),socket.on("event:chats.edit",l),socket.removeListener("event:chats.delete",m),socket.on("event:chats.delete",m),socket.removeListener("event:chats.restore",p),socket.on("event:chats.restore",p)},c.delete=function(n,o){t.translate("[[modules:chat.delete_message_confirm]]",(function(t){s.confirm(t,(function(t){t&&i.delete(`/chats/${o}/messages/${n}`,{}).then((()=>{e.get("chat/message",n).toggleClass("deleted",!0)})).catch(a.error)}))}))},c.restore=function(t,n){i.post(`/chats/${n}/messages/${t}`,{}).then((()=>{e.get("chat/message",t).toggleClass("deleted",!1)})).catch(a.error)},c}.apply(t,o))||(e.exports=s)},7927:(e,t,n)=>{var o,s;o=[n(32230),n(7237),n(85233)],s=function(e,t,n){const o={};function s(e,t){e.find("strong").translateHtml(t.title),e.find("p").translateHtml(t.message),e.attr("class","alert alert-dismissable alert-"+t.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),t.timeout&&r(e,t),n.fire("action:alert.update",{alert:e,params:t}),e.off("click").removeClass("pointer"),"function"==typeof t.clickfn&&e.addClass("pointer").on("click",(function(n){$(n.target).is(".close")||t.clickfn(),a(e)}))}function a(e){e.fadeOut(500,(function(){$(this).remove()}))}function r(e,t){const o=t.timeout,s=setTimeout((function(){a(e),"function"==typeof t.timeoutfn&&t.timeoutfn(e,t)}),o);e.attr("timeoutId",s),e.css("transition-property","none"),e.removeClass("animate"),setTimeout((function(){e.css("transition-property",""),e.css("transition","width "+(o+450)+"ms linear, background-color "+(o+450)+"ms ease-in"),e.addClass("animate"),n.fire("action:alert.animate",{alert:e,params:t})}),50),e.on("mouseenter",(function(){$(this).css("transition-duration",0)}))}return o.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:(new Date).getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const o=$("#"+e.alert_id);o.length?s(o,e):function(e){app.parseAndTranslate("alert",e,(function(o){let i=$("#"+e.alert_id);if(i.length)return s(i,e);i=o,i.fadeIn(200),t.get("toaster/tray").prepend(i),"function"==typeof e.closefn&&i.find("button").on("click",(function(){return e.closefn(),a(i),!1})),e.timeout&&r(i,e),"function"==typeof e.clickfn&&i.addClass("pointer").on("click",(function(t){$(t.target).is(".close")||e.clickfn(i,e),a(i)})),n.fire("action:alert.new",{alert:i,params:e})}))}(e)},o.success=function(e,t){o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:t||5e3})},o.error=function(e,t){if("[[error:revalidate-failure]]"===(e=e&&e.message||e))return socket.disconnect(),void app.reconnect();o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:t||1e4})},o.remove=function(e){$("#alert_button_"+e).remove()},o}.apply(t,o),void 0===s||(e.exports=s)},74344:(e,t,n)=>{var o,s;o=[n(85233)],void 0===(s=(e=>{const t={},n=config.relative_path+"/api/v3";function o(t,o){async function s(n){({options:t}=await e.fire("filter:api.options",{options:t})),$.ajax(t).done((e=>{n(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})})).fail((e=>{let t;e.responseJSON&&(t=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),n(new Error(t||e.statusText))}))}if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:n+t.url,"function"!=typeof o)return new Promise(((e,t)=>{s((function(n,o){n?t(n):e(o)}))}));s(o)}return t.get=(e,t,n)=>o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n),t.head=(e,t,n)=>o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},n),t.post=(e,t,n)=>o({url:e,method:"post",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.patch=(e,t,n)=>o({url:e,method:"patch",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.put=(e,t,n)=>o({url:e,method:"put",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.del=(e,t,n)=>o({url:e,method:"delete",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.delete=t.del,t}).apply(t,o))||(e.exports=s)},7237:(e,t,n)=>{var o;void 0===(o=function(){const e={};return e.core={"topic/teaser":function(e){return e?$('[component="category/topic"][data-tid="'+e+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(e,t){return $('[component="topic"][data-'+e+'="'+t+'"]')},post:function(e,t){return $('[component="post"][data-'+e+'="'+t+'"]')},"post/content":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/content"]')},"post/header":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/header"]')},"post/anchor":function(e){return $('[component="post"][data-index="'+e+'"] [component="post/anchor"]')},"post/vote-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/vote-count"]')},"post/bookmark-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/bookmark-count"]')},"user/postcount":function(e){return $('[component="user/postcount"][data-uid="'+e+'"]')},"user/reputation":function(e){return $('[component="user/reputation"][data-uid="'+e+'"]')},"category/topic":function(e,t){return $('[component="category/topic"][data-'+e+'="'+t+'"]')},"categories/category":function(e,t){return $('[component="categories/category"][data-'+e+'="'+t+'"]')},"chat/message":function(e){return $('[component="chat/message"][data-mid="'+e+'"]')},"chat/message/body":function(e){return $('[component="chat/message"][data-mid="'+e+'"] [component="chat/message/body"]')},"chat/recent/room":function(e){return $('[component="chat/recent/room"][data-roomid="'+e+'"]')}},e.get=function(){const t=Array.prototype.slice.call(arguments,1);return e.core[arguments[0]]&&t.length?e.core[arguments[0]].apply(this,t):$('[component="'+arguments[0]+'"]')},e}.call(t,n,t,e))||(e.exports=o)},44882:(e,t,n)=>{var o,s;o=[n(31369),n(32230),n(66603),n(7927),n(85233)],void 0===(s=function(e,t,n,o,s){const a={};let r,i;return a.show=function(){s.one("action:ajaxify.end",(()=>{!function(){const t=utils.params({full:!0});r=t.has("loggedin"),i=t.get("register"),r&&(o.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),t.delete("loggedin")),i&&(e.alert({message:utils.escapeHTML(decodeURIComponent(i))}),t.delete("register"));const n=t.toString();ajaxify.updateHistory(ajaxify.currentPage+(n?`?${n}`:"")+document.location.hash,!0)}(),config.cookies.enabled&&navigator.cookieEnabled&&!app.inAdmin&&"1"!==n.getItem("cookieconsent")&&(config.cookies.message=t.unescape(config.cookies.message),config.cookies.dismiss=t.unescape(config.cookies.dismiss),config.cookies.link=t.unescape(config.cookies.link),config.cookies.link_url=t.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,(function(e){$(document.body).append(e),$(document.body).addClass("cookie-consent-open");const t=$(".cookie-consent");t.find("button").on("click",(function(){n.setItem("cookieconsent","1"),t.remove(),$(document.body).removeClass("cookie-consent-open")}))}))),a.showEmailConfirmWarning()}))},a.showEmailConfirmWarning=function(e){if(!config.emailPrompt||!app.user.uid||1===parseInt(n.getItem("email-confirm-dismiss"),10))return;const t={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{n.setItem("email-confirm-dismiss",1)}};app.user.email?app.user["email:confirmed"]||app.user.isEmailConfirmSent?!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(t.message="[[error:email-not-confirmed-email-sent]]",o.alert(t)):(t.message=e||"[[error:email-not-confirmed]]",t.clickfn=function(){o.remove("email_confirm"),socket.emit("user.emailConfirm",{},(function(e){if(e)return o.error(e);o.success("[[notifications:email-confirm-sent]]")}))},o.alert(t)):(t.message="[[error:no-email-to-confirm]]",t.clickfn=function(){o.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},o.alert(t))},a.showInvalidSession=function(){e.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},a.showSessionMismatch=function(){e.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},a}.apply(t,o))||(e.exports=s)},66603:(e,t,n)=>{var o;void 0===(o=function(){function e(){this._store={},this._keys=[]}let t;e.prototype.isMock=!0,e.prototype.setItem=function(e,t){e=String(e),-1===this._keys.indexOf(e)&&this._keys.push(e),this._store[e]=t},e.prototype.getItem=function(e){return e=String(e),-1===this._keys.indexOf(e)?null:this._store[e]},e.prototype.removeItem=function(e){e=String(e),this._keys=this._keys.filter((function(t){return t!==e})),this._store[e]=null},e.prototype.clear=function(){this._keys=[],this._store={}},e.prototype.key=function(e){return e=parseInt(e,10)||0,this._keys[e]},Object.defineProperty&&Object.defineProperty(e.prototype,"length",{get:function(){return this._keys.length}});const n=Date.now().toString();try{if(t=window.localStorage,t.setItem(n,n),t.getItem(n)!==n)throw Error("localStorage behaved unexpectedly");return t.removeItem(n),t}catch(o){console.warn(o),console.warn("localStorage failed, falling back on sessionStorage");try{if(t=window.sessionStorage,t.setItem(n,n),t.getItem(n)!==n)throw Error("sessionStorage behaved unexpectedly");return t.removeItem(n),t}catch(t){return console.warn(t),console.warn("sessionStorage failed, falling back on memory storage"),new e}}}.call(t,n,t,e))||(e.exports=o)}}]);