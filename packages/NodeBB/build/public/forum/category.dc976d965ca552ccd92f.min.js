"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4422,8704],{7217:(e,t,n)=>{var o,i;o=[n(25142),n(78942),n(42840),n(14745),n(69241),n(50548),n(85233),n(7927)],void 0===(i=function(e,t,n,o,i,a,c,r){const s={};function d(t,n,o){o=o||function(){},c.fire("action:topics.loading");const i=utils.params();e.loadMore("categories.loadMore",{cid:ajaxify.data.cid,after:t,direction:n,query:i,categoryTopicSort:config.categoryTopicSort},(function(e,t){c.fire("action:topics.loaded",{topics:e.topics}),o(e,t)}))}return $(window).on("action:ajaxify.start",(function(e,t){String(t.url).startsWith("category/")||n.disable()})),s.init=function(){const e=ajaxify.data.cid;app.enterRoom("category_"+e),t.addShareHandlers(ajaxify.data.name),o.init("category",d),i.handleSort("categoryTopicSort","category/"+ajaxify.data.slug),config.usePagination?n.disable():n.init('[component="category/topic"]',ajaxify.data.topic_count,s.toTop,s.toBottom,s.navigatorCallback),function(){let e=ajaxify.data.topicIndex;e&&utils.isNumber(e)&&(e=Math.max(0,parseInt(e,10)),e&&-1===window.location.search.indexOf("page=")&&n.scrollToElement($('[component="category/topic"][data-index="'+e+'"]'),!0,0))}(),function(e){$('[component="category/watching"], [component="category/ignoring"], [component="category/notwatching"]').on("click",(function(){const t=$(this).attr("data-state");socket.emit("categories.setWatchState",{cid:e,state:t},(function(e){if(e)return r.error(e);$('[component="category/watching/menu"]').toggleClass("hidden","watching"!==t),$('[component="category/watching/check"]').toggleClass("fa-check","watching"===t),$('[component="category/notwatching/menu"]').toggleClass("hidden","notwatching"!==t),$('[component="category/notwatching/check"]').toggleClass("fa-check","notwatching"===t),$('[component="category/ignoring/menu"]').toggleClass("hidden","ignoring"!==t),$('[component="category/ignoring/check"]').toggleClass("fa-check","ignoring"===t),r.success("[[category:"+t+".message]]")}))}))}(e),$('[component="category/load-more-subcategories"]').on("click",(function(){const e=$(this);return socket.emit("categories.loadMoreSubCategories",{cid:ajaxify.data.cid,start:ajaxify.data.nextSubCategoryStart},(function(t,n){if(t)return r.error(t);e.toggleClass("hidden",!n.length||n.length<ajaxify.data.subCategoriesPerPage),n.length&&app.parseAndTranslate("category","children",{children:n},(function(t){t.find(".timeago").timeago(),$('[component="category/subcategory/container"]').append(t),utils.makeNumbersHumanReadable(t.find(".human-readable-number")),app.createUserTooltips(t),ajaxify.data.nextSubCategoryStart+=ajaxify.data.subCategoriesPerPage,ajaxify.data.subCategoriesLeft-=n.length,e.toggleClass("hidden",ajaxify.data.subCategoriesLeft<=0).translateText("[[category:x-more-categories, "+ajaxify.data.subCategoriesLeft+"]]")}))})),!1})),a.init($('[component="category-selector"]'),{privilege:"find",parentCid:ajaxify.data.cid,onSelect:function(e){ajaxify.go("/category/"+e.cid)}}),c.fire("action:topics.loaded",{topics:ajaxify.data.topics}),c.fire("action:category.loaded",{cid:ajaxify.data.cid})},s.toTop=function(){n.scrollTop(0)},s.toBottom=function(){socket.emit("categories.getTopicCount",ajaxify.data.cid,(function(e,t){if(e)return r.error(e);n.scrollBottom(t-1)}))},s.navigatorCallback=function(e,t){return t},s}.apply(t,o))||(e.exports=i)},39941:(e,t,n)=>{var o,i;o=[n(22905),n(74344),n(85233)],void 0===(i=function(e,t,n){const o={init:function(o,i){if(!o||!o.length)return;(i=i||{}).states=i.states||["watching","notwatching","ignoring"],i.template="partials/category-filter",n.fire("action:category.filter.options",{el:o,options:i}),e.init(o,i);let a=[],c=[];Array.isArray(i.selectedCids)?a=i.selectedCids.map((e=>parseInt(e,10))):Array.isArray(ajaxify.data.selectedCids)&&(a=ajaxify.data.selectedCids.map((e=>parseInt(e,10)))),c=a.slice(),o.on("hidden.bs.dropdown",(function(){let e=c.length!==a.length;if(c.forEach((function(t,n){t!==a[n]&&(e=!0)})),e&&function(e,n){function o(t){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:t},(function(t){e.find("button").replaceWith($("<div/>").html(t).find("button"))}))}n.length>1?o({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):1===n.length?t.get(`/categories/${n[0]}`,{}).then(o):o()}(o,a),i.onHidden)i.onHidden({changed:e,selectedCids:a.slice()});else if(e){let e=window.location.pathname;const t=utils.params();a.length&&(t.cid=a,e+="?"+decodeURIComponent($.param(t))),ajaxify.go(e)}})),o.on("click",'[component="category/list"] [data-cid]',(function(){const e=o.find('[component="category/list"]'),t=$(this),n=t.find("a").attr("href");if(n&&"#"!==n&&n.length)return;const c=parseInt(t.attr("data-cid"),10),r=t.find('[component="category/select/icon"]');return a.includes(c)?a.splice(a.indexOf(c),1):a.push(c),a.sort((function(e,t){return e-t})),i.selectedCids=a,r.toggleClass("invisible"),e.find('li[data-all="all"] i').toggleClass("invisible",!!a.length),i.onSelect&&i.onSelect({cid:c,selectedCids:a.slice()}),!1}))}};return o}.apply(t,o))||(e.exports=i)},22905:(e,t,n)=>{var o,i;o=[n(7927)],void 0===(i=function(e){const t={init:function(t,n){let o=null;(n=n||{}).privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"];let i=[];Array.isArray(n.localCategories)&&(i=n.localCategories.map((e=>({...e})))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const a=t.find('[component="category-selector-search"]');if(!a.length)return;const c=a.parent('[component="category/dropdown"]').length>0||a.parent('[component="category-selector"]').length>0;function r(e){app.parseAndTranslate(n.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},(function(n){t.find('[component="category/list"]').replaceWith(n.find('[component="category/list"]')),t.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length)}))}t.on("show.bs.dropdown",(function(){function s(){const t=a.find("input").val();var c,s;t.length>1||!t&&!o?(c=t,s=function(e){o=o||e,r(e)},socket.emit("categories.categorySearch",{search:c,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},(function(t,n){if(t)return e.error(t);s(i.concat(n))}))):!t&&o&&(o.forEach((function(e){e.selected=n.selectedCids.includes(e.cid)})),r(o))}c&&(t.find(".dropdown-toggle").addClass("hidden"),a.removeClass("hidden")),a.on("click",(function(e){e.preventDefault(),e.stopPropagation()})),a.find("input").val("").on("keyup",utils.debounce(s,300)),s()})),t.on("shown.bs.dropdown",(function(){a.find("input").focus()})),t.on("hide.bs.dropdown",(function(){c&&(t.find(".dropdown-toggle").removeClass("hidden"),a.addClass("hidden")),a.off("click"),a.find("input").off("keyup")}))}};return t}.apply(t,o))||(e.exports=i)},50548:(e,t,n)=>{var o,i;o=[n(22905),n(31369),n(85233)],void 0===(i=function(e,t,n){const o={init:function(t,o){if(!t||!t.length)return;const i=(o=o||{}).onSelect||function(){};o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-selector",n.fire("action:category.selector.options",{el:t,options:o}),e.init(t,o);const a={el:t,selectedCategory:null};t.on("click","[data-cid]",(function(){const e=$(this);if(e.hasClass("disabled"))return!1;a.selectCategory(e.attr("data-cid")),i(a.selectedCategory)}));const c=a.el.find('[component="category-selector-selected"]').html();return a.selectCategory=function(e){const t=a.el.find('[data-cid="'+e+'"]');a.selectedCategory={cid:e,name:t.attr("data-name")},t.length?a.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(c)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},a},modal:function(e){(e=e||{}).onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},(function(n){const i=t.dialog({title:e.title||"[[modules:composer.select_category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:c}}}),a=o.init(i.find('[component="category-selector"]'),e);function c(t){return t.preventDefault(),a.selectedCategory&&(e.onSubmit(a.selectedCategory),i.modal("hide")),!1}e.openOnLoad&&i.on("shown.bs.modal",(function(){i.find(".dropdown-toggle").dropdown("toggle")})),i.find("form").on("submit",c)}))}};return o}.apply(t,o))||(e.exports=i)},69241:(e,t,n)=>{var o,i;o=[n(7237),n(74344)],void 0===(i=function(e,t){return{handleSort:function(n,o){const i=e.get("thread/sort");i.find("i").removeClass("fa-check"),i.find('a[data-sort="'+config[n]+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a').on("click",'[component="thread/sort"] a',(function(){function e(e,t){config[n]=e;const i=decodeURIComponent($.param(t));ajaxify.go(o+(i?"?"+i:""))}const i=$(this).attr("data-sort");if(app.user.uid){const o={settings:{}};o.settings[n]=i,t.put(`/users/${app.user.uid}/settings`,o).then((()=>{e(i,utils.params())}))}else{const t=utils.params();t.sort=i,e(i,t)}}))}}}.apply(t,o))||(e.exports=i)},14745:(e,t,n)=>{var o,i;o=[n(25142),n(66044),n(69941),n(39941),n(29412),n(85233)],void 0===(i=function(e,t,n,o,i,a){const c={};let r,s,d="",l=0,p=0;const g=[];function f(e){const t=ajaxify.data,n=t.selectedCids&&t.selectedCids.length&&-1===t.selectedCids.indexOf(parseInt(e.cid,10)),o=t.selectedFilter&&"watched"===t.selectedFilter.filter,i=t.template.category&&parseInt(t.cid,10)!==parseInt(e.cid,10),c=!!(n||o||i||g.includes(e.tid));a.fire("filter:topicList.onNewTopic",{topic:e,preventAlert:c}).then((t=>{t.preventAlert||(e.scheduled&&e.tid&&g.push(e.tid),l+=1,h())}))}function u(e){const t=e.posts[0];if(!t||!t.topic||t.topic.isFollowing)return;const n=ajaxify.data,o=parseInt(t.topic.mainPid,10)===parseInt(t.pid,10),i=n.selectedCids&&n.selectedCids.length&&-1===n.selectedCids.indexOf(parseInt(t.topic.cid,10)),c=n.selectedFilter&&"new"===n.selectedFilter.filter,r=n.selectedFilter&&"watched"===n.selectedFilter.filter&&!t.topic.isFollowing,s=n.template.category&&parseInt(n.cid,10)!==parseInt(t.topic.cid,10),d=!!(o||i||c||r||s);a.fire("filter:topicList.onNewPost",{post:t,preventAlert:d}).then((e=>{e.preventAlert||(p+=1,h())}))}function h(){let e="";0===l?1===p?e="[[recent:there-is-a-new-post]]":p>1&&(e="[[recent:there-are-new-posts, "+p+"]]"):1===l?0===p?e="[[recent:there-is-a-new-topic]]":1===p?e="[[recent:there-is-a-new-topic-and-a-new-post]]":p>1&&(e="[[recent:there-is-a-new-topic-and-new-posts, "+p+"]]"):l>1&&(0===p?e="[[recent:there-are-new-topics, "+l+"]]":1===p?e="[[recent:there-are-new-topics-and-a-new-post, "+l+"]]":p>1&&(e="[[recent:there-are-new-topics-and-new-posts, "+l+", "+p+"]]")),e+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(e).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}function m(t,n,o){o=o||function(){};const i=utils.params();i.page=function(e,t){return Math.floor(e/config.topicsPerPage)+(t>0?1:0)}(t,n),e.loadMoreXhr(i,o)}function y(t,o,i,c,r){if(!o||!o.length)return $("#load-more-btn").hide(),r();if(!(o=function(e){return e.filter((function(e){return!s.find('[component="category/topic"][data-tid="'+e.tid+'"]').length}))}(o)).length)return $("#load-more-btn").hide(),r();let d,l;const p=s.find('[component="category/topic"]');c>0&&o.length?d=p.last():c<0&&o.length&&(l=p.first());const g={topics:o,showSelect:i,template:{name:t}};g.template[t]=!0,a.fire("action:topics.loading",{topics:o,after:d,before:l}),app.parseAndTranslate(t,"topics",g,(function(i){if(s.removeClass("hidden"),$("#category-no-topics").remove(),d&&d.length)i.insertAfter(d);else if(l&&l.length){const e=$(document).height(),t=$(window).scrollTop();i.insertBefore(l),$(window).scrollTop(t+($(document).height()-e))}else s.append(i);n.getSelectedTids().length||e.removeExtra(s.find('[component="category/topic"]'),c,Math.max(60,3*config.topicsPerPage)),i.find(".timeago").timeago(),app.createUserTooltips(i),utils.makeNumbersHumanReadable(i.find(".human-readable-number")),a.fire("action:topics.loaded",{topics:o,template:t}),r()}))}return $(window).on("action:ajaxify.start",(function(){c.removeListeners(),i.removeListeners()})),c.init=function(n,l){s=$('[component="category"]').filter((function(e,t){return!$(t).parents("[widget-area],[data-widget-area]").length})),d=n,r=l||m,i.init(),c.watchForNewPosts();const p=["watching"];ajaxify.data.selectedFilter&&"watched"===ajaxify.data.selectedFilter.filter?p.push("notwatching","ignoring"):"unread"!==n&&p.push("notwatching"),o.init($('[component="category/dropdown"]'),{states:p}),config.usePagination||e.init(c.loadMoreTopics),t.init((function(e,t){r(e,1,(function(e,n){y(d,e.topics,ajaxify.data.showSelect,1,(function(){t(),n()}))}))})),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",(function(){c.loadMoreTopics(1)})),a.fire("action:topics.loaded",{topics:ajaxify.data.topics})},c.watchForNewPosts=function(){$("#new-topics-alert").on("click",(function(){$(this).addClass("hide")})),p=0,l=0,c.removeListeners(),socket.on("event:new_topic",f),socket.on("event:new_post",u)},c.removeListeners=function(){socket.removeListener("event:new_topic",f),socket.removeListener("event:new_post",u)},c.loadMoreTopics=function(e){if(!s.length||!s.children().length)return;const t=s.find('[component="category/topic"]'),n=e>0?t.last():t.first(),o=(parseInt(n.attr("data-index"),10)||0)+(e>0?1:0);!utils.isNumber(o)||0===o&&s.find('[component="category/topic"][data-index="0"]').length||r(o,e,(function(t,n){y(d,t.topics,ajaxify.data.showSelect,e,n)}))},c}.apply(t,o))||(e.exports=i)}}]);