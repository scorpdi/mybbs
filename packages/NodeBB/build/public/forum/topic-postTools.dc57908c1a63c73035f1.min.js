"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4610,7214,6503,2344,549,3014,8786,71,8818,831,7927],{78989:(t,o,n)=>{var e,a;e=[n(31369)],void 0===(a=function(t){const o={init:function(){$("body").on("click",'[component="pagination/select-page"]',(function(){return t.prompt("[[global:enter_page_number]]",(function(t){o.loadPage(t)})),!1}))},loadPage:function(t,o){if(o=o||function(){},t=parseInt(t,10),!utils.isNumber(t)||t<1||t>ajaxify.data.pagination.pageCount)return;const n=utils.params();n.page=t;const e=window.location.pathname+"?"+$.param(n);ajaxify.go(e,o)},nextPage:function(t){o.loadPage(ajaxify.data.pagination.currentPage+1,t)},previousPage:function(t){o.loadPage(ajaxify.data.pagination.currentPage-1,t)}};return o}.apply(o,e))||(t.exports=a)},54939:(t,o,n)=>{var e,a;e=[n(78942),n(42840),n(7237),n(32230),n(13578),n(74344),n(31369),n(7927),n(85233)],void 0===(a=function(t,o,e,a,i,c,s,r,p){const l={};let d=!1;async function u(t,o){const n=await m();x((async function(){let e=await h(t);"0"!==g(t,"data-uid")&&g(t,"data-userslug")||(e="");const a=t.is('[component="post/reply"]')?g(t,"data-pid"):null,i=!a||!n.pid||a===n.pid;n.text&&i?(e=e||n.username,p.fire("action:composer.addQuote",{tid:o,pid:a,topicName:ajaxify.data.titleRaw,username:e,text:n.text,selectedPid:n.pid})):p.fire("action:composer.post.new",{tid:o,pid:a,topicName:ajaxify.data.titleRaw,text:e?e+" ":$('[component="topic/quickreply/text"]').val()||""})}))}async function f(t,o){const n=await m();x((async function(){const e=await h(t),a=g(t,"data-pid");function i(t){p.fire("action:composer.addQuote",{tid:o,pid:a,username:e,topicName:ajaxify.data.titleRaw,text:t})}if(n.text&&a&&a===n.pid)return i(n.text);socket.emit("posts.getRawPost",a,(function(t,o){if(t)return r.error(t);i(o)}))}))}async function m(){let t,o="",n="";const e=window.getSelection?window.getSelection():document.selection.createRange();let a;if($('[component="post"] [component="post/content"]').each((function(t,o){e&&e.containsNode&&o&&e.containsNode(o,!0)&&(a=o)})),a){const i=document.createRange();i.selectNodeContents(a);const c=e.getRangeAt(0).cloneRange();c.compareBoundaryPoints(Range.START_TO_START,i)<0&&c.setStart(i.startContainer,i.startOffset),c.compareBoundaryPoints(Range.END_TO_END,i)>0&&c.setEnd(i.endContainer,i.endOffset),i.detach(),o=c.toString(),t=$(a).parents('[component="post"]').attr("data-pid"),n=await h($(a)),c.detach()}return{text:o,pid:t,username:n}}function g(t,o){return t.parents("[data-pid]").attr(o)}function h(t){return new Promise((o=>{let e="";if("topic/reply"===t.attr("component"))return void o(e);const a=t.parents("[data-pid]");a.length?Promise.all([n.e(2772),n.e(999)]).then((function(){var t=[n(22568)];(function(t){e=t(a.attr("data-username"),!0),e||(e="0"!==a.attr("data-uid")?"[[global:former_user]]":"[[global:guest]]"),e&&"[[global:former_user]]"!==e&&"[[global:guest]]"!==e&&(e="@"+e),o(e)}).apply(null,t)})).catch(n.oe):o(e)}))}function y(t){const o=g(t,"data-pid");w(e.get("post","pid",o).hasClass("deleted")?"restore":"delete",o)}async function w(t,o){({action:t}=await p.fire(`static:post.${t}`,{action:t,pid:o})),t&&s.confirm("[[topic:post_"+t+"_confirm]]",(function(n){if(!n)return;const e="purge"===t?"":"/state";c["restore"===t?"put":"del"](`/posts/${o}${e}`).catch(r.error)}))}function x(t){const o=Math.min(Date.now()-864e5*ajaxify.data.topicStaleDays,864e13);if(d||ajaxify.data.lastposttime>=o)return t();s.dialog({title:"[[topic:stale.title]]",message:"[[topic:stale.warning]]",buttons:{reply:{label:"[[topic:stale.reply_anyway]]",className:"btn-link",callback:function(){d=!0,t()}},create:{label:"[[topic:stale.create]]",className:"btn-primary",callback:function(){a.translate("[[topic:link_back, "+ajaxify.data.title+", "+config.relative_path+"/topic/"+ajaxify.data.slug+"]]",(function(t){p.fire("action:composer.topic.new",{cid:ajaxify.data.cid,body:t,fromStaleTopic:!0})}))}}}}).modal()}l.init=function(o){d=!1,$('[component="topic"]').on("show.bs.dropdown",".moderator-tools",(function(){const t=$(this),o=t.find(".dropdown-menu");if(o.html())return;const e=t.parents("[data-pid]"),a=e.attr("data-pid"),i=parseInt(e.attr("data-index"),10);socket.emit("posts.loadPostTools",{pid:a,cid:ajaxify.data.cid},(async(t,e)=>{if(t)return r.error(t);e.posts.display_move_tools=e.posts.display_move_tools&&0!==i;const a=await app.parseAndTranslate("partials/topic/post-menu-list",e),c=n(42152);o.html(a),o.get(0).classList.toggle("hidden",!1),new c("[data-clipboard-text]"),p.fire("action:post.tools.load",{element:o})}))})),function(t){const o=e.get("topic");function s(t,o,n){if(!ajaxify.data.privileges.isAdminOrMod&&t&&Date.now()-o>1e3*t){const o=Math.floor(t/86400),e=Math.floor(t%86400/3600),a=Math.floor(t%86400%3600/60),i=t%86400%3600%60;let c="[[error:"+n+", "+t+"]]";return o?c=e?"[[error:"+n+"-days-hours, "+o+", "+e+"]]":"[[error:"+n+"-days, "+o+"]]":e?c=a?"[[error:"+n+"-hours-minutes, "+e+", "+a+"]]":"[[error:"+n+"-hours, "+e+"]]":a&&(c=i?"[[error:"+n+"-minutes-seconds, "+a+", "+i+"]]":"[[error:"+n+"-minutes, "+a+"]]"),r.error(c),!1}return!0}ajaxify.data.privileges["topics:reply"]&&(p.onPage("action:posts.loaded",v),$(document).off("selectionchange",k).on("selectionchange",k)),o.on("click",'[component="post/quote"]',(function(){f($(this),t)})),o.on("click",'[component="post/reply"]',(function(){u($(this),t)})),$(".topic").on("click",'[component="topic/reply"]',(function(o){o.preventDefault(),u($(this),t)})),$(".topic").on("click",'[component="topic/reply-as-topic"]',(function(){a.translate("[[topic:link_back, "+ajaxify.data.titleRaw+", "+config.relative_path+"/topic/"+ajaxify.data.slug+"]]",(function(t){p.fire("action:composer.topic.new",{cid:ajaxify.data.cid,body:t})}))})),o.on("click",'[component="post/bookmark"]',(function(){return function(t,o){const n="false"===t.attr("data-bookmarked")?"put":"del";return c[n](`/posts/${o}/bookmark`,void 0,(function(t){if(t)return r.error(t);const e="put"===n?"bookmark":"unbookmark";p.fire(`action:post.${e}`,{pid:o})})),!1}($(this),g($(this),"data-pid"))})),o.on("click",'[component="post/upvote"]',(function(){return i.toggleVote($(this),".upvoted",1)})),o.on("click",'[component="post/downvote"]',(function(){return i.toggleVote($(this),".downvoted",-1)})),o.on("click",'[component="post/vote-count"]',(function(){i.showVotes(g($(this),"data-pid"))})),o.on("click",'[component="post/flag"]',(function(){const t=g($(this),"data-pid");n.e(1803).then((function(){var o=[n(41803)];(function(o){o.showFlagModal({type:"post",id:t})}).apply(null,o)})).catch(n.oe)})),o.on("click",'[component="post/flagUser"]',(function(){const t=g($(this),"data-uid");n.e(1803).then((function(){var o=[n(41803)];(function(o){o.showFlagModal({type:"user",id:t})}).apply(null,o)})).catch(n.oe)})),o.on("click",'[component="post/flagResolve"]',(function(){const t=$(this).attr("data-flagId");n.e(1803).then((function(){var o=[n(41803)];(function(o){o.resolve(t)}).apply(null,o)})).catch(n.oe)})),o.on("click",'[component="post/edit"]',(function(){const t=$(this),o=parseInt(g(t,"data-timestamp"),10);s(parseInt(ajaxify.data.postEditDuration,10),o,"post-edit-duration-expired")&&p.fire("action:composer.post.edit",{pid:g(t,"data-pid")})})),config.enablePostHistory&&ajaxify.data.privileges["posts:history"]&&o.on("click",'[component="post/view-history"], [component="post/edit-indicator"]',(function(){const t=$(this);n.e(4654).then((function(){var o=[n(34654)];(function(o){o.open(g(t,"data-pid"))}).apply(null,o)})).catch(n.oe)})),o.on("click",'[component="post/delete"]',(function(){const t=$(this),o=parseInt(g(t,"data-timestamp"),10);s(parseInt(ajaxify.data.postDeleteDuration,10),o,"post-delete-duration-expired")&&y($(this))})),o.on("click",'[component="post/restore"]',(function(){y($(this))})),o.on("click",'[component="post/purge"]',(function(){w("purge",g($(this),"data-pid"))})),o.on("click",'[component="post/move"]',(function(){const t=$(this);n.e(3094).then((function(){var o=[n(53094)];(function(o){o.init(t.parents("[data-pid]"))}).apply(null,o)})).catch(n.oe)})),o.on("click",'[component="post/change-owner"]',(function(){const t=$(this);n.e(6111).then((function(){var o=[n(6111)];(function(o){o.init(t.parents("[data-pid]"))}).apply(null,o)})).catch(n.oe)})),o.on("click",'[component="post/ban-ip"]',(function(){const t=$(this).attr("data-ip");socket.emit("blacklist.addRule",t,(function(t){if(t)return r.error(t);r.success("[[admin/manage/blacklist:ban-ip]]")}))})),o.on("click",'[component="post/chat"]',(function(){!function(t){const o=t.parents("[data-pid]");n.e(4337).then((function(){var t=[n(93216)];(function(t){t.newChat(o.attr("data-uid"))}).apply(null,t)})).catch(n.oe),t.parents(".btn-group").find(".dropdown-toggle").click()}($(this))}))}(o),t.addShareHandlers(ajaxify.data.titleRaw),i.addVoteHandler(),l.updatePostCount(ajaxify.data.postcount)},l.toggle=function(t,o){const n=e.get("post","pid",t);n.find('[component="post/quote"], [component="post/bookmark"], [component="post/reply"], [component="post/flag"], [component="user/chat"]').toggleClass("hidden",o),n.find('[component="post/delete"]').toggleClass("hidden",o).parent().attr("hidden",o?"":null),n.find('[component="post/restore"]').toggleClass("hidden",!o).parent().attr("hidden",o?null:""),n.find('[component="post/purge"]').toggleClass("hidden",!o).parent().attr("hidden",o?null:""),l.removeMenu(n)},l.removeMenu=function(t){t.find('[component="post/tools"] .dropdown-menu').html("")},l.updatePostCount=function(t){const n=e.get("topic/post-count");n.html(t).attr("title",t),utils.makeNumbersHumanReadable(n),o.setCount(t)};const k=utils.debounce((function(){""===window.getSelection().toString()?$('[component="selection/tooltip"]').addClass("hidden"):v()}),100);async function v(){let t=$('[component="selection/tooltip"]');if(t.addClass("hidden"),"1"===t.attr("data-ajaxify"))return void t.remove();const o=window.getSelection();if(o.focusNode&&"Range"===o.type&&ajaxify.data.template.topic){const n=$(o.focusNode),e=$(o.anchorNode);if(e.parents("[data-pid]").attr("data-pid")!==n.parents("[data-pid]").attr("data-pid")||!n.parents('[component="post/content"]').length||!e.parents('[component="post/content"]').length)return;const a=n.parents("[data-pid]"),i=o.getRangeAt(0);if(!a.length||i.collapsed)return;const c=i.getClientRects(),s=c[c.length-1];t.length||(t=await app.parseAndTranslate("partials/topic/selection-tooltip",ajaxify.data),t.addClass("hidden").appendTo("body")),t.off("click").on("click",'[component="selection/tooltip/quote"]',(function(){t.addClass("hidden"),f(a.find('[component="post/quote"]'),ajaxify.data.tid)})),t.removeClass("hidden"),$(window).one("action:ajaxify.start",(function(){t.attr("data-ajaxify",1).addClass("hidden"),$(document).off("selectionchange",k)}));const r=t.outerWidth(!0);t.css({top:s.bottom+$(window).scrollTop(),left:r>s.width?s.left:s.left+s.width-r})}}return l}.apply(o,e))||(t.exports=a)},13578:(t,o,n)=>{var e,a;e=[n(7237),n(32230),n(74344),n(85233),n(31369),n(7927)],void 0===(a=function(t,o,n,e,a,i){const c={};function s(t){t.stopPropagation();const n=$(this),e=n.parent();e.find(".tooltip").css("display","none");const a=e.parents("[data-pid]").attr("data-pid");return socket.emit("posts.getUpvoters",[a],(function(t,e){if(t)return i.error(t);e.length&&function(t,n){function e(o){t.attr("title",o).tooltip("fixTitle").tooltip("show"),t.parent().find(".tooltip").css("display","")}let a=n.usernames.filter((t=>"[[global:former_user]]"!==t));a.length&&(a.length+n.otherCount>6?(a=a.join(", ").replace(/,/g,"|"),o.translate("[[topic:users_and_others, "+a+", "+n.otherCount+"]]",(function(t){e(t=t.replace(/\|/g,","))}))):(a=a.join(", "),e(a)))}(n,e[0])})),!1}return c.addVoteHandler=function(){t.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',s)},c.toggleVote=function(t,o,a){const c=t.closest("[data-pid]"),s=c.find(o).length?"del":"put",r=c.attr("data-pid");return n[s](`/posts/${r}/vote`,{delta:a},(function(t){if(t)return app.user.uid?i.error(t):void ajaxify.go("login");e.fire("action:post.toggleVote",{pid:r,delta:a,unvote:"del"===s})})),!1},c.showVotes=function(t){socket.emit("posts.getVoters",{pid:t,cid:ajaxify.data.cid},(function(t,o){if(t){if("[[error:no-privileges]]"===t.message)return;return i.error(t)}app.parseAndTranslate("partials/modals/votes_modal",o,(function(t){const o=a.dialog({title:"[[global:voters]]",message:t,className:"vote-modal",show:!0});o.on("click",(function(){o.modal("hide")}))}))}))},c}.apply(o,e))||(t.exports=a)},7927:(t,o,n)=>{var e,a;e=[n(32230),n(7237),n(85233)],a=function(t,o,n){const e={};function a(t,o){t.find("strong").translateHtml(o.title),t.find("p").translateHtml(o.message),t.attr("class","alert alert-dismissable alert-"+o.type+" clearfix"),clearTimeout(parseInt(t.attr("timeoutId"),10)),o.timeout&&c(t,o),n.fire("action:alert.update",{alert:t,params:o}),t.off("click").removeClass("pointer"),"function"==typeof o.clickfn&&t.addClass("pointer").on("click",(function(n){$(n.target).is(".close")||o.clickfn(),i(t)}))}function i(t){t.fadeOut(500,(function(){$(this).remove()}))}function c(t,o){const e=o.timeout,a=setTimeout((function(){i(t),"function"==typeof o.timeoutfn&&o.timeoutfn(t,o)}),e);t.attr("timeoutId",a),t.css("transition-property","none"),t.removeClass("animate"),setTimeout((function(){t.css("transition-property",""),t.css("transition","width "+(e+450)+"ms linear, background-color "+(e+450)+"ms ease-in"),t.addClass("animate"),n.fire("action:alert.animate",{alert:t,params:o})}),50),t.on("mouseenter",(function(){$(this).css("transition-duration",0)}))}return e.alert=function(t){t.alert_id="alert_button_"+(t.alert_id?t.alert_id:(new Date).getTime()),t.title=t.title&&t.title.trim()||"",t.message=t.message?t.message.trim():"",t.type=t.type||"info";const e=$("#"+t.alert_id);e.length?a(e,t):function(t){app.parseAndTranslate("alert",t,(function(e){let s=$("#"+t.alert_id);if(s.length)return a(s,t);s=e,s.fadeIn(200),o.get("toaster/tray").prepend(s),"function"==typeof t.closefn&&s.find("button").on("click",(function(){return t.closefn(),i(s),!1})),t.timeout&&c(s,t),"function"==typeof t.clickfn&&s.addClass("pointer").on("click",(function(o){$(o.target).is(".close")||t.clickfn(s,t),i(s)})),n.fire("action:alert.new",{alert:s,params:t})}))}(t)},e.success=function(t,o){e.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:t,type:"success",timeout:o||5e3})},e.error=function(t,o){if("[[error:revalidate-failure]]"===(t=t&&t.message||t))return socket.disconnect(),void app.reconnect();e.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:t,type:"danger",timeout:o||1e4})},e.remove=function(t){$("#alert_button_"+t).remove()},e}.apply(o,e),void 0===a||(t.exports=a)},74344:(t,o,n)=>{var e,a;e=[n(85233)],void 0===(a=(t=>{const o={},n=config.relative_path+"/api/v3";function e(o,e){async function a(n){({options:o}=await t.fire("filter:api.options",{options:o})),$.ajax(o).done((t=>{n(null,t&&t.hasOwnProperty("status")&&t.hasOwnProperty("response")?t.response:t||{})})).fail((t=>{let o;t.responseJSON&&(o=t.responseJSON.status&&t.responseJSON.status.message?t.responseJSON.status.message:t.responseJSON.error),n(new Error(o||t.statusText))}))}if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:n+o.url,"function"!=typeof e)return new Promise(((t,o)=>{a((function(n,e){n?o(n):t(e)}))}));a(e)}return o.get=(t,o,n)=>e({url:t+(o&&Object.keys(o).length?"?"+$.param(o):"")},n),o.head=(t,o,n)=>e({url:t+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"head"},n),o.post=(t,o,n)=>e({url:t,method:"post",data:JSON.stringify(o||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),o.patch=(t,o,n)=>e({url:t,method:"patch",data:JSON.stringify(o||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),o.put=(t,o,n)=>e({url:t,method:"put",data:JSON.stringify(o||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),o.del=(t,o,n)=>e({url:t,method:"delete",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),o.delete=o.del,o}).apply(o,e))||(t.exports=a)},7237:(t,o,n)=>{var e;void 0===(e=function(){const t={};return t.core={"topic/teaser":function(t){return t?$('[component="category/topic"][data-tid="'+t+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(t,o){return $('[component="topic"][data-'+t+'="'+o+'"]')},post:function(t,o){return $('[component="post"][data-'+t+'="'+o+'"]')},"post/content":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/content"]')},"post/header":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/header"]')},"post/anchor":function(t){return $('[component="post"][data-index="'+t+'"] [component="post/anchor"]')},"post/vote-count":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/vote-count"]')},"post/bookmark-count":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/bookmark-count"]')},"user/postcount":function(t){return $('[component="user/postcount"][data-uid="'+t+'"]')},"user/reputation":function(t){return $('[component="user/reputation"][data-uid="'+t+'"]')},"category/topic":function(t,o){return $('[component="category/topic"][data-'+t+'="'+o+'"]')},"categories/category":function(t,o){return $('[component="categories/category"][data-'+t+'="'+o+'"]')},"chat/message":function(t){return $('[component="chat/message"][data-mid="'+t+'"]')},"chat/message/body":function(t){return $('[component="chat/message"][data-mid="'+t+'"] [component="chat/message/body"]')},"chat/recent/room":function(t){return $('[component="chat/recent/room"][data-roomid="'+t+'"]')}},t.get=function(){const o=Array.prototype.slice.call(arguments,1);return t.core[arguments[0]]&&o.length?t.core[arguments[0]].apply(this,o):$('[component="'+arguments[0]+'"]')},t}.call(o,n,o,t))||(t.exports=e)},42840:(t,o,n)=>{var e,a;e=[n(78989),n(7237),n(85233),n(7927)],void 0===(a=function(t,o,n,e){const a={};let i,c,s,r,p,l=0,d=0,u=!1,f=!0;a.scrollActive=!1;let m,g,h,y,w,x=$(".pagination-block"),k=x.find(".pagination-text"),v=x.find("meter"),b=x.find(".progress-bar");$(window).on("action:ajaxify.start",(function(){$(window).off("keydown",N)})),a.init=function(t,o,e,i,d){l=0,a.selector=t,a.callback=d,a.toTop=e||function(){},a.toBottom=i||function(){},x=$(".pagination-block"),k=x.find(".pagination-text"),v=x.find("meter"),b=x.find(".progress-bar"),h=$(".scroller-thumb-icon"),y=h.height(),w=y/2,m=$(".scroller-thumb"),g=m.find(".thumb-text"),$(window).off("scroll",a.delayedUpdate).on("scroll",a.delayedUpdate),x.find(".dropdown-menu").off("click").on("click",(function(t){t.stopPropagation()})),x.off("shown.bs.dropdown",".wrapper").on("shown.bs.dropdown",".wrapper",(function(){setTimeout((async function(){"lg"===utils.findBootstrapEnvironment()&&$(".pagination-block input").focus(),await socket.emit("topics.getPostCountInTopic",ajaxify.data.tid)>0&&x.find("#myNextPostBtn").removeAttr("disabled")}),100)})),x.find(".pageup").off("click").on("click",a.scrollUp),x.find(".pagedown").off("click").on("click",a.scrollDown),x.find(".pagetop").off("click").on("click",a.toTop),x.find(".pagebottom").off("click").on("click",a.toBottom),x.find("#myNextPostBtn").off("click").on("click",j),x.find("input").on("keydown",(function(t){if(13===t.which){const t=$(this);if(!utils.isNumber(t.val()))return void t.val("");const o=M(parseInt(t.val(),10));t.val(""),$(".pagination-block .dropdown-toggle").trigger("click"),ajaxify.go(o)}})),ajaxify.data.template.topic&&function(){if(!m.length)return;const t=m.parent();function o(o){const n=(P(o-w)-t.offset().top)/(t.height()-y);return l=Math.max(1,Math.ceil(ajaxify.data.postcount*n)),l>ajaxify.data.postcount?ajaxify.data.count:l}t.on("click",(function(t){if($(t.target).hasClass("scroller-container")){const n=o(t.pageY);return a.scrollToIndex(n-1,!0,0),!1}}));let e=!1;function i(){$(window).off("mousemove",d),e&&(a.scrollToIndex(l-1,!0,0),x.find('[data-toggle="dropdown"]').trigger("click")),I(),e=!1,f=!1}function d(t){const n=P(t.pageY-w);m.offset({top:n,left:m.offset().left});const e=o(t.pageY);return a.updateTextAndProgressBar(),g.text(e+"/"+ajaxify.data.postcount),f&&h(),f=!1,t.stopPropagation(),!1}function h(){I(),c=setInterval((function(){C(l)}),250)}n.on("action:ajaxify.end",(function(){p=null})),$(".pagination-block .dropdown-menu").parent().on("shown.bs.dropdown",(function(){_(l)})),m.on("mousedown",(function(){e=!0,$(window).on("mousemove",d),f=!0})),$(window).off("mousemove",d),$(window).off("mouseup",i).on("mouseup",i),m.on("touchstart",(function(t){u=!0,s=Math.min($(window).width(),Math.max(0,t.touches[0].clientX)),r=Math.min($(window).height(),Math.max(0,t.touches[0].clientY)),f=!0})),m.on("touchmove",(function(t){const n=$(window).width(),e=$(window).height(),i=Math.abs(s-Math.min(n,Math.max(0,t.touches[0].clientX))),c=Math.abs(r-Math.min(e,Math.max(0,t.touches[0].clientY)));if(s=Math.min(n,Math.max(0,t.touches[0].clientX)),r=Math.min(e,Math.max(0,t.touches[0].clientY)),c>=i&&f&&(u=!0,h()),u&&t.cancelable){t.preventDefault(),t.stopPropagation();const n=P(r+$(window).scrollTop()-w);m.offset({top:n,left:m.offset().left});const e=o(r+$(window).scrollTop());a.updateTextAndProgressBar(),g.text(e+"/"+ajaxify.data.postcount),f&&C(e)}f=!1})),m.on("touchend",(function(){I(),u&&(a.scrollToIndex(l-1,!0,0),u=!1,x.find('[data-toggle="dropdown"]').trigger("click"))}))}(),config.usePagination||$(window).off("keydown",N).on("keydown",N),a.setCount(o),a.update(0)};let T=0;async function j(){async function t(t){return await socket.emit("topics.getMyNextPostIndex",{tid:ajaxify.data.tid,index:Math.max(1,t),sort:config.topicPostSort})}if(ajaxify.data.template.topic){let o=await t(l);T===o&&(o=await t(o)),o&&l!==o+1?(T=o,$(window).one("action:ajaxify.end",(function(){x.find(".dropdown-menu").is(":hidden")&&x.find(".dropdown-toggle").dropdown("toggle")})),a.scrollToIndex(o,!0,0)):(e.alert({message:"[[topic:no-more-next-post]]",type:"info"}),T=1)}}function P(t){const o=m.parent(),n=o.offset();return t<n.top?t=n.top:t>n.top+o.height()-y&&(t=n.top+o.height()-y),t}function _(t){if(!m.length||m.is(":hidden"))return;const o=m.parent(),n=o.offset();let e=(t-1)/ajaxify.data.postcount;t===d&&(e=1);const a={top:P(n.top+(o.height()-y)*e),left:m.offset().left};m.offset(a),g.text(t+"/"+ajaxify.data.postcount),C(t)}function I(){c&&(clearInterval(c),c=0)}function C(t,o){o=o||function(){},p===t||x.find(".post-content").is(":hidden")||(p=t,socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1},(function(t,n){if(t)return e.error(t);app.parseAndTranslate("partials/topic/navigation-post",{post:n},(function(t){x.find(".post-content").html(t).find(".timeago").timeago()})),o()})))}function N(t){if("BODY"===t.target.nodeName){if(t.shiftKey||t.ctrlKey||t.altKey)return;if(36===t.which&&a.toTop)return a.toTop(),!1;if(35===t.which&&a.toBottom)return a.toBottom(),!1}}function M(t){const o=window.location.pathname.replace(config.relative_path,"").split("/");return o[1]+"/"+o[2]+"/"+o[3]+(t?"/"+t:"")}function A(t){const o=ajaxify.removeRelativePath(window.location.pathname.slice(1));(!t||o.startsWith("topic")||o.startsWith("category"))&&x.toggleClass("ready",t)}return a.setCount=function(t){(t=parseInt(t,10))!==d&&(d=t,a.updateTextAndProgressBar())},a.show=function(){A(!0)},a.disable=function(){d=0,l=1,a.callback=null,a.selector=null,$(window).off("scroll",a.delayedUpdate),A(!1)},a.delayedUpdate=function(){i||(i=setTimeout((function(){a.update(),i=void 0}),100))},a.update=function(t){t="number"==typeof t?t:void 0;let n=l;const e=$(a.selector);e.length&&(n=parseInt(e.first().attr("data-index"),10)+1);const i=$(window).scrollTop(),c=$(window).height(),s=$(document).height(),r=i+c/2;let p=Number.MAX_VALUE;e.each((function(){const t=$(this),o=parseInt(t.attr("data-index"),10);if(o>=0){const e=Math.abs(r-(t.offset().top+t.outerHeight(!0)/2));if(e>p)return!1;e<p&&(n=o+1,p=e)}}));const u=0===i&&0===parseInt(e.first().attr("data-index"),10),f=i+c>s-100&&parseInt(e.last().attr("data-index"),10)===d-1;if(u?n=1:f&&(n=d),void 0===t&&ajaxify.data.template.topic)if(u)t=0;else{const n=o.get("post/anchor",l-1);n.length&&(t=n.get(0).getBoundingClientRect().top)}"function"==typeof a.callback&&a.callback(n,d,t),n!==l&&(l=n,a.updateTextAndProgressBar(),_(l)),A(!!d)},a.updateTextAndProgressBar=function(){if(!utils.isNumber(l))return;l=l>d?d:l,k.translateHtml("[[global:pagination.out_of, "+l+", "+d+"]]");const t=(l-1)/(d-1||1);v.val(t),b.width(100*t+"%")},a.scrollUp=function(){const o=$(window);if(config.usePagination&&o.scrollTop()<=0)return t.previousPage((function(){$("body,html").scrollTop($(document).height()-o.height())}));$("body,html").animate({scrollTop:o.scrollTop()-o.height()})},a.scrollDown=function(){const o=$(window);if(config.usePagination&&o.scrollTop()>=$(document).height()-o.height())return t.nextPage();$("body,html").animate({scrollTop:o.scrollTop()+o.height()})},a.scrollTop=function(t){$(a.selector+'[data-index="'+t+'"]').length?a.scrollToIndex(t,!0):ajaxify.go(M())},a.scrollBottom=function(t){parseInt(t,10)<0||($(a.selector+'[data-index="'+t+'"]').length?a.scrollToIndex(t,!0):(t=parseInt(t,10)+1,ajaxify.go(M(t))))},a.scrollToIndex=function(n,e,i){const c=!!o.get("topic").length,s=!!o.get("category").length;if(!utils.isNumber(n)||!c&&!s)return;if(i=void 0!==i?i:400,a.scrollActive=!0,c&&o.get("post/anchor",n).length)return a.scrollToPostIndex(n,e,i);if(s&&$('[component="category/topic"][data-index="'+n+'"]').length)return a.scrollToTopicIndex(n,e,i);if(!config.usePagination)return a.scrollActive=!1,n=parseInt(n,10)+1,void ajaxify.go(M(n));const r=c?a.scrollToPostIndex:a.scrollToTopicIndex,p=1+Math.floor(n/config.postsPerPage);parseInt(p,10)!==ajaxify.data.pagination.currentPage?t.loadPage(p,(function(){r(n,e,i)})):r(n,e,i)},a.scrollToPostIndex=function(t,n,e){const i=o.get("post","index",t);a.scrollToElement(i,n,e)},a.scrollToTopicIndex=function(t,o,n){const e=$('[component="category/topic"][data-index="'+t+'"]');a.scrollToElement(e,o,n)},a.scrollToElement=function(t,n,e){if(!t.length)return void(a.scrollActive=!1);const i=t.outerHeight(!0),c=o.get("navbar").outerHeight(!0),s=$(".topic-header").outerHeight(!0)||0,r=$(window).height();$(window).off("scroll",a.delayedUpdate),e=void 0!==e?e:400,a.scrollActive=!0;let p=!1;!function(){function o(){$(window).on("scroll",a.delayedUpdate);const o=t.get(0).getBoundingClientRect();a.update(o.top)}function l(){p?o():(p=!0,a.scrollActive=!1,n&&($('[component="post"],[component="category/topic"]').removeClass("highlight"),t.addClass("highlight"),setTimeout((function(){t.removeClass("highlight")}),1e4)),$("body").scrollTop($("body").scrollTop()-1),$("html").scrollTop($("html").scrollTop()-1))}let d=0;if(d=i<r-c-s?t.offset().top-r/2+i/2:t.offset().top-c-s,0===e)return $(window).scrollTop(d),l(),void o();$("html, body").animate({scrollTop:d+"px"},e,l)}()},a}.apply(o,e))||(t.exports=a)},78942:(t,o,n)=>{var e,a;e=[n(85233)],a=function(t){const o={};function n(t,o){$("#content").off("click",t).on("click",t,o)}function e(t){const o=parseInt(t.parents("[data-pid]").attr("data-pid"),10);return"/post"+(o?"/"+o:"")}return o.addShareHandlers=function(o){const a=window.location.protocol+"//"+window.location.host;function i(o,n,e,i){return window.open(o+encodeURIComponent(a+config.relative_path+n),"_blank","width="+e+",height="+i+",scrollbars=no,status=no"),t.fire("action:share.open",{url:o,urlToPost:n}),!1}$("#content").off("shown.bs.dropdown",".share-dropdown").on("shown.bs.dropdown",".share-dropdown",(function(){const t=$(this).find(".post-link");t.val(a+e($(this))),setTimeout((function(){t.putCursorAtEnd().select()}),50)})),n(".post-link",(function(t){return t.preventDefault(),!1})),n('[component="share/twitter"]',(function(){return i("https://twitter.com/intent/tweet?text="+encodeURIComponent(o)+"&url=",e($(this)),550,420)})),n('[component="share/facebook"]',(function(){return i("https://www.facebook.com/sharer/sharer.php?u=",e($(this)),626,436)})),t.fire("action:share.addHandlers",{openShare:i})},o}.apply(o,e),void 0===a||(t.exports=a)}}]);