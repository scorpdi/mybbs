"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4781,1375,8306],{91748:(t,e,o)=>{var n,i;n=[o(54939),o(60392),o(60447),o(47720),o(7237),o(32230),o(59006),o(85233)],void 0===(i=function(t,e,n,i,a,s,c,p){const r={},d={"event:user_status_change":function(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)},"event:voted":function(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter((function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)})),o=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes),o.html(t.user.reputation).attr("data-reputation",t.user.reputation)},"event:bookmarked":function(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter((function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)})).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)},"event:topic_deleted":e.setDeleteState,"event:topic_restored":e.setDeleteState,"event:topic_purged":function(t){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)},"event:topic_locked":e.setLockedState,"event:topic_unlocked":e.setLockedState,"event:topic_pinned":e.setPinnedState,"event:topic_unpinned":e.setPinnedState,"event:topic_moved":function(t){t&&t.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+t.slug,null,!0)},"event:post_edited":function(e){if(!e||!e.post||parseInt(e.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const o=a.get("post/content",e.post.pid).filter((function(t,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)})),r=$('[data-pid="'+e.post.pid+'"] [component="post/editor"]').filter((function(t,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)})),d=a.get("topic/title"),l=a.get("navbar/title").find("span"),u=a.get("breadcrumb/current");if(e.topic.rescheduled)return ajaxify.go("topic/"+e.topic.slug,null,!0);if(d.length&&e.topic.title&&e.topic.renamed){ajaxify.data.title=e.topic.title;const t="topic/"+e.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:t},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+t),d.fadeOut(250,(function(){d.html(e.topic.title).fadeIn(250)})),u.fadeOut(250,(function(){u.html(e.topic.title).fadeIn(250)})),l.fadeOut(250,(function(){l.html(e.topic.title).fadeIn(250)}))}e.post.changed?o.fadeOut(250,(function(){o.html(s.unescape(e.post.content)),o.find("img:not(.not-responsive)").addClass("img-responsive"),i.wrapImagesInLinks(o.parent()),n.addBlockquoteEllipses(o.parent()),o.fadeIn(250);const t={editor:e.editor,editedISO:utils.toISOString(e.post.edited)};app.parseAndTranslate("partials/topic/post-editor",t,(function(t){r.replaceWith(t),$('[data-pid="'+e.post.pid+'"] [component="post/editor"] .timeago').timeago(),p.fire("action:posts.edited",e)}))})):p.fire("action:posts.edited",e),e.topic.tags&&e.topic.tagsupdated&&c.render("partials/topic/tags",{tags:e.topic.tags}).then((function(t){const e=$(".tags");e.fadeOut(250,(function(){e.html(t).fadeIn(250)}))})),t.removeMenu(a.get("post","pid",e.post.pid))},"event:post_purged":function(e){e&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&(a.get("post","pid",e.pid).fadeOut(500,(function(){$(this).remove(),n.showBottomPostBar()})),ajaxify.data.postcount-=1,t.updatePostCount(ajaxify.data.postcount),o.e(1352).then((function(){var t=[o(21352)];(function(t){t.onPostPurged(e)}).apply(null,t)})).catch(o.oe))},"event:post_deleted":l,"event:post_restored":l,"posts.bookmark":u,"posts.unbookmark":u,"posts.upvote":f,"posts.downvote":f,"posts.unvote":f,"event:new_notification":function(t){const e=ajaxify.data.tid;t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)&&socket.emit("topics.markTopicNotificationsRead",[e])},"event:new_post":n.onNewPost};function l(e){const o=a.get("post","pid",e.pid);if(!o.length)return;o.toggleClass("deleted");const n=o.hasClass("deleted");t.toggle(e.pid,n),ajaxify.data.privileges.isAdminOrMod||parseInt(e.uid,10)===parseInt(app.user.uid,10)||(o.find('[component="post/tools"]').toggleClass("hidden",n),n?o.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]"):o.find('[component="post/content"]').html(s.unescape(e.content)))}function u(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter((function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}));e.length&&(e.attr("data-bookmarked",t.isBookmarked),e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function f(t){const e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter((function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)})).toggleClass("upvoted",t.upvote),e.find('[component="post/downvote"]').filter((function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)})).toggleClass("downvoted",t.downvote)}return r.init=function(){r.removeListeners();for(const t in d)d.hasOwnProperty(t)&&socket.on(t,d[t])},r.removeListeners=function(){for(const t in d)d.hasOwnProperty(t)&&socket.removeListener(t,d[t])},r}.apply(e,n))||(t.exports=i)},60392:(t,e,o)=>{var n,i;n=[o(7237),o(32230),o(66044),o(60447),o(74344),o(85233),o(31369),o(7927)],void 0===(i=function(t,e,n,i,a,s,c,p){const r={};function d(t,e,o,n){n||(n=function(){});const i=ajaxify.data.tid,s={},d=function(o){o&&a[t](`/topics/${i}${e}`,s).then(n).catch(p.error)};switch(o){case"delete":case"restore":case"purge":c.confirm(`[[topic:thread_tools.${o}_confirm]]`,d);break;case"pin":r.requestPinExpiry(s,d.bind(null,!0));break;default:d(!0)}}return r.init=function(i,r){function l(o,n=1){return a[n?"put":"del"](`/topics/${i}/${o}`,{},(()=>{let a="";"follow"===o?a=n?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":"ignore"===o&&(a=n?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),n||(o="unfollow"),function(o){e.translate({follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"}[o],(function(t){$('[component="topic/watch"] button').attr("title",t).tooltip("fixTitle")}));let n=t.get("topic/following/menu");n.toggleClass("hidden","follow"!==o),t.get("topic/following/check").toggleClass("fa-check","follow"===o),n=t.get("topic/not-following/menu"),n.toggleClass("hidden","unfollow"!==o),t.get("topic/not-following/check").toggleClass("fa-check","unfollow"===o),n=t.get("topic/ignoring/menu"),n.toggleClass("hidden","ignore"!==o),t.get("topic/ignoring/check").toggleClass("fa-check","ignore"===o)}(o),p.alert({alert_id:"follow_thread",message:a,type:"success",timeout:5e3}),s.fire("action:topics.changeWatching",{tid:i,type:o})}),(()=>{p.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})})),!1}r.on("show.bs.dropdown",".thread-tools",(function(){const t=$(this).find(".dropdown-menu");t.html()||(t.toggleClass("hidden",!0),socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},(function(e,o){if(e)return p.error(e);app.parseAndTranslate("partials/topic/topic-menu-list",o,(function(e){t.html(e),t.toggleClass("hidden",!1),s.fire("action:topic.tools.load",{element:t})}))})))})),r.on("click",'[component="topic/delete"]',(function(){return d("del","/state","delete"),!1})),r.on("click",'[component="topic/restore"]',(function(){return d("put","/state","restore"),!1})),r.on("click",'[component="topic/purge"]',(function(){return d("del","","purge"),!1})),r.on("click",'[component="topic/lock"]',(function(){return d("put","/lock","lock"),!1})),r.on("click",'[component="topic/unlock"]',(function(){return d("del","/lock","unlock"),!1})),r.on("click",'[component="topic/pin"]',(function(){return d("put","/pin","pin"),!1})),r.on("click",'[component="topic/unpin"]',(function(){return d("del","/pin","unpin"),!1})),r.on("click",'[component="topic/event/delete"]',(function(){const t=$(this).attr("data-topic-event-id"),e=$(this).parents('[component="topic/event"]');c.confirm("[[topic:delete-event-confirm]]",(o=>{o&&a.del(`/topics/${i}/events/${t}`,{}).then((function(){e.remove()})).catch(p.error)}))})),r.on("click",'[component="topic/mark-unread"]',(function(){return socket.emit("topics.markUnread",i,(function(t){if(t)return p.error(t);app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,(function(){n.onBackClicked(!0)})):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,n.onBackClicked),p.success("[[topic:mark_unread.success]]")})),!1})),r.on("click",'[component="topic/mark-unread-for-all"]',(function(){const t=$(this);return socket.emit("topics.markAsUnreadForAll",[i],(function(e){if(e)return p.error(e);p.success("[[topic:markAsUnreadForAll.success]]"),t.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")})),!1})),r.on("click",'[component="topic/move"]',(function(){return o.e(7378).then((function(){var t=[o(57378)];(function(t){t.init([i],ajaxify.data.cid)}).apply(null,t)})).catch(o.oe),!1})),r.on("click",'[component="topic/delete/posts"]',(function(){o.e(5253).then((function(){var t=[o(55253)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),r.on("click",'[component="topic/fork"]',(function(){o.e(5636).then((function(){var t=[o(25636)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),r.on("click",'[component="topic/move-posts"]',(function(){o.e(3094).then((function(){var t=[o(53094)];(function(t){t.init()}).apply(null,t)})).catch(o.oe)})),r.on("click",'[component="topic/following"]',(function(){l("follow")})),r.on("click",'[component="topic/not-following"]',(function(){l("follow",0)})),r.on("click",'[component="topic/ignoring"]',(function(){l("ignore")}))},r.requestPinExpiry=function(t,e){app.parseAndTranslate("modals/set-pin-expiry",{},(function(o){const n=c.dialog({title:"[[topic:thread_tools.pin]]",message:o,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let o=n.get(0).querySelector("#expiry").value;if(""===o)return e();o=new Date(o),o&&o.getTime()>Date.now()?(t.expiry=o.getTime(),e()):p.error("[[error:invalid-date]]")}}}})}))},r.setLockedState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;const n=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null),t.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",e.isLocked?null:"");const a=!(!e.isLocked&&!ajaxify.data.deleted||ajaxify.data.privileges.isAdminOrMod);t.get("topic/reply/container").toggleClass("hidden",a),t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",a),o.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",n),o.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",n),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!e.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=e.isLocked,i.addTopicEvents(e.events)},r.setDeleteState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;t.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null),t.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),t.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),t.get("topic/deleted/message").toggleClass("hidden",!e.isDelete),e.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:e.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},(function(e){t.get("topic/deleted/message").replaceWith(e),e.find(".timeago").timeago()}));const n=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/reply/container").toggleClass("hidden",n),t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",n),o.toggleClass("deleted",e.isDelete),ajaxify.data.deleted=e.isDelete?1:0,i.addTopicEvents(e.events)},r.setPinnedState=function(e){const o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;t.get("topic/pin").toggleClass("hidden",e.pinned).parent().attr("hidden",e.pinned?"":null),t.get("topic/unpin").toggleClass("hidden",!e.pinned).parent().attr("hidden",e.pinned?null:"");const n=$('[component="topic/labels"] [component="topic/pinned"]');n.toggleClass("hidden",!e.pinned),e.pinned&&n.translateAttr("title",e.pinExpiry&&e.pinExpiryISO?"[[topic:pinned-with-expiry, "+e.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=e.pinned,i.addTopicEvents(e.events)},r}.apply(e,n))||(t.exports=i)},66044:(t,e,o)=>{var n,i;n=[o(7237),o(66603),o(42840),o(78989)],void 0===(i=function(t,e,o,n){const i={};let a;function s(t){const o=t&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||o){let t=e.getItem("category:bookmark"),o=e.getItem("category:bookmark:clicked");if(e.removeItem("category:bookmark"),e.removeItem("category:bookmark:clicked"),!utils.isNumber(t))return;if(t=Math.max(0,parseInt(t,10)||0),o=Math.max(0,parseInt(o,10)||0),config.usePagination){const e=Math.ceil((parseInt(t,10)+1)/config.topicsPerPage);parseInt(e,10)!==ajaxify.data.pagination.currentPage?n.loadPage(e,(function(){i.scrollToTopic(t,o)})):i.scrollToTopic(t,o)}else{if(0===t)return void i.scrollToTopic(t,o);$('[component="category"]').empty(),a(Math.max(0,t-1)+1,(function(){i.scrollToTopic(t,o)}))}}}return i.init=function(t){a=t,$('[component="category"]').on("click",'[component="topic/header"]',(function(){const t=$(this).parents("[data-index]").attr("data-index"),o=$(window).scrollTop();$('[component="category/topic"]').each((function(n,i){if($(i).offset().top-o>0)return e.setItem("category:bookmark",$(i).attr("data-index")),e.setItem("category:bookmark:clicked",t),e.setItem("category:bookmark:offset",$(i).offset().top-o),!1}))})),$(window).off("action:popstate",s).on("action:popstate",s)},i.onBackClicked=s,i.highlightTopic=function(e){const o=t.get("category/topic","index",e);o.length&&!o.hasClass("highlight")&&(o.addClass("highlight"),setTimeout((function(){o.removeClass("highlight")}),5e3))},i.scrollToTopic=function(n,a){if(!utils.isNumber(n))return;const s=t.get("category/topic","index",n);if(s.length){const t=e.getItem("category:bookmark:offset");e.removeItem("category:bookmark:offset"),$(window).scrollTop(s.offset().top-t),i.highlightTopic(a),o.update()}},i}.apply(e,n))||(t.exports=i)},66603:(t,e,o)=>{var n;void 0===(n=function(){function t(){this._store={},this._keys=[]}let e;t.prototype.isMock=!0,t.prototype.setItem=function(t,e){t=String(t),-1===this._keys.indexOf(t)&&this._keys.push(t),this._store[t]=e},t.prototype.getItem=function(t){return t=String(t),-1===this._keys.indexOf(t)?null:this._store[t]},t.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter((function(e){return e!==t})),this._store[t]=null},t.prototype.clear=function(){this._keys=[],this._store={}},t.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(t.prototype,"length",{get:function(){return this._keys.length}});const o=Date.now().toString();try{if(e=window.localStorage,e.setItem(o,o),e.getItem(o)!==o)throw Error("localStorage behaved unexpectedly");return e.removeItem(o),e}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(e=window.sessionStorage,e.setItem(o,o),e.getItem(o)!==o)throw Error("sessionStorage behaved unexpectedly");return e.removeItem(o),e}catch(e){return console.warn(e),console.warn("sessionStorage failed, falling back on memory storage"),new t}}}.call(e,o,e,t))||(t.exports=n)}}]);