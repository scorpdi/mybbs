"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[160,7214,6503,2852,3014,8253,71,999,831,7927,6193],{54582:(e,t,n)=>{var a,s;a=[n(32230),n(59006),n(86193),n(74344),n(22568),n(31369),n(7927),n(23884)],void 0===(s=function(e,t,n,a,s,r,o,i){const c={};function u(e){return $("#user-search").val()?(e.query=$("#user-search").val(),e.searchBy=$("#user-search-by").val()):(delete e.query,delete e.searchBy),decodeURIComponent($.param(e))}function l(){const e=[];return $("#filter-by").find("[data-filter-by]").each((function(){$(this).find(".fa-check").length&&e.push($(this).attr("data-filter-by"))})),e}return c.init=function(){function c(){const e=[];return $('.users-table [component="user/select/single"]').each((function(){$(this).is(":checked")&&e.push($(this).attr("data-uid"))})),e}function d(e,t){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(e).each((function(){$(this).toggleClass("hidden",!t)}))}function m(){$('.users-table [component="user/select/single"]').prop("checked",!1),$('.users-table [component="user/select/all"]').prop("checked",!1)}function p(e,t,n){return function(a){if(a)return o.error(a);o.success(e),t&&d(t,n),m()}}function f(e,t,n){o.success(e),t&&d(t,n),m()}$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",(function(){const e=utils.params();e.resultsPerPage=$("#results-per-page").val();const t=u(e);ajaxify.go(window.location.pathname+"?"+t)})),$(".export-csv").on("click",(function(){return socket.once("event:export-users-csv",(function(){o.remove("export-users-start"),o.alert({alert_id:"export-users",type:"success",title:"[[global:alert.success]]",message:"[[admin/manage/users:export-users-completed]]",clickfn:function(){window.location.href=config.relative_path+"/api/admin/users/csv"},timeout:0})})),socket.emit("admin.user.exportUsersCSV",{},(function(e){if(e)return o.error(e);o.alert({alert_id:"export-users-start",message:"[[admin/manage/users:export-users-started]]",timeout:ajaxify.data.userCount/5e3*500})})),!1})),$('[component="user/select/all"]').on("click",(function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))})),$(".manage-groups").on("click",(function(){const i=c();if(!i.length)return o.error("[[error:no-users-selected]]"),!1;socket.emit("admin.user.loadGroups",i,(function(i,c){if(i)return o.error(i);t.render("admin/partials/manage_user_groups",c).then((function(t){const i=r.dialog({message:t,title:"[[admin/manage/users:manage-groups]]",onEscape:!0});i.on("shown.bs.modal",(function(){n.group(i.find(".group-search"),(function(t,n){const s=$(t.target).attr("data-uid");a.put("/groups/"+n.item.group.slug+"/membership/"+s,void 0).then((()=>{n.item.group.nameEscaped=e.escape(n.item.group.displayName),app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[n.item.group]}]},(function(e){$("[data-uid="+s+"] .group-area").append(e.find(".group-area").html())}))})).catch(o.error)}))})),i.on("click",".group-area a",(function(){i.modal("hide")})),i.on("click",".remove-group-icon",(function(){const e=$(this).parents("[data-group-name]"),t=e.attr("data-group-name"),n=$(this).parents("[data-uid]").attr("data-uid");return a.del("/groups/"+s(t)+"/membership/"+n).then((()=>{e.remove()})).catch(o.error),!1}))}))}))})),$(".ban-user").on("click",(function(){const e=c();if(!e.length)return o.error("[[error:no-users-selected]]"),!1;r.confirm(e.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",(function(t){t&&Promise.all(e.map((function(e){return a.put("/users/"+e+"/ban")}))).then((()=>{f("[[admin/manage/users:alerts.ban-success]]",".ban",!0)})).catch(o.error)}))})),$(".ban-user-temporary").on("click",(function(){const e=c();if(!e.length)return o.error("[[error:no-users-selected]]"),!1;t.render("admin/partials/temporary-ban",{}).then((function(t){r.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:t,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+e.length+"]]",callback:function(){const t=$(".ban-modal form").serializeArray().reduce((function(e,t){return e[t.name]=t.value,e}),{}),n=t.length>0?Date.now()+1e3*t.length*60*60*(parseInt(t.unit,10)?24:1):0;Promise.all(e.map((function(e){return a.put("/users/"+e+"/ban",{until:n,reason:t.reason})}))).then((()=>{f("[[admin/manage/users:alerts.ban-success]]",".ban",!0)})).catch(o.error)}}}})}))})),$(".unban-user").on("click",(function(){const e=c();if(!e.length)return o.error("[[error:no-users-selected]]"),!1;Promise.all(e.map((function(e){return a.del("/users/"+e+"/ban")}))).then((()=>{f("[[admin/manage/users:alerts.unban-success]]",".ban",!1)}))})),$(".reset-lockout").on("click",(function(){const e=c();e.length&&socket.emit("admin.user.resetLockouts",e,p("[[admin/manage/users:alerts.lockout-reset-success]]"))})),$(".validate-email").on("click",(function(){const e=c();e.length&&r.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",(function(t){t&&socket.emit("admin.user.validateEmail",e,(function(e){if(e)return o.error(e);o.success("[[admin/manage/users:alerts.validate-email-success]]"),d(".notvalidated",!1),d(".validated",!0),m()}))}))})),$(".send-validation-email").on("click",(function(){const e=c();e.length&&socket.emit("admin.user.sendValidationEmail",e,(function(e){if(e)return o.error(e);o.success("[[notifications:email-confirm-sent]]")}))})),$(".password-reset-email").on("click",(function(){const e=c();e.length&&r.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",(function(t){t&&socket.emit("admin.user.sendPasswordResetEmail",e,p("[[admin/manage/users:alerts.password-reset-email-sent]]"))}))})),$(".force-password-reset").on("click",(function(){const e=c();e.length&&r.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",(function(t){t&&socket.emit("admin.user.forcePasswordReset",e,p("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))}))})),$(".delete-user").on("click",(()=>{y("[[admin/manage/users:alerts.confirm-delete]]","/account")})),$(".delete-user-content").on("click",(()=>{y("[[admin/manage/users:alerts.confirm-delete-content]]","/content")})),$(".delete-user-and-content").on("click",(()=>{y("[[admin/manage/users:alerts.confirm-purge]]","")}));const g=document.querySelector(".users-table"),h=document.getElementById("action-dropdown");function y(e,t){const n=c();n.length&&r.confirm(e,(function(e){e&&Promise.all(n.map((e=>a.del(`/users/${e}${t}`,{}).then((()=>{"/content"!==t&&function(e){const t=document.querySelector(`.users-table [component="user/select/single"][data-uid="${e}"]`);if(t){const e=t.closest(".user-row");e.parentNode.removeChild(e)}}(e)}))))).then((()=>{"/content"!==t?o.success("[[admin/manage/users:alerts.delete-success]]"):o.success("[[admin/manage/users:alerts.delete-content-success]]"),m(),$('.users-table [component="user/select/single"]').length||ajaxify.refresh()})).catch(o.error)}))}function b(){const e=this,t=document.getElementById("create-user-name").value,n=document.getElementById("create-user-email").value,s=document.getElementById("create-user-password").value,r=document.getElementById("create-user-password-again").value,i=$("#create-modal-error");if(s!==r)return i.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide");const c={username:t,email:n,password:s};a.post("/users",c).then((()=>{e.modal("hide"),e.on("hidden.bs.modal",(function(){ajaxify.refresh()})),o.success("[[admin/manage/users:alerts.create-success]]")})).catch((e=>i.translateHtml("[[admin/manage/users:alerts.error-x, "+e.message+"]]").removeClass("hidden")))}g.addEventListener("change",(e=>{(e.target.closest('[component="user/select/single"]')||e.target.closest('[component="user/select/all"]'))&&(c().length?h.removeAttribute("disabled"):h.setAttribute("disabled","disabled"))})),function(){function n(){$(".fa-spinner").removeClass("hidden"),function(n){const a=utils.params();a.searchBy=n.searchBy,a.query=n.query,a.page=n.page,a.sortBy=a.sortBy||"lastonline";const s=decodeURIComponent($.param(a));$.get(config.relative_path+"/api/admin/manage/users?"+s,(function(n){!function(n){t.render("partials/paginator",{pagination:n.pagination}).then((function(e){$(".pagination-container").replaceWith(e)})),app.parseAndTranslate("admin/manage/users","users",n,(function(t){if($(".users-table tbody tr").remove(),$(".users-table tbody").append(t),t.find(".timeago").timeago(),$(".fa-spinner").addClass("hidden"),!$("#user-search").val())return $("#user-found-notify").addClass("hidden"),void $("#user-notfound-notify").addClass("hidden");n&&0===n.users.length?($("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden"),$("#user-found-notify").addClass("hidden")):($("#user-found-notify").translateHtml(e.compile("admin/manage/users:alerts.x-users-found",n.matchCount,n.timing)).removeClass("hidden"),$("#user-notfound-notify").addClass("hidden"))}))}(n);const a=config.relative_path+"/admin/manage/users?"+s;history.pushState&&history.pushState({url:a},null,window.location.protocol+"//"+window.location.host+a)})).fail((function(e){e&&e.responseJSON&&e.responseJSON.error&&o.error(e.responseJSON.error)}))}({searchBy:$("#user-search-by").val(),query:$("#user-search").val(),page:1})}$("#user-search").on("keyup",utils.debounce(n,250)),$("#user-search-by").on("change",n)}(),$('[data-action="create"]').on("click",(function(){return t.render("admin/partials/create_user_modal",{}).then((function(e){const t=r.dialog({message:e,title:"[[admin/manage/users:alerts.create]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){return b.call(this),!1}}}});t.on("shown.bs.modal",(function(){t.find("#create-user-name").focus()}))})),!1})),$(".users-table thead th").on("click",(function(){const e=$(this).attr("data-sort");if(!e)return;const t=utils.params();t.sortBy=e,ajaxify.data.sortBy===e?t.sortDirection=ajaxify.data.reverse?"asc":"desc":t.sortDirection="desc";const n=u(t);ajaxify.go("admin/manage/users?"+n)})),function(){let e=l();$("#filter-by").on("click","li",(function(){const e=$(this);return e.find("i").toggleClass("fa-check",!e.find("i").hasClass("fa-check")),!1})),$("#filter-by").on("hidden.bs.dropdown",(function(){const t=l();let n=t.length!==e.length;if(t.length===e.length&&t.forEach((function(t,a){t!==e[a]&&(n=!0)})),e=l(),n){const e=utils.params();e.filters=t;const n=u(e);ajaxify.go("admin/manage/users?"+n)}}))}(),i.handle()},c}.apply(t,a))||(e.exports=s)},23884:(e,t,n)=>{var a,s;a=[n(74344),n(59006),n(31369),n(7927)],void 0===(s=function(e,t,n,a){const s={};function r(){return ajaxify.data.template.name.startsWith("admin/")}return s.handle=function(){$('[component="user/invite"]').on("click",(function(o){o.preventDefault(),e.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then((e=>{t.parse("modals/invite",{groups:e},(function(e){n.dialog({message:e,title:`[[${r()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${r()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${r()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:s.send}}})}))})).catch(a.error)}))},s.send=function(){const t=$("#invite-modal-emails"),n=$("#invite-modal-groups"),s={emails:t.val().split(",").map((e=>e.trim())).filter(Boolean).filter(((e,t,n)=>t===n.indexOf(e))).join(","),groupsToJoin:n.val()};s.emails&&e.post(`/users/${app.user.uid}/invites`,s).then((()=>{a.success(`[[${r()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${s.emails.replace(/,/g,"&#44; ")}]]`)})).catch(a.error)},s}.apply(t,a))||(e.exports=s)},7927:(e,t,n)=>{var a,s;a=[n(32230),n(7237),n(85233)],s=function(e,t,n){const a={};function s(e,t){e.find("strong").translateHtml(t.title),e.find("p").translateHtml(t.message),e.attr("class","alert alert-dismissable alert-"+t.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),t.timeout&&o(e,t),n.fire("action:alert.update",{alert:e,params:t}),e.off("click").removeClass("pointer"),"function"==typeof t.clickfn&&e.addClass("pointer").on("click",(function(n){$(n.target).is(".close")||t.clickfn(),r(e)}))}function r(e){e.fadeOut(500,(function(){$(this).remove()}))}function o(e,t){const a=t.timeout,s=setTimeout((function(){r(e),"function"==typeof t.timeoutfn&&t.timeoutfn(e,t)}),a);e.attr("timeoutId",s),e.css("transition-property","none"),e.removeClass("animate"),setTimeout((function(){e.css("transition-property",""),e.css("transition","width "+(a+450)+"ms linear, background-color "+(a+450)+"ms ease-in"),e.addClass("animate"),n.fire("action:alert.animate",{alert:e,params:t})}),50),e.on("mouseenter",(function(){$(this).css("transition-duration",0)}))}return a.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:(new Date).getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const a=$("#"+e.alert_id);a.length?s(a,e):function(e){app.parseAndTranslate("alert",e,(function(a){let i=$("#"+e.alert_id);if(i.length)return s(i,e);i=a,i.fadeIn(200),t.get("toaster/tray").prepend(i),"function"==typeof e.closefn&&i.find("button").on("click",(function(){return e.closefn(),r(i),!1})),e.timeout&&o(i,e),"function"==typeof e.clickfn&&i.addClass("pointer").on("click",(function(t){$(t.target).is(".close")||e.clickfn(i,e),r(i)})),n.fire("action:alert.new",{alert:i,params:e})}))}(e)},a.success=function(e,t){a.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:t||5e3})},a.error=function(e,t){if("[[error:revalidate-failure]]"===(e=e&&e.message||e))return socket.disconnect(),void app.reconnect();a.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:t||1e4})},a.remove=function(e){$("#alert_button_"+e).remove()},a}.apply(t,a),void 0===s||(e.exports=s)},74344:(e,t,n)=>{var a,s;a=[n(85233)],void 0===(s=(e=>{const t={},n=config.relative_path+"/api/v3";function a(t,a){async function s(n){({options:t}=await e.fire("filter:api.options",{options:t})),$.ajax(t).done((e=>{n(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})})).fail((e=>{let t;e.responseJSON&&(t=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),n(new Error(t||e.statusText))}))}if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:n+t.url,"function"!=typeof a)return new Promise(((e,t)=>{s((function(n,a){n?t(n):e(a)}))}));s(a)}return t.get=(e,t,n)=>a({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n),t.head=(e,t,n)=>a({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},n),t.post=(e,t,n)=>a({url:e,method:"post",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.patch=(e,t,n)=>a({url:e,method:"patch",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.put=(e,t,n)=>a({url:e,method:"put",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.del=(e,t,n)=>a({url:e,method:"delete",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.delete=t.del,t}).apply(t,a))||(e.exports=s)},86193:(e,t,n)=>{var a,s;a=[n(74344),n(7927)],s=function(e,t){const n={},a={delay:200};return n.init=e=>{const{input:t,source:n,onSelect:s,delay:r}={...a,...e};app.loadJQueryUI((function(){t.autocomplete({delay:r,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(e,n){!function(e,t,n,a){t=t||function(){};const s=jQuery.Event("keypress");s.which=13,s.keyCode=13,setTimeout((function(){e.trigger(s)}),100),t(n,a)}(t,s,e,n)},source:n})}))},n.user=function(a,s,r){"function"==typeof s&&(r=s,s={}),s=s||{},n.init({input:a,onSelect:r,source:(n,a)=>{s.query=n.term,e.get("/api/users",s,(function(e,n){if(e)return t.error(e);if(n&&n.users){const e=n.users.map((function(e){const t=$("<div></div>").html(e.username).text();return e&&{label:t,value:t,user:{uid:e.uid,name:e.username,slug:e.userslug,username:e.username,userslug:e.userslug,picture:e.picture,banned:e.banned,"icon:text":e["icon:text"],"icon:bgColor":e["icon:bgColor"]}}}));a(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")}))}})},n.group=function(e,a){n.init({input:e,onSelect:a,source:(e,n)=>{socket.emit("groups.search",{query:e.term},(function(e,a){if(e)return t.error(e);if(a&&a.length){const e=a.map((function(e){return e&&{label:e.name,value:e.name,group:e}}));n(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")}))}})},n.tag=function(e,a){n.init({input:e,onSelect:a,delay:100,source:(e,n)=>{socket.emit("topics.autocompleteTags",{query:e.term,cid:ajaxify.data.cid||0},(function(e,a){if(e)return t.error(e);a&&n(a),$(".ui-autocomplete a").attr("data-ajaxify","false")}))}})},n}.apply(t,a),void 0===s||(e.exports=s)},7237:(e,t,n)=>{var a;void 0===(a=function(){const e={};return e.core={"topic/teaser":function(e){return e?$('[component="category/topic"][data-tid="'+e+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(e,t){return $('[component="topic"][data-'+e+'="'+t+'"]')},post:function(e,t){return $('[component="post"][data-'+e+'="'+t+'"]')},"post/content":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/content"]')},"post/header":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/header"]')},"post/anchor":function(e){return $('[component="post"][data-index="'+e+'"] [component="post/anchor"]')},"post/vote-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/vote-count"]')},"post/bookmark-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/bookmark-count"]')},"user/postcount":function(e){return $('[component="user/postcount"][data-uid="'+e+'"]')},"user/reputation":function(e){return $('[component="user/reputation"][data-uid="'+e+'"]')},"category/topic":function(e,t){return $('[component="category/topic"][data-'+e+'="'+t+'"]')},"categories/category":function(e,t){return $('[component="categories/category"][data-'+e+'="'+t+'"]')},"chat/message":function(e){return $('[component="chat/message"][data-mid="'+e+'"]')},"chat/message/body":function(e){return $('[component="chat/message"][data-mid="'+e+'"] [component="chat/message/body"]')},"chat/recent/room":function(e){return $('[component="chat/recent/room"][data-roomid="'+e+'"]')}},e.get=function(){const t=Array.prototype.slice.call(arguments,1);return e.core[arguments[0]]&&t.length?e.core[arguments[0]].apply(this,t):$('[component="'+arguments[0]+'"]')},e}.call(t,n,t,e))||(e.exports=a)},22568:(e,t,n)=>{var a,s,r;s=[n(20648)],void 0===(r="function"==typeof(a=function(e){const t=e("[^\\p{L}\\s\\d\\-_]","g"),n=/[^\w\s\d\-_]/g,a=/^\s+|\s+$/g,s=/\s+/g,r=/-+/g,o=/-$/g,i=/^-/g,c=/^[\w\d\s.,\-@]+$/;return function(u,l){return u?(u=String(u).replace(a,""),u=c.test(u)?u.replace(n,"-"):e.replace(u,t,"-"),u=(u=(u=(u=(u=l?u:u.toLocaleLowerCase()).replace(s,"-")).replace(r,"-")).replace(o,"")).replace(i,"")):""}})?a.apply(t,s):a)||(e.exports=r)}}]);