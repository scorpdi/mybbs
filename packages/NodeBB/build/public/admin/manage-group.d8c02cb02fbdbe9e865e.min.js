"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[9078,7214,6503,1762,3014,6623,9286,1986,8042,71,999,831,7927],{22009:(e,t,n)=>{var o,a;o=[n(24987),n(18487),n(32230),n(50548),n(7350),n(22568),n(74344),n(31369),n(7927)],void 0===(a=function(e,t,n,o,a,s,r,i,c){const l={init:function(){const l=$("#group-icon"),d=$("#change-group-user-title"),u=$("#change-group-label-color"),p=$("#change-group-text-color"),f=$("#group-label-preview"),m=$("#group-label-preview-text"),g=ajaxify.data.group.name;$("#group-selector").on("change",(function(){ajaxify.go("admin/manage/groups/"+$(this).val()+window.location.hash)})),e.init("admin/manage/group"),d.on("keyup",(function(){m.translateText(d.val())})),u.on("keyup input",(function(){f.css("background-color",u.val()||"#000000")})),p.on("keyup input",(function(){f.css("color",p.val()||"#ffffff")})),$('[component="groups/members"]').on("click","[data-action]",(function(){const e=$(this),t=e.parents("[data-uid]"),n=t.find(".member-name .user-owner-icon"),o=!n.hasClass("invisible"),a=t.attr("data-uid");switch(e.attr("data-action")){case"toggleOwnership":r[o?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${a}`,{}).then((()=>{n.toggleClass("invisible")})).catch(c.error);break;case"kick":i.confirm("[[admin/manage/groups:edit.confirm-remove-user]]",(function(e){e&&r.del("/groups/"+ajaxify.data.group.slug+"/membership/"+a).then((()=>{t.slideUp().remove()})).catch(c.error)}))}})),$("#group-icon, #group-icon-label").on("click",(function(){const e=l.attr("value");t.init(l,(function(){let t=l.attr("value");t!==e&&("fa-nbb-none"===t&&(t="hidden"),$("#group-icon-preview").attr("class","fa fa-fw "+(t||"hidden")),app.flags=app.flags||{},app.flags._unsaved=!0)}))})),o.init($('.edit-privileges-selector [component="category-selector"]'),{onSelect:function(e){!function(e){if(e){const t="admin/manage/privileges/"+e+"?group="+ajaxify.data.group.nameEncoded;if(app.flags&&!0===app.flags._unsaved)return void n.translate("[[global:unsaved-changes]]",(function(e){i.confirm(e,(function(e){e&&(app.flags._unsaved=!1,ajaxify.go(t))}))}));ajaxify.go(t)}}(e.cid)},showLinks:!0});const h=o.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(e){let t=($("#memberPostCids").val()||"").split(",").map((e=>parseInt(e,10)));t.push(e.cid),t=t.filter(((e,t,n)=>n.indexOf(e)===t)),$("#memberPostCids").val(t.join(",")),h.selectCategory(0)}});a.init($('[component="group-selector"]')),$("form [data-property]").on("change",(function(){app.flags=app.flags||{},app.flags._unsaved=!0})),$("#save").on("click",(function(){return r.put(`/groups/${s(g)}`,{name:$("#change-group-name").val(),userTitle:d.val(),description:$("#change-group-desc").val(),icon:l.attr("value"),labelColor:u.val(),textColor:p.val(),userTitleEnabled:$("#group-userTitleEnabled").is(":checked"),private:$("#group-private").is(":checked"),hidden:$("#group-hidden").is(":checked"),memberPostCids:$("#memberPostCids").val(),disableJoinRequests:$("#group-disableJoinRequests").is(":checked"),disableLeave:$("#group-disableLeave").is(":checked")}).then((()=>{const e=$("#change-group-name").val();g!==e&&ajaxify.go("admin/manage/groups/"+encodeURIComponent(e),void 0,!0),c.success("[[admin/manage/groups:edit.save-success]]")})).catch(c.error),!1}))}};return l}.apply(t,o))||(e.exports=a)},24987:(e,t,n)=>{var o,a;o=[n(74344),n(31369),n(7927)],void 0===(a=function(e,t,n){const o={};let a,s,r;function i(e,t){app.parseAndTranslate(r,"group.members",{group:{members:e,isOwner:ajaxify.data.group.isOwner}},t)}return o.init=function(o){r=o||"groups/details",s=ajaxify.data.group.name,$('[component="groups/members/add"]').on("click",(function(){app.parseAndTranslate("admin/partials/groups/add-members",{},(function(o){const a=[],r=t.dialog({title:"[[groups:details.add-member]]",message:o,buttons:{ok:{callback:function(){const t=[];r.find("[data-uid][data-selected]").each((function(e,n){t.push(a[$(n).attr("data-uid")])})),function(t,o){function a(){i(t=t.filter((function(e){return!$('[component="groups/members"] [data-uid="'+e.uid+'"]').length})),(function(e){$('[component="groups/members"] tbody').prepend(e)})),r.modal("hide")}const c=t.map((function(e){return e.uid}));"administrators"===s?socket.emit("admin.user.makeAdmins",c,(function(e){if(e)return n.error(e);a()})):Promise.all(c.map((t=>e.put("/groups/"+ajaxify.data.group.slug+"/membership/"+t)))).then(a).catch(n.error)}(t)}}}});r.on("click","[data-username]",(function(){"1"===$(this).attr("data-selected")?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")})),r.find("input").on("keyup",(function(){e.get("/api/users",{query:$(this).val(),paginate:!1},(function(e,t){if(e)return n.error(e);t.users.forEach((function(e){a[e.uid]=e})),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:t.users},(function(e){r.find("#search-result").html(e)}))}))}))}))})),$('[component="groups/members/search"]').on("keyup",(function(){const e=$(this).val();a&&(clearInterval(a),a=0),a=setTimeout((function(){socket.emit("groups.searchMembers",{groupName:s,query:e},(function(e,t){if(e)return n.error(e);i(t.users,(function(e){$('[component="groups/members"] tbody').html(e),$('[component="groups/members"]').attr("data-nextstart",20)}))}))}),250)})),$('[component="groups/members"] tbody').on("scroll",(function(){const e=$(this),t=.9*(e[0].scrollHeight-e.innerHeight());e.scrollTop()>t&&!$('[component="groups/members/search"]').val()&&function(){const e=$('[component="groups/members"]');e.attr("loading")||(e.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:s,after:e.attr("data-nextstart")},(function(t,o){if(t)return n.error(t);var a,s;o&&o.users.length?(a=o.users,s=function(){e.removeAttr("loading"),e.attr("data-nextstart",o.nextStart)},i(a=a.filter((function(e){return!$('[component="groups/members"] [data-uid="'+e.uid+'"]').length})),(function(e){$('[component="groups/members"] tbody').append(e),s()}))):e.removeAttr("loading")})))}()}))},o}.apply(t,o))||(e.exports=a)},7927:(e,t,n)=>{var o,a;o=[n(32230),n(7237),n(85233)],a=function(e,t,n){const o={};function a(e,t){e.find("strong").translateHtml(t.title),e.find("p").translateHtml(t.message),e.attr("class","alert alert-dismissable alert-"+t.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),t.timeout&&r(e,t),n.fire("action:alert.update",{alert:e,params:t}),e.off("click").removeClass("pointer"),"function"==typeof t.clickfn&&e.addClass("pointer").on("click",(function(n){$(n.target).is(".close")||t.clickfn(),s(e)}))}function s(e){e.fadeOut(500,(function(){$(this).remove()}))}function r(e,t){const o=t.timeout,a=setTimeout((function(){s(e),"function"==typeof t.timeoutfn&&t.timeoutfn(e,t)}),o);e.attr("timeoutId",a),e.css("transition-property","none"),e.removeClass("animate"),setTimeout((function(){e.css("transition-property",""),e.css("transition","width "+(o+450)+"ms linear, background-color "+(o+450)+"ms ease-in"),e.addClass("animate"),n.fire("action:alert.animate",{alert:e,params:t})}),50),e.on("mouseenter",(function(){$(this).css("transition-duration",0)}))}return o.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:(new Date).getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const o=$("#"+e.alert_id);o.length?a(o,e):function(e){app.parseAndTranslate("alert",e,(function(o){let i=$("#"+e.alert_id);if(i.length)return a(i,e);i=o,i.fadeIn(200),t.get("toaster/tray").prepend(i),"function"==typeof e.closefn&&i.find("button").on("click",(function(){return e.closefn(),s(i),!1})),e.timeout&&r(i,e),"function"==typeof e.clickfn&&i.addClass("pointer").on("click",(function(t){$(t.target).is(".close")||e.clickfn(i,e),s(i)})),n.fire("action:alert.new",{alert:i,params:e})}))}(e)},o.success=function(e,t){o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:t||5e3})},o.error=function(e,t){if("[[error:revalidate-failure]]"===(e=e&&e.message||e))return socket.disconnect(),void app.reconnect();o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:t||1e4})},o.remove=function(e){$("#alert_button_"+e).remove()},o}.apply(t,o),void 0===a||(e.exports=a)},74344:(e,t,n)=>{var o,a;o=[n(85233)],void 0===(a=(e=>{const t={},n=config.relative_path+"/api/v3";function o(t,o){async function a(n){({options:t}=await e.fire("filter:api.options",{options:t})),$.ajax(t).done((e=>{n(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})})).fail((e=>{let t;e.responseJSON&&(t=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),n(new Error(t||e.statusText))}))}if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:n+t.url,"function"!=typeof o)return new Promise(((e,t)=>{a((function(n,o){n?t(n):e(o)}))}));a(o)}return t.get=(e,t,n)=>o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n),t.head=(e,t,n)=>o({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},n),t.post=(e,t,n)=>o({url:e,method:"post",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.patch=(e,t,n)=>o({url:e,method:"patch",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.put=(e,t,n)=>o({url:e,method:"put",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.del=(e,t,n)=>o({url:e,method:"delete",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),t.delete=t.del,t}).apply(t,o))||(e.exports=a)},22905:(e,t,n)=>{var o,a;o=[n(7927)],void 0===(a=function(e){const t={init:function(t,n){let o=null;(n=n||{}).privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"];let a=[];Array.isArray(n.localCategories)&&(a=n.localCategories.map((e=>({...e})))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const s=t.find('[component="category-selector-search"]');if(!s.length)return;const r=s.parent('[component="category/dropdown"]').length>0||s.parent('[component="category-selector"]').length>0;function i(e){app.parseAndTranslate(n.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},(function(n){t.find('[component="category/list"]').replaceWith(n.find('[component="category/list"]')),t.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length)}))}t.on("show.bs.dropdown",(function(){function c(){const t=s.find("input").val();var r,c;t.length>1||!t&&!o?(r=t,c=function(e){o=o||e,i(e)},socket.emit("categories.categorySearch",{search:r,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},(function(t,n){if(t)return e.error(t);c(a.concat(n))}))):!t&&o&&(o.forEach((function(e){e.selected=n.selectedCids.includes(e.cid)})),i(o))}r&&(t.find(".dropdown-toggle").addClass("hidden"),s.removeClass("hidden")),s.on("click",(function(e){e.preventDefault(),e.stopPropagation()})),s.find("input").val("").on("keyup",utils.debounce(c,300)),c()})),t.on("shown.bs.dropdown",(function(){s.find("input").focus()})),t.on("hide.bs.dropdown",(function(){r&&(t.find(".dropdown-toggle").removeClass("hidden"),s.addClass("hidden")),s.off("click"),s.find("input").off("keyup")}))}};return t}.apply(t,o))||(e.exports=a)},50548:(e,t,n)=>{var o,a;o=[n(22905),n(31369),n(85233)],void 0===(a=function(e,t,n){const o={init:function(t,o){if(!t||!t.length)return;const a=(o=o||{}).onSelect||function(){};o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-selector",n.fire("action:category.selector.options",{el:t,options:o}),e.init(t,o);const s={el:t,selectedCategory:null};t.on("click","[data-cid]",(function(){const e=$(this);if(e.hasClass("disabled"))return!1;s.selectCategory(e.attr("data-cid")),a(s.selectedCategory)}));const r=s.el.find('[component="category-selector-selected"]').html();return s.selectCategory=function(e){const t=s.el.find('[data-cid="'+e+'"]');s.selectedCategory={cid:e,name:t.attr("data-name")},t.length?s.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):s.el.find('[component="category-selector-selected"]').html(r)},s.getSelectedCategory=function(){return s.selectedCategory},s.getSelectedCid=function(){return s.selectedCategory?s.selectedCategory.cid:0},s},modal:function(e){(e=e||{}).onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},(function(n){const a=t.dialog({title:e.title||"[[modules:composer.select_category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:r}}}),s=o.init(a.find('[component="category-selector"]'),e);function r(t){return t.preventDefault(),s.selectedCategory&&(e.onSubmit(s.selectedCategory),a.modal("hide")),!1}e.openOnLoad&&a.on("shown.bs.modal",(function(){a.find(".dropdown-toggle").dropdown("toggle")})),a.find("form").on("submit",r)}))}};return o}.apply(t,o))||(e.exports=a)},7237:(e,t,n)=>{var o;void 0===(o=function(){const e={};return e.core={"topic/teaser":function(e){return e?$('[component="category/topic"][data-tid="'+e+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(e,t){return $('[component="topic"][data-'+e+'="'+t+'"]')},post:function(e,t){return $('[component="post"][data-'+e+'="'+t+'"]')},"post/content":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/content"]')},"post/header":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/header"]')},"post/anchor":function(e){return $('[component="post"][data-index="'+e+'"] [component="post/anchor"]')},"post/vote-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/vote-count"]')},"post/bookmark-count":function(e){return $('[component="post"][data-pid="'+e+'"] [component="post/bookmark-count"]')},"user/postcount":function(e){return $('[component="user/postcount"][data-uid="'+e+'"]')},"user/reputation":function(e){return $('[component="user/reputation"][data-uid="'+e+'"]')},"category/topic":function(e,t){return $('[component="category/topic"][data-'+e+'="'+t+'"]')},"categories/category":function(e,t){return $('[component="categories/category"][data-'+e+'="'+t+'"]')},"chat/message":function(e){return $('[component="chat/message"][data-mid="'+e+'"]')},"chat/message/body":function(e){return $('[component="chat/message"][data-mid="'+e+'"] [component="chat/message/body"]')},"chat/recent/room":function(e){return $('[component="chat/recent/room"][data-roomid="'+e+'"]')}},e.get=function(){const t=Array.prototype.slice.call(arguments,1);return e.core[arguments[0]]&&t.length?e.core[arguments[0]].apply(this,t):$('[component="'+arguments[0]+'"]')},e}.call(t,n,t,e))||(e.exports=o)},7350:(e,t,n)=>{var o;void 0===(o=function(){return{init:function(e){if(utils.isTouchDevice())return;const t=e.find('[component="group-selector-search"]');if(!t.length)return;const n=t.parent('[component="group-selector"]').length>0,o=e.find('[component="group-list"] [data-name]');e.on("show.bs.dropdown",(function(){function a(){const n=t.find("input").val().toLowerCase();let a=!0;o.each((function(){const e=$(this),t=-1!==e.attr("data-name").toLowerCase().indexOf(n);a&&t&&(a=!1),e.toggleClass("hidden",!t)})),e.find('[component="group-list"] [component="group-no-matches"]').toggleClass("hidden",!a)}n&&(e.find(".dropdown-toggle").addClass("hidden"),t.removeClass("hidden")),t.on("click",(function(e){e.preventDefault(),e.stopPropagation()})),t.find("input").val("").on("keyup",a),a()})),e.on("shown.bs.dropdown",(function(){t.find("input").focus()})),e.on("hide.bs.dropdown",(function(){n&&(e.find(".dropdown-toggle").removeClass("hidden"),t.addClass("hidden")),t.off("click").find("input").off("keyup")}))}}}.call(t,n,t,e))||(e.exports=o)},18487:(e,t,n)=>{var o,a;o=[n(59006),n(31369)],void 0===(a=function(e,t){return{init:function(n,o){o=o||function(){};const a=n.hasClass("fa-2x");let s=n.attr("class").replace("fa-2x","").replace("fa","").replace(/\s+/g,"");if($("#icons .selected").removeClass("selected"),s)try{$("#icons .fa-icons .fa."+s).addClass("selected")}catch(e){s=""}e.render("partials/fontawesome",{}).then((function(e){(e=$(e)).find(".fa-icons").prepend($('<i class="fa fa-nbb-none"></i>'));const r=t.dialog({onEscape:!0,backdrop:!0,show:!1,message:e,title:"Select an Icon",buttons:{noIcon:{label:"No Icon",className:"btn-default",callback:function(){n.attr("class","fa "+(a?"fa-2x ":"")),n.val(""),n.attr("value",""),o(n)}},success:{label:"Select",className:"btn-primary",callback:function(){const e=$(".bootbox .selected").attr("class"),t=$("<div></div>").addClass(e).removeClass("fa").removeClass("selected").attr("class"),s=r.find("input").val();t?(n.attr("class","fa "+(a?"fa-2x ":"")+t),n.val(t),n.attr("value",t)):s&&(n.attr("class",s),n.val(s),n.attr("value",s)),o(n)}}}});r.on("show.bs.modal",(function(){const e=$(this),t=e.find("input");s&&(e.find("."+s).addClass("selected"),t.val(s.replace("fa-","")))})).modal("show"),r.on("shown.bs.modal",(function(){const e=$(this),t=e.find("input"),n=e.find(".fa-icons i"),o=e.find("button.btn-primary");function a(n){e.find("i.selected").removeClass("selected"),n?n.addClass("selected"):0===t.val().length?s&&e.find("."+s).addClass("selected"):e.find("i:visible").first().addClass("selected")}t.selectRange(0,t.val().length),e.find(".icon-container").on("click","i",(function(){t.val($(this).attr("class").replace("fa fa-","").replace("selected","")),a($(this))})),t.on("keyup",(function(e){13!==e.keyCode?(n.show(),n.each((function(e,n){n.className.match(new RegExp("^fa fa-.*"+t.val()+".*$"))||$(n).hide()})),a()):o.click()}))}))}))}}}.apply(t,o))||(e.exports=a)},22568:(e,t,n)=>{var o,a,s;a=[n(20648)],void 0===(s="function"==typeof(o=function(e){const t=e("[^\\p{L}\\s\\d\\-_]","g"),n=/[^\w\s\d\-_]/g,o=/^\s+|\s+$/g,a=/\s+/g,s=/-+/g,r=/-$/g,i=/^-/g,c=/^[\w\d\s.,\-@]+$/;return function(l,d){return l?(l=String(l).replace(o,""),l=c.test(l)?l.replace(n,"-"):e.replace(l,t,"-"),l=(l=(l=(l=(l=d?l:l.toLocaleLowerCase()).replace(a,"-")).replace(s,"-")).replace(r,"")).replace(i,"")):""}})?o.apply(t,a):o)||(e.exports=s)}}]);