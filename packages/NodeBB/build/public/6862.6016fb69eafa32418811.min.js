"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[6862,8306],{46862:(e,t,s)=>{var n,o;n=[s(7237),s(32230),s(59006),s(85233),s(31369),s(7927),s(44882),s(74344)],void 0===(o=function(e,t,s,n,o,a,i,r){const c={};function l(t){t.messages.forEach((function(t){const s=parseInt(t.fromuid,10)===parseInt(app.user.uid,10);t.self=s?1:0,c.parseMessage(t,(function(s){const n=e.get("chat/message",t.messageId);n.length&&(n.replaceWith(s),e.get("chat/message",t.messageId).find(".timeago").timeago())}))}))}function m(t){e.get("chat/message",t).toggleClass("deleted",!0).find('[component="chat/message/body"]').translateHtml("[[modules:chat.message-deleted]]")}function g(t){e.get("chat/message",t.messageId).toggleClass("deleted",!1).find('[component="chat/message/body"]').html(t.content)}return c.sendMessage=async function(e,t){let s=t.val(),o=t.attr("data-mid");if(!s.trim().length)return;t.val(""),t.removeAttr("data-mid"),c.updateRemainingLength(t.parent());const l={roomId:e,message:s,mid:o};n.fire("action:chat.sent",l),({roomId:e,message:s,mid:o}=await n.fire("filter:chat.send",l)),o?r.put(`/chats/${e}/messages/${o}`,{message:s}).catch((e=>(t.val(s),t.attr("data-mid",o),c.updateRemainingLength(t.parent()),a.error(e)))):r.post(`/chats/${e}`,{message:s}).catch((e=>(t.val(s),c.updateRemainingLength(t.parent()),"[[error:email-not-confirmed-chat]]"===e.message?i.showEmailConfirmWarning(e.message):a.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:e.message,type:"danger",timeout:1e4}))))},c.updateRemainingLength=function(e){const t=e.find('[component="chat/input"]');e.find('[component="chat/message/length"]').text(t.val().length),e.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-t.val().length),n.fire("action:chat.updateRemainingLength",{parent:e})},c.appendChatMessage=function(e,t){const s=parseInt(e.find(".chat-message").last().attr("data-uid"),10),o=parseInt(e.find(".chat-message").last().attr("data-timestamp"),10);Array.isArray(t)||(t.newSet=s!==parseInt(t.fromuid,10)||parseInt(t.timestamp,10)>parseInt(o,10)+18e4),c.parseMessage(t,(function(t){!function(e,t){const s=$(t),o=c.isAtBottom(e);s.appendTo(e),s.find(".timeago").timeago(),s.find("img:not(.not-responsive)").addClass("img-responsive"),o&&c.scrollToBottom(e),n.fire("action:chat.received",{messageEl:s})}(e,t)}))},c.parseMessage=function(e,n){function o(e){t.translate(e,n)}Array.isArray(e)?s.render("partials/chats/message"+(Array.isArray(e)?"s":""),{messages:e}).then(o):s.render("partials/chats/"+(e.system?"system-message":"message"),{messages:e}).then(o)},c.isAtBottom=function(e,t){if(e.length)return e[0].scrollHeight-(e.outerHeight()+e.scrollTop())<(t||100)},c.scrollToBottom=function(e){e&&e.length&&(e.scrollTop(e[0].scrollHeight-e.height()),e.parent().find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},c.toggleScrollUpAlert=function(e){const t=c.isAtBottom(e,300);e.parent().find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",t)},c.prepEdit=function(e,t,s){socket.emit("modules.chats.getRaw",{mid:t,roomId:s},(function(o,i){if(o)return a.error(o);0===e.val().length&&(e.attr("data-mid",t).addClass("editing"),e.val(i).focus(),n.fire("action:chat.prepEdit",{inputEl:e,messageId:t,roomId:s}))}))},c.addSocketListeners=function(){socket.removeListener("event:chats.edit",l),socket.on("event:chats.edit",l),socket.removeListener("event:chats.delete",m),socket.on("event:chats.delete",m),socket.removeListener("event:chats.restore",g),socket.on("event:chats.restore",g)},c.delete=function(s,n){t.translate("[[modules:chat.delete_message_confirm]]",(function(t){o.confirm(t,(function(t){t&&r.delete(`/chats/${n}/messages/${s}`,{}).then((()=>{e.get("chat/message",s).toggleClass("deleted",!0)})).catch(a.error)}))}))},c.restore=function(t,s){r.post(`/chats/${s}/messages/${t}`,{}).then((()=>{e.get("chat/message",t).toggleClass("deleted",!1)})).catch(a.error)},c}.apply(t,n))||(e.exports=o)},44882:(e,t,s)=>{var n,o;n=[s(31369),s(32230),s(66603),s(7927),s(85233)],void 0===(o=function(e,t,s,n,o){const a={};let i,r;return a.show=function(){o.one("action:ajaxify.end",(()=>{!function(){const t=utils.params({full:!0});i=t.has("loggedin"),r=t.get("register"),i&&(n.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),t.delete("loggedin")),r&&(e.alert({message:utils.escapeHTML(decodeURIComponent(r))}),t.delete("register"));const s=t.toString();ajaxify.updateHistory(ajaxify.currentPage+(s?`?${s}`:"")+document.location.hash,!0)}(),config.cookies.enabled&&navigator.cookieEnabled&&!app.inAdmin&&"1"!==s.getItem("cookieconsent")&&(config.cookies.message=t.unescape(config.cookies.message),config.cookies.dismiss=t.unescape(config.cookies.dismiss),config.cookies.link=t.unescape(config.cookies.link),config.cookies.link_url=t.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,(function(e){$(document.body).append(e),$(document.body).addClass("cookie-consent-open");const t=$(".cookie-consent");t.find("button").on("click",(function(){s.setItem("cookieconsent","1"),t.remove(),$(document.body).removeClass("cookie-consent-open")}))}))),a.showEmailConfirmWarning()}))},a.showEmailConfirmWarning=function(e){if(!config.emailPrompt||!app.user.uid||1===parseInt(s.getItem("email-confirm-dismiss"),10))return;const t={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{s.setItem("email-confirm-dismiss",1)}};app.user.email?app.user["email:confirmed"]||app.user.isEmailConfirmSent?!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(t.message="[[error:email-not-confirmed-email-sent]]",n.alert(t)):(t.message=e||"[[error:email-not-confirmed]]",t.clickfn=function(){n.remove("email_confirm"),socket.emit("user.emailConfirm",{},(function(e){if(e)return n.error(e);n.success("[[notifications:email-confirm-sent]]")}))},n.alert(t)):(t.message="[[error:no-email-to-confirm]]",t.clickfn=function(){n.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},n.alert(t))},a.showInvalidSession=function(){e.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},a.showSessionMismatch=function(){e.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},a}.apply(t,n))||(e.exports=o)},66603:(e,t,s)=>{var n;void 0===(n=function(){function e(){this._store={},this._keys=[]}let t;e.prototype.isMock=!0,e.prototype.setItem=function(e,t){e=String(e),-1===this._keys.indexOf(e)&&this._keys.push(e),this._store[e]=t},e.prototype.getItem=function(e){return e=String(e),-1===this._keys.indexOf(e)?null:this._store[e]},e.prototype.removeItem=function(e){e=String(e),this._keys=this._keys.filter((function(t){return t!==e})),this._store[e]=null},e.prototype.clear=function(){this._keys=[],this._store={}},e.prototype.key=function(e){return e=parseInt(e,10)||0,this._keys[e]},Object.defineProperty&&Object.defineProperty(e.prototype,"length",{get:function(){return this._keys.length}});const s=Date.now().toString();try{if(t=window.localStorage,t.setItem(s,s),t.getItem(s)!==s)throw Error("localStorage behaved unexpectedly");return t.removeItem(s),t}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(t=window.sessionStorage,t.setItem(s,s),t.getItem(s)!==s)throw Error("sessionStorage behaved unexpectedly");return t.removeItem(s),t}catch(t){return console.warn(t),console.warn("sessionStorage failed, falling back on memory storage"),new e}}}.call(t,s,t,e))||(e.exports=n)}}]);